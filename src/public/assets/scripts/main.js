(()=>{"use strict";var e,t={732:()=>{var e="imageAnnotation",t="videoAnnotation";function n(e,t,n,i,s,o,a,l){var r,u="function"==typeof e?e.options:e;if(t&&(u.render=t,u.staticRenderFns=n,u._compiled=!0),i&&(u.functional=!0),o&&(u._scopeId="data-v-"+o),a?(r=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),s&&s.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},u._ssrRegister=r):s&&(r=l?function(){s.call(this,(u.functional?this.parent:this).$root.$options.shadowRoot)}:s),r)if(u.functional){u._injectStyles=r;var d=u.render;u.render=function(e,t){return r.call(t),d(e,t)}}else{var h=u.beforeCreate;u.beforeCreate=h?[].concat(h,r):[r]}return{exports:e,options:u}}const i=n({computed:{id:function(){return this.image.id},uuid:function(){return this.image.uuid},type:function(){return this.image.type},patchPrefix:function(){return this.uuid[0]+this.uuid[1]+"/"+this.uuid[2]+this.uuid[3]+"/"+this.uuid},urlTemplate:function(){return biigle.$require("largo.patchUrlTemplate")}},methods:{getThumbnailUrl:function(){return this.type===t?this.urlTemplate.replace(":prefix",this.patchPrefix).replace(":id","v-".concat(this.id)):this.urlTemplate.replace(":prefix",this.patchPrefix).replace(":id",this.id)}},created:function(){this.type===e?this.showAnnotationRoute=biigle.$require("largo.showImageAnnotationRoute"):this.showAnnotationRoute=biigle.$require("largo.showVideoAnnotationRoute")}},undefined,undefined,!1,null,null,null).exports;const s=n({mixins:[i],props:{_id:{type:String,required:!0},_uuid:{type:String,required:!0},label:{type:Object,required:!0},emptySrc:{type:String,required:!0},_urlTemplate:{type:String,required:!0}},data:function(){return{url:""}},computed:{title:function(){return"Example annotation for label "+this.label.name},src:function(){return this.url||this.emptySrc},image:function(){return{id:this._id,uuid:this._uuid,type:e}},urlTemplate:function(){return this._urlTemplate}},methods:{showEmptyImage:function(){this.url=""}},created:function(){this.url=this.getThumbnailUrl()}},undefined,undefined,!1,null,null,null).exports,o=Vue.resource("api/v1/volumes{/id}/largo",{},{queryImageAnnotations:{method:"GET",url:"api/v1/volumes{/id}/image-annotations/filter/label{/label_id}"},queryVideoAnnotations:{method:"GET",url:"api/v1/volumes{/id}/video-annotations/filter/label{/label_id}"},queryExampleAnnotations:{method:"GET",url:"api/v1/volumes{/id}/image-annotations/examples{/label_id}"}});var a=biigle.$require("echo"),l=biigle.$require("events"),r=biigle.$require("messages").handleErrorResponse,u=biigle.$require("volumes.components.imageGrid"),d=biigle.$require("volumes.components.imageGridImage"),h=biigle.$require("annotations.components.labelsTabPlugins"),c=biigle.$require("labelTrees.components.labelTrees"),m=biigle.$require("core.mixins.loader"),f=biigle.$require("messages"),g=biigle.$require("core.components.powerToggle"),p=biigle.$require("annotations.components.settingsTabPlugins"),b=biigle.$require("core.components.sidebar"),v=biigle.$require("core.components.sidebarTab");const w=n({mixins:[m],components:{annotationPatch:s},props:{label:{default:null},volumeId:{type:Number,required:!0},count:{type:Number,default:3}},data:function(){return{exampleLabel:null,exampleAnnotations:[],cache:{},shown:!0}},computed:{isShown:function(){return this.shown&&null!==this.label},hasExamples:function(){return this.exampleLabel&&this.exampleAnnotations&&Object.keys(this.exampleAnnotations).length>0}},methods:{parseResponse:function(e){return e.data},setExampleAnnotations:function(e){(!e[0].hasOwnProperty("annotations")||Object.keys(e[0].annotations).length<this.count)&&delete this.cache[e[1]],e[0].hasOwnProperty("label")&&e[0].label.id===e[1]||delete this.cache[e[1]],this.label&&this.label.id===e[1]&&(this.exampleAnnotations=e[0].annotations,this.exampleLabel=e[0].label)},updateShown:function(e){this.shown=e},updateExampleAnnotations:function(){this.exampleAnnotations=[],this.isShown&&(this.startLoading(),this.cache.hasOwnProperty(this.label.id)||(this.cache[this.label.id]=o.queryExampleAnnotations({id:this.volumeId,label_id:this.label.id,take:this.count}).then(this.parseResponse)),Vue.Promise.all([this.cache[this.label.id],this.label.id]).then(this.setExampleAnnotations).finally(this.finishLoading))}},watch:{label:function(){this.updateExampleAnnotations()},shown:function(){this.updateExampleAnnotations()}},created:function(){l.$on("settings.exampleAnnotations",this.updateShown)}},undefined,undefined,!1,null,null,null).exports;h&&(h.exampleAnnotations=w);const A=n({components:{powerButton:g},props:{settings:{type:Object,required:!0}},data:function(){return{isShown:!0}},methods:{hide:function(){this.isShown=!1,this.settings.set("exampleAnnotations",!1)},show:function(){this.isShown=!0,this.settings.delete("exampleAnnotations")}},watch:{isShown:function(e){l.$emit("settings.exampleAnnotations",e)}},created:function(){this.settings.has("exampleAnnotations")&&(this.isShown=this.settings.get("exampleAnnotations"))}},undefined,undefined,!1,null,null,null).exports;p&&(p.exampleAnnotations=A),biigle.$declare("largo.mixins.annotationPatch",i);var _=n({mixins:[d,i],data:function(){return{showAnnotationRoute:null}},computed:{showAnnotationLink:function(){return this.showAnnotationRoute?this.showAnnotationRoute+this.image.id:""}},created:function(){this.type===e?this.showAnnotationRoute=biigle.$require("annotationCatalog.showImageAnnotationRoute"):this.showAnnotationRoute=biigle.$require("annotationCatalog.showVideoAnnotationRoute")}},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("figure",{staticClass:"image-grid__image image-grid__image--catalog",class:e.classObject},[e.showAnnotationLink?n("a",{attrs:{href:e.showAnnotationLink,target:"_blank",title:"Show the annotation in the annotation tool"}},[n("img",{attrs:{src:e.srcUrl},on:{error:e.showEmptyImage}})]):n("img",{attrs:{src:e.srcUrl},on:{error:e.showEmptyImage}})])}),[],!1,null,null,null);const y=n({mixins:[u],components:{imageGridImage:_.exports}},undefined,undefined,!1,null,null,null).exports,S=Vue.resource("api/v1/labels{/id}",{},{queryImageAnnotations:{method:"GET",url:"api/v1/labels{/id}/image-annotations"},queryVideoAnnotations:{method:"GET",url:"api/v1/labels{/id}/video-annotations"}});var x=n({mixins:[d,i],data:function(){return{showAnnotationRoute:null}},computed:{showAnnotationLink:function(){return this.showAnnotationRoute?this.showAnnotationRoute+this.image.id:""},selected:function(){return this.image.dismissed},title:function(){return this.selected?"Undo dismissing this annotation":"Dismiss this annotation"}}},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("figure",{staticClass:"image-grid__image",class:e.classObject,attrs:{title:e.title}},[e.selectable?n("div",{staticClass:"image-icon"},[n("i",{staticClass:"fas",class:e.iconClass})]):e._e(),e._v(" "),n("img",{attrs:{src:e.srcUrl},on:{click:e.toggleSelect,error:e.showEmptyImage}}),e._v(" "),e.showAnnotationLink?n("div",{staticClass:"image-buttons"},[n("a",{staticClass:"image-button",attrs:{href:e.showAnnotationLink,target:"_blank",title:"Show the annotation in the annotation tool"}},[n("span",{staticClass:"fa fa-external-link-square-alt fa-fw",attrs:{"aria-hidden":"true"}})])]):e._e()])}),[],!1,null,null,null);const I=n({mixins:[u],components:{imageGridImage:x.exports}},undefined,undefined,!1,null,null,null).exports;var C=n({mixins:[d,i],data:function(){return{showAnnotationRoute:null}},computed:{showAnnotationLink:function(){return this.showAnnotationRoute?this.showAnnotationRoute+this.image.id:""},selected:function(){return this.image.newLabel},title:function(){return this.selected?"Revert changing the label of this annotation":"Change the label of this annotation"},newLabelStyle:function(){return{"background-color":"#"+this.image.newLabel.color}}}},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("figure",{staticClass:"image-grid__image image-grid__image--relabel",class:e.classObject,attrs:{title:e.title}},[e.selectable?n("div",{staticClass:"image-icon"},[n("i",{staticClass:"fas",class:e.iconClass})]):e._e(),e._v(" "),n("img",{attrs:{src:e.srcUrl},on:{click:e.toggleSelect,error:e.showEmptyImage}}),e._v(" "),e.showAnnotationLink?n("div",{staticClass:"image-buttons"},[n("a",{staticClass:"image-button",attrs:{href:e.showAnnotationLink,target:"_blank",title:"Show the annotation in the annotation tool"}},[n("span",{staticClass:"fa fa-external-link-square-alt",attrs:{"aria-hidden":"true"}})])]):e._e(),e._v(" "),e.selected?n("div",{staticClass:"new-label"},[n("span",{staticClass:"new-label__color",style:e.newLabelStyle}),e._v(" "),n("span",{staticClass:"new-label__name",domProps:{textContent:e._s(e.image.newLabel.name)}})]):e._e()])}),[],!1,null,null,null);var L=n({mixins:[u],components:{imageGridImage:C.exports}},undefined,undefined,!1,null,null,null);const T=n({mixins:[m],components:{labelTrees:c,sidebar:b,sidebarTab:v,powerToggle:g,dismissImageGrid:I,relabelImageGrid:L.exports},data:function(){return{user:null,labelTrees:[],step:0,selectedLabel:null,annotationsCache:{},lastSelectedImage:null,forceChange:!1,waitForSessionId:null}},computed:{isInDismissStep:function(){return 0===this.step},isInRelabelStep:function(){return 1===this.step},annotations:function(){return this.selectedLabel&&this.annotationsCache.hasOwnProperty(this.selectedLabel.id)?this.annotationsCache[this.selectedLabel.id]:[]},allAnnotations:function(){var e=[];for(var t in this.annotationsCache)this.annotationsCache.hasOwnProperty(t)&&Array.prototype.push.apply(e,this.annotationsCache[t]);return e},hasNoAnnotations:function(){return this.selectedLabel&&!this.loading&&0===this.annotations.length},dismissedAnnotations:function(){return this.allAnnotations.filter((function(e){return e.dismissed}))},annotationsWithNewLabel:function(){return this.dismissedAnnotations.filter((function(e){return!!e.newLabel}))},hasDismissedAnnotations:function(){return this.dismissedAnnotations.length>0},dismissedImageAnnotationsToSave:function(){return this.packDismissedToSave(this.dismissedAnnotations.filter((function(t){return t.type===e})))},dismissedVideoAnnotationsToSave:function(){return this.packDismissedToSave(this.dismissedAnnotations.filter((function(e){return e.type===t})))},changedImageAnnotationsToSave:function(){return this.packChangedToSave(this.annotationsWithNewLabel.filter((function(t){return t.type===e})))},changedVideoAnnotationsToSave:function(){return this.packChangedToSave(this.annotationsWithNewLabel.filter((function(e){return e.type===t})))},toDeleteCount:function(){return this.dismissedAnnotations.length-this.annotationsWithNewLabel.length},saveButtonClass:function(){return this.forceChange?"btn-danger":"btn-success"}},methods:{getAnnotations:function(e){var t=this;this.annotationsCache.hasOwnProperty(e.id)||(Vue.set(this.annotationsCache,e.id,[]),this.startLoading(),this.queryAnnotations(e).then((function(n){return t.gotAnnotations(e,n)}),r).finally(this.finishLoading))},gotAnnotations:function(n,i){var s=i[0].data,o=i[1].data,a=[];s&&(a=a.concat(this.initAnnotations(n,s,e))),o&&(a=a.concat(this.initAnnotations(n,o,t))),a=a.sort((function(e,t){return t.id-e.id})),Vue.set(this.annotationsCache,n.id,a)},initAnnotations:function(e,t,n){return Object.keys(t).map((function(i){return{id:i,uuid:t[i],label_id:e.id,dismissed:!1,newLabel:null,type:n}}))},handleSelectedLabel:function(e){this.selectedLabel=e,this.isInDismissStep&&this.getAnnotations(e)},handleDeselectedLabel:function(){this.selectedLabel=null},handleSelectedImageDismiss:function(e,t){e.dismissed?(e.dismissed=!1,e.newLabel=null):(e.dismissed=!0,t.shiftKey&&this.lastSelectedImage?this.dismissAllImagesBetween(e,this.lastSelectedImage):this.lastSelectedImage=e)},goToRelabel:function(){this.step=1,this.lastSelectedImage=null},goToDismiss:function(){this.step=0,this.lastSelectedImage=null,this.selectedLabel&&this.getAnnotations(this.selectedLabel)},handleSelectedImageRelabel:function(e,t){e.newLabel?this.selectedLabel&&e.newLabel.id!==this.selectedLabel.id?e.newLabel=this.selectedLabel:e.newLabel=null:this.selectedLabel&&(e.newLabel=this.selectedLabel,t.shiftKey&&this.lastSelectedImage?this.relabelAllImagesBetween(e,this.lastSelectedImage):this.lastSelectedImage=e)},save:function(){var e=this;if(!this.loading){if(this.toDeleteCount>0){for(var t;null!==t&&parseInt(t,10)!==this.toDeleteCount;)t=prompt("This might delete ".concat(this.toDeleteCount," annotation(s). Please enter the number to continue."));if(null===t)return}this.startLoading(),this.performSave({dismissed_image_annotations:this.dismissedImageAnnotationsToSave,changed_image_annotations:this.changedImageAnnotationsToSave,dismissed_video_annotations:this.dismissedVideoAnnotationsToSave,changed_video_annotations:this.changedVideoAnnotationsToSave,force:this.forceChange}).then((function(t){return e.waitForSessionId=t.body.id}),(function(t){e.finishLoading(),r(t)}))}},handleSessionSaved:function(e){if(e.id==this.waitForSessionId){for(var t in this.finishLoading(),f.success("Saved. You can now start a new re-evaluation session."),this.step=0,this.annotationsCache)this.annotationsCache.hasOwnProperty(t)&&delete this.annotationsCache[t];this.handleSelectedLabel(this.selectedLabel)}},handleSessionFailed:function(e){e.id==this.waitForSessionId&&(this.finishLoading(),f.danger("There was an unexpected error."))},performOnAllImagesBetween:function(e,t,n){var i=this.allAnnotations.indexOf(e),s=this.allAnnotations.indexOf(t);if(s<i){var o=s;s=i,i=o}for(var a=i+1;a<s;a++)n(this.allAnnotations[a])},dismissAllImagesBetween:function(e,t){this.performOnAllImagesBetween(e,t,(function(e){e.dismissed=!0}))},relabelAllImagesBetween:function(e,t){var n=this.selectedLabel;this.performOnAllImagesBetween(e,t,(function(e){e.dismissed&&(e.newLabel=n)}))},enableForceChange:function(){this.forceChange=!0},disableForceChange:function(){this.forceChange=!1},packDismissedToSave:function(e){for(var t={},n=e.length-1;n>=0;n--)t.hasOwnProperty(e[n].label_id)?t[e[n].label_id].push(e[n].id):t[e[n].label_id]=[e[n].id];return t},packChangedToSave:function(e){for(var t={},n=e.length-1;n>=0;n--)t.hasOwnProperty(e[n].newLabel.id)?t[e[n].newLabel.id].push(e[n].id):t[e[n].newLabel.id]=[e[n].id];return t},initializeEcho:function(){a.getInstance().private("user-".concat(this.user.id)).listen(".Biigle\\Modules\\Largo\\Events\\LargoSessionSaved",this.handleSessionSaved).listen(".Biigle\\Modules\\Largo\\Events\\LargoSessionFailed",this.handleSessionFailed)}},watch:{annotations:function(e){l.$emit("annotations-count",e.length)},dismissedAnnotations:function(e){l.$emit("dismissed-annotations-count",e.length)},step:function(e){l.$emit("step",e)},selectedLabel:function(){this.isInDismissStep&&this.$refs.dismissGrid.setOffset(0)}},created:function(){var e=this;this.user=biigle.$require("largo.user"),window.addEventListener("beforeunload",(function(t){if(e.hasDismissedAnnotations)return t.preventDefault(),t.returnValue="","This page is asking you to confirm that you want to leave - data you have entered may not be saved."})),this.initializeEcho()}},undefined,undefined,!1,null,null,null).exports;const q=n({mixins:[T],components:{catalogImageGrid:y},data:function(){return{labelTrees:[]}},methods:{queryAnnotations:function(e){var t=S.queryImageAnnotations({id:e.id}),n=S.queryVideoAnnotations({id:e.id});return Vue.Promise.all([t,n])}},created:function(){var e=biigle.$require("annotationCatalog.labelTree");this.labelTrees=[e]}},undefined,undefined,!1,null,null,null).exports;const $=n({mixins:[T],data:function(){return{volumeId:null,labelTrees:[],mediaType:""}},methods:{queryAnnotations:function(e){var t,n;return"image"===this.mediaType?(t=o.queryImageAnnotations({id:this.volumeId,label_id:e.id}),n=Vue.Promise.resolve([])):(t=Vue.Promise.resolve([]),n=o.queryVideoAnnotations({id:this.volumeId,label_id:e.id})),Vue.Promise.all([t,n])},performSave:function(e){return o.save({id:this.volumeId},e)}},created:function(){this.volumeId=biigle.$require("largo.volumeId"),this.labelTrees=biigle.$require("largo.labelTrees"),this.mediaType=biigle.$require("largo.mediaType")}},undefined,undefined,!1,null,null,null).exports;const O=n({data:function(){return{step:0,count:0,dismissedCount:0}},computed:{shownCount:function(){return this.isInDismissStep?this.count:this.dismissedCount},isInDismissStep:function(){return 0===this.step},isInRelabelStep:function(){return 1===this.step}},methods:{updateStep:function(e){this.step=e},updateCount:function(e){this.count=e},updateDismissedCount:function(e){this.dismissedCount=e}},created:function(){l.$on("annotations-count",this.updateCount),l.$on("dismissed-annotations-count",this.updateDismissedCount),l.$on("step",this.updateStep)}},undefined,undefined,!1,null,null,null).exports,E=Vue.resource("api/v1/projects{/id}/largo",{},{queryImageAnnotations:{method:"GET",url:"api/v1/projects{/id}/image-annotations/filter/label{/label_id}"},queryVideoAnnotations:{method:"GET",url:"api/v1/projects{/id}/video-annotations/filter/label{/label_id}"}});const k=n({mixins:[T],data:function(){return{projectId:null,labelTrees:[]}},methods:{queryAnnotations:function(e){var t=E.queryImageAnnotations({id:this.projectId,label_id:e.id}),n=E.queryVideoAnnotations({id:this.projectId,label_id:e.id});return Vue.Promise.all([t,n])},performSave:function(e){return E.save({id:this.projectId},e)}},created:function(){this.projectId=biigle.$require("largo.projectId"),this.labelTrees=biigle.$require("largo.labelTrees")}},undefined,undefined,!1,null,null,null).exports;biigle.$mount("annotation-catalog-container",q),biigle.$mount("largo-container",$),biigle.$mount("largo-title",O),biigle.$mount("project-largo-container",k)},401:()=>{}},n={};function i(e){var s=n[e];if(void 0!==s)return s.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,i),o.exports}i.m=t,e=[],i.O=(t,n,s,o)=>{if(!n){var a=1/0;for(d=0;d<e.length;d++){for(var[n,s,o]=e[d],l=!0,r=0;r<n.length;r++)(!1&o||a>=o)&&Object.keys(i.O).every((e=>i.O[e](n[r])))?n.splice(r--,1):(l=!1,o<a&&(a=o));if(l){e.splice(d--,1);var u=s();void 0!==u&&(t=u)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[n,s,o]},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={355:0,392:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var s,o,[a,l,r]=n,u=0;if(a.some((t=>0!==e[t]))){for(s in l)i.o(l,s)&&(i.m[s]=l[s]);if(r)var d=r(i)}for(t&&t(n);u<a.length;u++)o=a[u],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(d)},n=self.webpackChunkbiigle_largo=self.webpackChunkbiigle_largo||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),i.O(void 0,[392],(()=>i(732)));var s=i.O(void 0,[392],(()=>i(401)));s=i.O(s)})();