/*! For license information please see main.js.LICENSE.txt */
!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=0)}({"+mSJ":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("/rf6"),o=n("AKIq"),r=n("cWyK");e.default=function(t){if(!t)throw new Error("geojson is required");var e=[];return r.flattenEach(t,(function(t){!function(t,e){var n=[],r=t.geometry;if(null!==r){switch(r.type){case"Polygon":n=o.getCoords(r);break;case"LineString":n=[o.getCoords(r)]}n.forEach((function(n){(function(t,e){var n=[];return t.reduce((function(t,o){var r,s,a,h,u,l,c=i.lineString([t,o],e);return c.bbox=(s=o,a=(r=t)[0],h=r[1],u=s[0],l=s[1],[a<u?a:u,h<l?h:l,a>u?a:u,h>l?h:l]),n.push(c),o})),n})(n,t.properties).forEach((function(t){t.id=e.length,e.push(t)}))}))}}(t,e)})),i.featureCollection(e)}},"/rf6":function(t,e,n){"use strict";function i(t,e,n){void 0===n&&(n={});var i={type:"Feature"};return(0===n.id||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=e||{},i.geometry=t,i}function o(t,e,n){return void 0===n&&(n={}),i({type:"Point",coordinates:t},e,n)}function r(t,e,n){void 0===n&&(n={});for(var o=0,r=t;o<r.length;o++){var s=r[o];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<s[s.length-1].length;a++)if(s[s.length-1][a]!==s[0][a])throw new Error("First and last Position are not equivalent.")}return i({type:"Polygon",coordinates:t},e,n)}function s(t,e,n){if(void 0===n&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return i({type:"LineString",coordinates:t},e,n)}function a(t,e){void 0===e&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function h(t,e,n){return void 0===n&&(n={}),i({type:"MultiLineString",coordinates:t},e,n)}function u(t,e,n){return void 0===n&&(n={}),i({type:"MultiPoint",coordinates:t},e,n)}function l(t,e,n){return void 0===n&&(n={}),i({type:"MultiPolygon",coordinates:t},e,n)}function c(t,n){void 0===n&&(n="kilometers");var i=e.factors[n];if(!i)throw new Error(n+" units is invalid");return t*i}function p(t,n){void 0===n&&(n="kilometers");var i=e.factors[n];if(!i)throw new Error(n+" units is invalid");return t/i}function f(t){return 180*(t%(2*Math.PI))/Math.PI}function d(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)&&!/^\s*$/.test(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=6371008.8,e.factors={centimeters:100*e.earthRadius,centimetres:100*e.earthRadius,degrees:e.earthRadius/111325,feet:3.28084*e.earthRadius,inches:39.37*e.earthRadius,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:1e3*e.earthRadius,millimetres:1e3*e.earthRadius,nauticalmiles:e.earthRadius/1852,radians:1,yards:e.earthRadius/1.0936},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1/1.0936},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},e.feature=i,e.geometry=function(t,e,n){switch(void 0===n&&(n={}),t){case"Point":return o(e).geometry;case"LineString":return s(e).geometry;case"Polygon":return r(e).geometry;case"MultiPoint":return u(e).geometry;case"MultiLineString":return h(e).geometry;case"MultiPolygon":return l(e).geometry;default:throw new Error(t+" is invalid")}},e.point=o,e.points=function(t,e,n){return void 0===n&&(n={}),a(t.map((function(t){return o(t,e)})),n)},e.polygon=r,e.polygons=function(t,e,n){return void 0===n&&(n={}),a(t.map((function(t){return r(t,e)})),n)},e.lineString=s,e.lineStrings=function(t,e,n){return void 0===n&&(n={}),a(t.map((function(t){return s(t,e)})),n)},e.featureCollection=a,e.multiLineString=h,e.multiPoint=u,e.multiPolygon=l,e.geometryCollection=function(t,e,n){return void 0===n&&(n={}),i({type:"GeometryCollection",geometries:t},e,n)},e.round=function(t,e){if(void 0===e&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(t*n)/n},e.radiansToLength=c,e.lengthToRadians=p,e.lengthToDegrees=function(t,e){return f(p(t,e))},e.bearingToAzimuth=function(t){var e=t%360;return e<0&&(e+=360),e},e.radiansToDegrees=f,e.degreesToRadians=function(t){return t%360*Math.PI/180},e.convertLength=function(t,e,n){if(void 0===e&&(e="kilometers"),void 0===n&&(n="kilometers"),!(t>=0))throw new Error("length must be a positive number");return c(p(t,e),n)},e.convertArea=function(t,n,i){if(void 0===n&&(n="meters"),void 0===i&&(i="kilometers"),!(t>=0))throw new Error("area must be a positive number");var o=e.areaFactors[n];if(!o)throw new Error("invalid original units");var r=e.areaFactors[i];if(!r)throw new Error("invalid final units");return t/o*r},e.isNumber=d,e.isObject=function(t){return!!t&&t.constructor===Object},e.validateBBox=function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!d(t))throw new Error("bbox must only contain numbers")}))},e.validateId=function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")},e.radians2degrees=function(){throw new Error("method has been renamed to `radiansToDegrees`")},e.degrees2radians=function(){throw new Error("method has been renamed to `degreesToRadians`")},e.distanceToDegrees=function(){throw new Error("method has been renamed to `lengthToDegrees`")},e.distanceToRadians=function(){throw new Error("method has been renamed to `lengthToRadians`")},e.radiansToDistance=function(){throw new Error("method has been renamed to `radiansToLength`")},e.bearingToAngle=function(){throw new Error("method has been renamed to `bearingToAzimuth`")},e.convertDistance=function(){throw new Error("method has been renamed to `convertLength`")}},0:function(t,e,n){n("WfG0"),t.exports=n("zcrr")},"1KsK":function(t,e,n){"use strict";var i=Object.prototype.toString;t.exports=function(t){var e=i.call(t),n="[object Arguments]"===e;return n||(n="[object Array]"!==e&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===i.call(t.callee)),n}},"1seS":function(t,e,n){"use strict";var i=Array.prototype.slice,o=n("1KsK"),r=Object.keys,s=r?function(t){return r(t)}:n("sYn3"),a=Object.keys;s.shim=function(){Object.keys?function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2)||(Object.keys=function(t){return o(t)?a(i.call(t)):a(t)}):Object.keys=s;return Object.keys||s},t.exports=s},"1u+m":function(t,e,n){"use strict";var i=function(t){return t!=t};t.exports=function(t,e){return 0===t&&0===e?1/t==1/e:t===e||!(!i(t)||!i(e))}},"2Nju":function(t,e,n){"use strict";var i,o,r,s=n("UVaH")()&&"symbol"==typeof Symbol.toStringTag;if(s){i=Function.call.bind(RegExp.prototype.exec),o={};var a=function(){throw o};r={toString:a,valueOf:a},"symbol"==typeof Symbol.toPrimitive&&(r[Symbol.toPrimitive]=a)}var h=Object.prototype.toString;t.exports=s?function(t){if(!t||"object"!=typeof t)return!1;try{i(t,r)}catch(t){return t===o}}:function(t){return!(!t||"object"!=typeof t&&"function"!=typeof t)&&"[object RegExp]"===h.call(t)}},"45zb":function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,o=Object.prototype.toString,r=function(t){return!(i&&t&&"object"==typeof t&&Symbol.toStringTag in t)&&"[object Arguments]"===o.call(t)},s=function(t){return!!r(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==o.call(t)&&"[object Function]"===o.call(t.callee)},a=function(){return r(arguments)}();r.isLegacyArguments=s,t.exports=a?r:s},"5xAX":function(t,e,n){"use strict";var i=n("82c2"),o=n("RLeF"),r=n("VwiP"),s=n("V+xs"),a=n("HH6Z"),h=o(r);i(h,{getPolyfill:s,implementation:r,shim:a}),t.exports=h},"6ayh":function(t,e,n){"use strict";var i=TypeError,o=Object.getOwnPropertyDescriptor;if(o)try{o({},"")}catch(t){o=null}var r=function(){throw new i},s=o?function(){try{return r}catch(t){try{return o(arguments,"callee").get}catch(t){return r}}}():r,a=n("UVaH")(),h=Object.getPrototypeOf||function(t){return t.__proto__},u=void 0,l="undefined"==typeof Uint8Array?void 0:h(Uint8Array),c={"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?void 0:ArrayBuffer,"%ArrayBufferPrototype%":"undefined"==typeof ArrayBuffer?void 0:ArrayBuffer.prototype,"%ArrayIteratorPrototype%":a?h([][Symbol.iterator]()):void 0,"%ArrayPrototype%":Array.prototype,"%ArrayProto_entries%":Array.prototype.entries,"%ArrayProto_forEach%":Array.prototype.forEach,"%ArrayProto_keys%":Array.prototype.keys,"%ArrayProto_values%":Array.prototype.values,"%AsyncFromSyncIteratorPrototype%":void 0,"%AsyncFunction%":void 0,"%AsyncFunctionPrototype%":void 0,"%AsyncGenerator%":void 0,"%AsyncGeneratorFunction%":void 0,"%AsyncGeneratorPrototype%":void 0,"%AsyncIteratorPrototype%":u&&a&&Symbol.asyncIterator?u[Symbol.asyncIterator]():void 0,"%Atomics%":"undefined"==typeof Atomics?void 0:Atomics,"%Boolean%":Boolean,"%BooleanPrototype%":Boolean.prototype,"%DataView%":"undefined"==typeof DataView?void 0:DataView,"%DataViewPrototype%":"undefined"==typeof DataView?void 0:DataView.prototype,"%Date%":Date,"%DatePrototype%":Date.prototype,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%ErrorPrototype%":Error.prototype,"%eval%":eval,"%EvalError%":EvalError,"%EvalErrorPrototype%":EvalError.prototype,"%Float32Array%":"undefined"==typeof Float32Array?void 0:Float32Array,"%Float32ArrayPrototype%":"undefined"==typeof Float32Array?void 0:Float32Array.prototype,"%Float64Array%":"undefined"==typeof Float64Array?void 0:Float64Array,"%Float64ArrayPrototype%":"undefined"==typeof Float64Array?void 0:Float64Array.prototype,"%Function%":Function,"%FunctionPrototype%":Function.prototype,"%Generator%":void 0,"%GeneratorFunction%":void 0,"%GeneratorPrototype%":void 0,"%Int8Array%":"undefined"==typeof Int8Array?void 0:Int8Array,"%Int8ArrayPrototype%":"undefined"==typeof Int8Array?void 0:Int8Array.prototype,"%Int16Array%":"undefined"==typeof Int16Array?void 0:Int16Array,"%Int16ArrayPrototype%":"undefined"==typeof Int16Array?void 0:Int8Array.prototype,"%Int32Array%":"undefined"==typeof Int32Array?void 0:Int32Array,"%Int32ArrayPrototype%":"undefined"==typeof Int32Array?void 0:Int32Array.prototype,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":a?h(h([][Symbol.iterator]())):void 0,"%JSON%":"object"==typeof JSON?JSON:void 0,"%JSONParse%":"object"==typeof JSON?JSON.parse:void 0,"%Map%":"undefined"==typeof Map?void 0:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&a?h((new Map)[Symbol.iterator]()):void 0,"%MapPrototype%":"undefined"==typeof Map?void 0:Map.prototype,"%Math%":Math,"%Number%":Number,"%NumberPrototype%":Number.prototype,"%Object%":Object,"%ObjectPrototype%":Object.prototype,"%ObjProto_toString%":Object.prototype.toString,"%ObjProto_valueOf%":Object.prototype.valueOf,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?void 0:Promise,"%PromisePrototype%":"undefined"==typeof Promise?void 0:Promise.prototype,"%PromiseProto_then%":"undefined"==typeof Promise?void 0:Promise.prototype.then,"%Promise_all%":"undefined"==typeof Promise?void 0:Promise.all,"%Promise_reject%":"undefined"==typeof Promise?void 0:Promise.reject,"%Promise_resolve%":"undefined"==typeof Promise?void 0:Promise.resolve,"%Proxy%":"undefined"==typeof Proxy?void 0:Proxy,"%RangeError%":RangeError,"%RangeErrorPrototype%":RangeError.prototype,"%ReferenceError%":ReferenceError,"%ReferenceErrorPrototype%":ReferenceError.prototype,"%Reflect%":"undefined"==typeof Reflect?void 0:Reflect,"%RegExp%":RegExp,"%RegExpPrototype%":RegExp.prototype,"%Set%":"undefined"==typeof Set?void 0:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&a?h((new Set)[Symbol.iterator]()):void 0,"%SetPrototype%":"undefined"==typeof Set?void 0:Set.prototype,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer,"%SharedArrayBufferPrototype%":"undefined"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer.prototype,"%String%":String,"%StringIteratorPrototype%":a?h(""[Symbol.iterator]()):void 0,"%StringPrototype%":String.prototype,"%Symbol%":a?Symbol:void 0,"%SymbolPrototype%":a?Symbol.prototype:void 0,"%SyntaxError%":SyntaxError,"%SyntaxErrorPrototype%":SyntaxError.prototype,"%ThrowTypeError%":s,"%TypedArray%":l,"%TypedArrayPrototype%":l?l.prototype:void 0,"%TypeError%":i,"%TypeErrorPrototype%":i.prototype,"%Uint8Array%":"undefined"==typeof Uint8Array?void 0:Uint8Array,"%Uint8ArrayPrototype%":"undefined"==typeof Uint8Array?void 0:Uint8Array.prototype,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray,"%Uint8ClampedArrayPrototype%":"undefined"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray.prototype,"%Uint16Array%":"undefined"==typeof Uint16Array?void 0:Uint16Array,"%Uint16ArrayPrototype%":"undefined"==typeof Uint16Array?void 0:Uint16Array.prototype,"%Uint32Array%":"undefined"==typeof Uint32Array?void 0:Uint32Array,"%Uint32ArrayPrototype%":"undefined"==typeof Uint32Array?void 0:Uint32Array.prototype,"%URIError%":URIError,"%URIErrorPrototype%":URIError.prototype,"%WeakMap%":"undefined"==typeof WeakMap?void 0:WeakMap,"%WeakMapPrototype%":"undefined"==typeof WeakMap?void 0:WeakMap.prototype,"%WeakSet%":"undefined"==typeof WeakSet?void 0:WeakSet,"%WeakSetPrototype%":"undefined"==typeof WeakSet?void 0:WeakSet.prototype},p=n("D3zA").call(Function.call,String.prototype.replace),f=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,d=/\\(\\)?/g,g=function(t){var e=[];return p(t,f,(function(t,n,i,o){e[e.length]=i?p(o,d,"$1"):n||t})),e},y=function(t,e){if(!(t in c))throw new SyntaxError("intrinsic "+t+" does not exist!");if(void 0===c[t]&&!e)throw new i("intrinsic "+t+" exists, but is not available. Please file an issue!");return c[t]};t.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new TypeError("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new TypeError('"allowMissing" argument must be a boolean');for(var n=g(t),r=y("%"+(n.length>0?n[0]:"")+"%",e),s=1;s<n.length;s+=1)if(null!=r)if(o&&s+1>=n.length){var a=o(r,n[s]);if(!e&&!(n[s]in r))throw new i("base intrinsic for "+t+" exists, but the property is not available.");r=a?a.get||a.value:r[n[s]]}else r=r[n[s]];return r}},"82c2":function(t,e,n){"use strict";var i=n("1seS"),o="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),r=Object.prototype.toString,s=Array.prototype.concat,a=Object.defineProperty,h=a&&function(){var t={};try{for(var e in a(t,"x",{enumerable:!1,value:t}),t)return!1;return t.x===t}catch(t){return!1}}(),u=function(t,e,n,i){var o;(!(e in t)||"function"==typeof(o=i)&&"[object Function]"===r.call(o)&&i())&&(h?a(t,e,{configurable:!0,enumerable:!1,value:n,writable:!0}):t[e]=n)},l=function(t,e){var n=arguments.length>2?arguments[2]:{},r=i(e);o&&(r=s.call(r,Object.getOwnPropertySymbols(e)));for(var a=0;a<r.length;a+=1)u(t,r[a],e[r[a]],n[r[a]])};l.supportsDescriptors=!!h,t.exports=l},"A/RR":function(t,e,n){!function(t){"use strict";function e(t,e){return t>e?1:t<e?-1:0}var n=function(t,n){void 0===t&&(t=e),void 0===n&&(n=!1),this._compare=t,this._root=null,this._size=0,this._noDuplicates=!!n},i={size:{configurable:!0}};function o(t,e,n){null===e?(t.inOut=!1,t.otherInOut=!0):(t.isSubject===e.isSubject?(t.inOut=!e.inOut,t.otherInOut=e.otherInOut):(t.inOut=!e.otherInOut,t.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(t.prevInResult=!r(e,n)||e.isVertical()?e.prevInResult:e));var i=r(t,n);t.resultTransition=i?function(t,e){var n,i=!t.inOut,o=!t.otherInOut;switch(e){case 0:n=i&&o;break;case 1:n=i||o;break;case 3:n=i^o;break;case 2:n=t.isSubject?i&&!o:o&&!i}return n?1:-1}(t,n):0}function r(t,e){switch(t.type){case 0:switch(e){case 0:return!t.otherInOut;case 1:return t.otherInOut;case 2:return t.isSubject&&t.otherInOut||!t.isSubject&&!t.otherInOut;case 3:return!0}break;case 2:return 0===e||1===e;case 3:return 2===e;case 1:return!1}return!1}n.prototype.rotateLeft=function(t){var e=t.right;e&&(t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.left=t),t.parent=e},n.prototype.rotateRight=function(t){var e=t.left;e&&(t.left=e.right,e.right&&(e.right.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.right=t),t.parent=e},n.prototype._splay=function(t){for(;t.parent;){var e=t.parent;e.parent?e.left===t&&e.parent.left===e?(this.rotateRight(e.parent),this.rotateRight(e)):e.right===t&&e.parent.right===e?(this.rotateLeft(e.parent),this.rotateLeft(e)):e.left===t&&e.parent.right===e?(this.rotateRight(e),this.rotateLeft(e)):(this.rotateLeft(e),this.rotateRight(e)):e.left===t?this.rotateRight(e):this.rotateLeft(e)}},n.prototype.splay=function(t){for(var e,n,i,o,r;t.parent;)(n=(e=t.parent).parent)&&n.parent?((i=n.parent).left===n?i.left=t:i.right=t,t.parent=i):(t.parent=null,this._root=t),o=t.left,r=t.right,t===e.left?(n&&(n.left===e?(e.right?(n.left=e.right,n.left.parent=n):n.left=null,e.right=n,n.parent=e):(o?(n.right=o,o.parent=n):n.right=null,t.left=n,n.parent=t)),r?(e.left=r,r.parent=e):e.left=null,t.right=e,e.parent=t):(n&&(n.right===e?(e.left?(n.right=e.left,n.right.parent=n):n.right=null,e.left=n,n.parent=e):(r?(n.left=r,r.parent=n):n.left=null,t.right=n,n.parent=t)),o?(e.right=o,o.parent=e):e.right=null,t.left=e,e.parent=t)},n.prototype.replace=function(t,e){t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.parent=t.parent)},n.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},n.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},n.prototype.insert=function(t,e){var n=this._root,i=null,o=this._compare;if(this._noDuplicates)for(;n;){if(i=n,0===o(n.key,t))return;n=o(n.key,t)<0?n.right:n.left}else for(;n;)i=n,n=o(n.key,t)<0?n.right:n.left;return n={key:t,data:e,left:null,right:null,parent:i},i?o(i.key,n.key)<0?i.right=n:i.left=n:this._root=n,this.splay(n),this._size++,n},n.prototype.find=function(t){for(var e=this._root,n=this._compare;e;){var i=n(e.key,t);if(i<0)e=e.right;else{if(!(i>0))return e;e=e.left}}return null},n.prototype.contains=function(t){for(var e=this._root,n=this._compare;e;){var i=n(t,e.key);if(0===i)return!0;e=i<0?e.left:e.right}return!1},n.prototype.remove=function(t){var e=this.find(t);if(!e)return!1;if(this.splay(e),e.left)if(e.right){var n=this.minNode(e.right);n.parent!==e&&(this.replace(n,n.right),n.right=e.right,n.right.parent=n),this.replace(e,n),n.left=e.left,n.left.parent=n}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0},n.prototype.removeNode=function(t){if(!t)return!1;if(this.splay(t),t.left)if(t.right){var e=this.minNode(t.right);e.parent!==t&&(this.replace(e,e.right),e.right=t.right,e.right.parent=e),this.replace(t,e),e.left=t.left,e.left.parent=e}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0},n.prototype.erase=function(t){var e=this.find(t);if(e){this.splay(e);var n=e.left,i=e.right,o=null;n&&(n.parent=null,o=this.maxNode(n),this.splay(o),this._root=o),i&&(n?o.right=i:this._root=i,i.parent=o),this._size--}},n.prototype.pop=function(){var t=this._root,e=null;if(t){for(;t.left;)t=t.left;e={key:t.key,data:t.data},this.remove(t.key)}return e},n.prototype.next=function(t){var e=t;if(e)if(e.right)for(e=e.right;e&&e.left;)e=e.left;else for(e=t.parent;e&&e.right===t;)t=e,e=e.parent;return e},n.prototype.prev=function(t){var e=t;if(e)if(e.left)for(e=e.left;e&&e.right;)e=e.right;else for(e=t.parent;e&&e.left===t;)t=e,e=e.parent;return e},n.prototype.forEach=function(t){for(var e=this._root,n=[],i=!1,o=0;!i;)e?(n.push(e),e=e.left):n.length>0?(t(e=n.pop(),o++),e=e.right):i=!0;return this},n.prototype.range=function(t,e,n,i){for(var o=[],r=this._compare,s=this._root;0!==o.length||s;)if(s)o.push(s),s=s.left;else{if(r((s=o.pop()).key,e)>0)break;if(r(s.key,t)>=0&&n.call(i,s))return this;s=s.right}return this},n.prototype.keys=function(){for(var t=this._root,e=[],n=[],i=!1;!i;)t?(e.push(t),t=t.left):e.length>0?(t=e.pop(),n.push(t.key),t=t.right):i=!0;return n},n.prototype.values=function(){for(var t=this._root,e=[],n=[],i=!1;!i;)t?(e.push(t),t=t.left):e.length>0?(t=e.pop(),n.push(t.data),t=t.right):i=!0;return n},n.prototype.at=function(t){for(var e=this._root,n=[],i=!1,o=0;!i;)if(e)n.push(e),e=e.left;else if(n.length>0){if(e=n.pop(),o===t)return e;o++,e=e.right}else i=!0;return null},n.prototype.load=function(t,e,n){if(void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===n&&(n=!1),0!==this._size)throw new Error("bulk-load: tree is not empty");var i=t.length;return n&&function t(e,n,i,o,r){if(!(i>=o)){for(var s=e[i+o>>1],a=i-1,h=o+1;;){do{a++}while(r(e[a],s)<0);do{h--}while(r(e[h],s)>0);if(a>=h)break;var u=e[a];e[a]=e[h],e[h]=u,u=n[a],n[a]=n[h],n[h]=u}t(e,n,i,h,r),t(e,n,h+1,o,r)}}(t,e,0,i-1,this._compare),this._root=function t(e,n,i,o,r){var s=r-o;if(s>0){var a=o+Math.floor(s/2),h={key:n[a],data:i[a],parent:e};return h.left=t(h,n,i,o,a),h.right=t(h,n,i,a+1,r),h}return null}(null,t,e,0,i),this._size=i,this},n.prototype.min=function(){var t=this.minNode(this._root);return t?t.key:null},n.prototype.max=function(){var t=this.maxNode(this._root);return t?t.key:null},n.prototype.isEmpty=function(){return null===this._root},i.size.get=function(){return this._size},n.createTree=function(t,e,i,o,r){return new n(i,r).load(t,e,o)},Object.defineProperties(n.prototype,i);var s=function(t,e,n,i,o){this.left=e,this.point=t,this.otherEvent=n,this.isSubject=i,this.type=o||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},a={inResult:{configurable:!0}};function h(t,e){return t[0]===e[0]&&t[1]===e[1]}function u(t,e,n,i,o){var r,s,a,h,u=e[0],l=i[0],c=0,p=0;l>u==l>-u?(r=u,u=e[++c]):(r=l,l=i[++p]);var f=0;if(c<t&&p<n)for(l>u==l>-u?(a=r-((s=u+r)-u),u=e[++c]):(a=r-((s=l+r)-l),l=i[++p]),r=s,0!==a&&(o[f++]=a);c<t&&p<n;)l>u==l>-u?(a=r-((s=r+u)-(h=s-r))+(u-h),u=e[++c]):(a=r-((s=r+l)-(h=s-r))+(l-h),l=i[++p]),r=s,0!==a&&(o[f++]=a);for(;c<t;)a=r-((s=r+u)-(h=s-r))+(u-h),u=e[++c],r=s,0!==a&&(o[f++]=a);for(;p<n;)a=r-((s=r+l)-(h=s-r))+(l-h),l=i[++p],r=s,0!==a&&(o[f++]=a);return 0===r&&0!==f||(o[f++]=r),f}function l(t){return new Float64Array(t)}s.prototype.isBelow=function(t){var e=this.point,n=this.otherEvent.point;return this.left?(e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1])>0:(n[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(n[1]-t[1])>0},s.prototype.isAbove=function(t){return!this.isBelow(t)},s.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},a.inResult.get=function(){return 0!==this.resultTransition},s.prototype.clone=function(){var t=new s(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.contourId=this.contourId,t.resultTransition=this.resultTransition,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t},Object.defineProperties(s.prototype,a);var c=l(4),p=l(8),f=l(12),d=l(16),g=l(4);function y(t,e,n,i,o,r){var s=(e-r)*(n-o),a=(t-o)*(i-r),h=s-a;if(0===s||0===a||s>0!=a>0)return h;var l=Math.abs(s+a);return Math.abs(h)>=33306690738754716e-32*l?h:-function(t,e,n,i,o,r,s){var a,h,l,y,v,m,_,w,b,x,C,P,E,S,R,M,k,I,F=t-o,A=n-o,O=e-r,T=i-r;v=(R=(w=F-(_=(m=134217729*F)-(m-F)))*(x=T-(b=(m=134217729*T)-(m-T)))-((S=F*T)-_*b-w*b-_*x))-(C=R-(k=(w=O-(_=(m=134217729*O)-(m-O)))*(x=A-(b=(m=134217729*A)-(m-A)))-((M=O*A)-_*b-w*b-_*x))),c[0]=R-(C+v)+(v-k),v=(E=S-((P=S+C)-(v=P-S))+(C-v))-(C=E-M),c[1]=E-(C+v)+(v-M),v=(I=P+C)-P,c[2]=P-(I-v)+(C-v),c[3]=I;var L=function(t,e){for(var n=e[0],i=1;i<t;i++)n+=e[i];return n}(4,c),j=22204460492503146e-32*s;if(L>=j||-L>=j)return L;if(a=t-(F+(v=t-F))+(v-o),l=n-(A+(v=n-A))+(v-o),h=e-(O+(v=e-O))+(v-r),y=i-(T+(v=i-T))+(v-r),0===a&&0===h&&0===l&&0===y)return L;if(j=11093356479670487e-47*s+33306690738754706e-32*Math.abs(L),(L+=F*y+T*a-(O*l+A*h))>=j||-L>=j)return L;v=(R=(w=a-(_=(m=134217729*a)-(m-a)))*(x=T-(b=(m=134217729*T)-(m-T)))-((S=a*T)-_*b-w*b-_*x))-(C=R-(k=(w=h-(_=(m=134217729*h)-(m-h)))*(x=A-(b=(m=134217729*A)-(m-A)))-((M=h*A)-_*b-w*b-_*x))),g[0]=R-(C+v)+(v-k),v=(E=S-((P=S+C)-(v=P-S))+(C-v))-(C=E-M),g[1]=E-(C+v)+(v-M),v=(I=P+C)-P,g[2]=P-(I-v)+(C-v),g[3]=I;var D=u(4,c,4,g,p);v=(R=(w=F-(_=(m=134217729*F)-(m-F)))*(x=y-(b=(m=134217729*y)-(m-y)))-((S=F*y)-_*b-w*b-_*x))-(C=R-(k=(w=O-(_=(m=134217729*O)-(m-O)))*(x=l-(b=(m=134217729*l)-(m-l)))-((M=O*l)-_*b-w*b-_*x))),g[0]=R-(C+v)+(v-k),v=(E=S-((P=S+C)-(v=P-S))+(C-v))-(C=E-M),g[1]=E-(C+v)+(v-M),v=(I=P+C)-P,g[2]=P-(I-v)+(C-v),g[3]=I;var G=u(D,p,4,g,f);v=(R=(w=a-(_=(m=134217729*a)-(m-a)))*(x=y-(b=(m=134217729*y)-(m-y)))-((S=a*y)-_*b-w*b-_*x))-(C=R-(k=(w=h-(_=(m=134217729*h)-(m-h)))*(x=l-(b=(m=134217729*l)-(m-l)))-((M=h*l)-_*b-w*b-_*x))),g[0]=R-(C+v)+(v-k),v=(E=S-((P=S+C)-(v=P-S))+(C-v))-(C=E-M),g[1]=E-(C+v)+(v-M),v=(I=P+C)-P,g[2]=P-(I-v)+(C-v),g[3]=I;var B=u(G,f,4,g,d);return d[B-1]}(t,e,n,i,o,r,l)}function v(t,e,n){var i=y(t[0],t[1],e[0],e[1],n[0],n[1]);return i>0?-1:i<0?1:0}function m(t,e){var n=t.point,i=e.point;return n[0]>i[0]?1:n[0]<i[0]?-1:n[1]!==i[1]?n[1]>i[1]?1:-1:function(t,e,n,i){return t.left!==e.left?t.left?1:-1:0!==v(n,t.otherEvent.point,e.otherEvent.point)?t.isBelow(e.otherEvent.point)?-1:1:!t.isSubject&&e.isSubject?1:-1}(t,e,n)}function _(t,e,n){var i=new s(e,!1,t,t.isSubject),o=new s(e,!0,t.otherEvent,t.isSubject);return h(t.point,t.otherEvent.point)&&console.warn("what is that, a collapsed segment?",t),i.contourId=o.contourId=t.contourId,m(o,t.otherEvent)>0&&(t.otherEvent.left=!0,o.left=!1),t.otherEvent.otherEvent=o,t.otherEvent=i,n.push(o),n.push(i),n}function w(t,e){return t[0]*e[1]-t[1]*e[0]}function b(t,e){return t[0]*e[0]+t[1]*e[1]}function x(t,e,n){var i=function(t,e,n,i,o){var r=[e[0]-t[0],e[1]-t[1]],s=[i[0]-n[0],i[1]-n[1]];function a(t,e,n){return[t[0]+e*n[0],t[1]+e*n[1]]}var h=[n[0]-t[0],n[1]-t[1]],u=w(r,s),l=u*u,c=b(r,r);if(l>0){var p=w(h,s)/u;if(p<0||p>1)return null;var f=w(h,r)/u;return f<0||f>1?null:0===p||1===p?o?null:[a(t,p,r)]:0===f||1===f?o?null:[a(n,f,s)]:[a(t,p,r)]}if((l=(u=w(h,r))*u)>0)return null;var d=b(r,h)/c,g=d+b(r,s)/c,y=Math.min(d,g),v=Math.max(d,g);return y<=1&&v>=0?1===y?o?null:[a(t,y>0?y:0,r)]:0===v?o?null:[a(t,v<1?v:1,r)]:o&&0===y&&1===v?null:[a(t,y>0?y:0,r),a(t,v<1?v:1,r)]:null}(t.point,t.otherEvent.point,e.point,e.otherEvent.point),o=i?i.length:0;if(0===o)return 0;if(1===o&&(h(t.point,e.point)||h(t.otherEvent.point,e.otherEvent.point)))return 0;if(2===o&&t.isSubject===e.isSubject)return 0;if(1===o)return h(t.point,i[0])||h(t.otherEvent.point,i[0])||_(t,i[0],n),h(e.point,i[0])||h(e.otherEvent.point,i[0])||_(e,i[0],n),1;var r=[],s=!1,a=!1;return h(t.point,e.point)?s=!0:1===m(t,e)?r.push(e,t):r.push(t,e),h(t.otherEvent.point,e.otherEvent.point)?a=!0:1===m(t.otherEvent,e.otherEvent)?r.push(e.otherEvent,t.otherEvent):r.push(t.otherEvent,e.otherEvent),s&&a||s?(e.type=1,t.type=e.inOut===t.inOut?2:3,s&&!a&&_(r[1].otherEvent,r[0].point,n),2):a?(_(r[0],r[1].point,n),3):r[0]!==r[3].otherEvent?(_(r[0],r[1].point,n),_(r[1],r[2].point,n),3):(_(r[0],r[1].point,n),_(r[3].otherEvent,r[2].point,n),3)}function C(t,e){if(t===e)return 0;if(0!==v(t.point,t.otherEvent.point,e.point)||0!==v(t.point,t.otherEvent.point,e.otherEvent.point))return h(t.point,e.point)?t.isBelow(e.otherEvent.point)?-1:1:t.point[0]===e.point[0]?t.point[1]<e.point[1]?-1:1:1===m(t,e)?e.isAbove(t.point)?-1:1:t.isBelow(e.point)?-1:1;if(t.isSubject!==e.isSubject)return t.isSubject?-1:1;var n=t.point,i=e.point;return n[0]===i[0]&&n[1]===i[1]?(n=t.otherEvent.point,i=e.otherEvent.point,n[0]===i[0]&&n[1]===i[1]?0:t.contourId>e.contourId?1:-1):1===m(t,e)?1:-1}var P=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function E(t,e,n,i){var o,r=t+1,s=e[t].point,a=e.length;for(r<a&&(o=e[r].point);r<a&&o[0]===s[0]&&o[1]===s[1];){if(!n[r])return r;o=e[++r].point}for(r=t-1;n[r]&&r>i;)r--;return r}function S(t){var e,n,i=function(t){var e,n,i,o,r=[];for(n=0,i=t.length;n<i;n++)((e=t[n]).left&&e.inResult||!e.left&&e.otherEvent.inResult)&&r.push(e);for(var s=!1;!s;)for(s=!0,n=0,i=r.length;n<i;n++)n+1<i&&1===m(r[n],r[n+1])&&(o=r[n],r[n]=r[n+1],r[n+1]=o,s=!1);for(n=0,i=r.length;n<i;n++)(e=r[n]).otherPos=n;for(n=0,i=r.length;n<i;n++)(e=r[n]).left||(o=e.otherPos,e.otherPos=e.otherEvent.otherPos,e.otherEvent.otherPos=o);return r}(t),o={},r=[],s=function(){if(!o[e]){var t=r.length,n=function(t,e,n){var i=new P;if(null!=t.prevInResult){var o=t.prevInResult,r=o.outputContourId;if(o.resultTransition>0){var s=e[r];if(null!=s.holeOf){var a=s.holeOf;e[a].holeIds.push(n),i.holeOf=a,i.depth=e[r].depth}else e[r].holeIds.push(n),i.holeOf=r,i.depth=e[r].depth+1}else i.holeOf=null,i.depth=e[r].depth}else i.holeOf=null,i.depth=0;return i}(i[e],r,t),s=function(e){o[e]=!0,i[e].outputContourId=t},a=e,h=e,u=i[e].point;for(n.points.push(u);s(a),s(a=i[a].otherPos),n.points.push(i[a].point),(a=E(a,i,o,h))!=h;);r.push(n)}};for(e=0,n=i.length;e<n;e++)s();return r}P.prototype.isExterior=function(){return null==this.holeOf};var R=k,M=k;function k(t,e){if(!(this instanceof k))return new k(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||I,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)}function I(t,e){return t<e?-1:t>e?1:0}k.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,n=this.compare,i=e[t];t>0;){var o=t-1>>1,r=e[o];if(n(i,r)>=0)break;e[t]=r,t=o}e[t]=i},_down:function(t){for(var e=this.data,n=this.compare,i=this.length>>1,o=e[t];t<i;){var r=1+(t<<1),s=r+1,a=e[r];if(s<this.length&&n(e[s],a)<0&&(r=s,a=e[s]),n(a,o)>=0)break;e[t]=a,t=r}e[t]=o}},R.default=M;var F=Math.max,A=Math.min,O=0;function T(t,e,n,i,o,r){var a,h,u,l,c,p;for(a=0,h=t.length-1;a<h;a++)if(u=t[a],l=t[a+1],c=new s(u,!1,void 0,e),p=new s(l,!1,c,e),c.otherEvent=p,u[0]!==l[0]||u[1]!==l[1]){c.contourId=p.contourId=n,r||(c.isExteriorRing=!1,p.isExteriorRing=!1),m(c,p)>0?p.left=!0:c.left=!0;var f=u[0],d=u[1];o[0]=A(o[0],f),o[1]=A(o[1],d),o[2]=F(o[2],f),o[3]=F(o[3],d),i.push(c),i.push(p)}}var L=[];function j(t,e,i){"number"==typeof t[0][0][0]&&(t=[t]),"number"==typeof e[0][0][0]&&(e=[e]);var r=function(t,e,n){var i=null;return t.length*e.length==0&&(0===n?i=L:2===n?i=t:1!==n&&3!==n||(i=0===t.length?e:t)),i}(t,e,i);if(r)return r===L?null:r;var s=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],h=function(t,e,n,i,o){var r,s,a,h,u,l,c=new R(null,m);for(a=0,h=t.length;a<h;a++)for(u=0,l=(r=t[a]).length;u<l;u++)(s=0===u)&&O++,T(r[u],!0,O,c,n,s);for(a=0,h=e.length;a<h;a++)for(u=0,l=(r=e[a]).length;u<l;u++)s=0===u,2===o&&(s=!1),s&&O++,T(r[u],!1,O,c,i,s);return c}(t,e,s,a,i);if(r=function(t,e,n,i,o){var r=null;return(n[0]>i[2]||i[0]>n[2]||n[1]>i[3]||i[1]>n[3])&&(0===o?r=L:2===o?r=t:1!==o&&3!==o||(r=t.concat(e))),r}(t,e,s,a,i))return r===L?null:r;for(var u=S(function(t,e,i,r,s,a){for(var h,u,l,c=new n(C),p=[],f=Math.min(r[2],s[2]);0!==t.length;){var d=t.pop();if(p.push(d),0===a&&d.point[0]>f||2===a&&d.point[0]>r[2])break;if(d.left){u=h=c.insert(d),h=h!==(l=c.minNode())?c.prev(h):null,u=c.next(u);var g=h?h.key:null;if(o(d,g,a),u&&2===x(d,u.key,t)&&(o(d,g,a),o(d,u.key,a)),h&&2===x(h.key,d,t)){var y=h;o(g,(y=y!==l?c.prev(y):null)?y.key:null,a),o(d,g,a)}}else d=d.otherEvent,u=h=c.find(d),h&&u&&(h=h!==l?c.prev(h):null,u=c.next(u),c.remove(d),u&&h&&x(h.key,u.key,t))}return p}(h,0,0,s,a,i)),l=[],c=0;c<u.length;c++){var p=u[c];if(p.isExterior()){for(var f=[p.points],d=0;d<p.holeIds.length;d++){var g=p.holeIds[d];f.push(u[g].points)}l.push(f)}}return l}var D={UNION:1,DIFFERENCE:2,INTERSECTION:0,XOR:3};t.diff=function(t,e){return j(t,e,2)},t.intersection=function(t,e){return j(t,e,0)},t.operations=D,t.union=function(t,e){return j(t,e,1)},t.xor=function(t,e){return j(t,e,3)},Object.defineProperty(t,"__esModule",{value:!0})}(e)},"A1R+":function(t,e,n){"use strict";t.exports=o,t.exports.default=o;var i=n("YcpW");function o(t,e){if(!(this instanceof o))return new o(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function r(t,e,n){if(!n)return e.indexOf(t);for(var i=0;i<e.length;i++)if(n(t,e[i]))return i;return-1}function s(t,e){a(t,0,t.children.length,e,t)}function a(t,e,n,i,o){o||(o=g(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(var r,s=e;s<n;s++)r=t.children[s],h(o,t.leaf?i(r):r);return o}function h(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function u(t,e){return t.minX-e.minX}function l(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function p(t){return t.maxX-t.minX+(t.maxY-t.minY)}function f(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function d(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function g(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(t,e,n,o,r){for(var s,a=[e,n];a.length;)(n=a.pop())-(e=a.pop())<=o||(s=e+Math.ceil((n-e)/o/2)*o,i(t,s,e,n,r),a.push(e,s,s,n))}o.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,n=[],i=this.toBBox;if(!d(t,e))return n;for(var o,r,s,a,h=[];e;){for(o=0,r=e.children.length;o<r;o++)s=e.children[o],d(t,a=e.leaf?i(s):s)&&(e.leaf?n.push(s):f(t,a)?this._all(s,n):h.push(s));e=h.pop()}return n},collides:function(t){var e=this.data,n=this.toBBox;if(!d(t,e))return!1;for(var i,o,r,s,a=[];e;){for(i=0,o=e.children.length;i<o;i++)if(r=e.children[i],d(t,s=e.leaf?n(r):r)){if(e.leaf||f(t,s))return!0;a.push(r)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var o=this.data;this.data=i,i=o}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=g([]),this},remove:function(t,e){if(!t)return this;for(var n,i,o,s,a=this.data,h=this.toBBox(t),u=[],l=[];a||u.length;){if(a||(a=u.pop(),i=u[u.length-1],n=l.pop(),s=!0),a.leaf&&-1!==(o=r(t,a.children,e)))return a.children.splice(o,1),u.push(a),this._condense(u),this;s||a.leaf||!f(a,h)?i?(n++,a=i.children[n],s=!1):a=null:(u.push(a),l.push(n),n=0,i=a,a=a.children[0])}return this},toBBox:function(t){return t},compareMinX:u,compareMinY:l,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},_build:function(t,e,n,i){var o,r=n-e+1,a=this._maxEntries;if(r<=a)return s(o=g(t.slice(e,n+1)),this.toBBox),o;i||(i=Math.ceil(Math.log(r)/Math.log(a)),a=Math.ceil(r/Math.pow(a,i-1))),(o=g([])).leaf=!1,o.height=i;var h,u,l,c,p=Math.ceil(r/a),f=p*Math.ceil(Math.sqrt(a));for(y(t,e,n,f,this.compareMinX),h=e;h<=n;h+=f)for(y(t,h,l=Math.min(h+f-1,n),p,this.compareMinY),u=h;u<=l;u+=p)c=Math.min(u+p-1,l),o.children.push(this._build(t,u,c,i-1));return s(o,this.toBBox),o},_chooseSubtree:function(t,e,n,i){for(var o,r,s,a,h,u,l,p,f,d;i.push(e),!e.leaf&&i.length-1!==n;){for(l=p=1/0,o=0,r=e.children.length;o<r;o++)h=c(s=e.children[o]),f=t,d=s,(u=(Math.max(d.maxX,f.maxX)-Math.min(d.minX,f.minX))*(Math.max(d.maxY,f.maxY)-Math.min(d.minY,f.minY))-h)<p?(p=u,l=h<l?h:l,a=s):u===p&&h<l&&(l=h,a=s);e=a||e.children[0]}return e},_insert:function(t,e,n){var i=this.toBBox,o=n?t:i(t),r=[],s=this._chooseSubtree(o,this.data,e,r);for(s.children.push(t),h(s,o);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(o,r,e)},_split:function(t,e){var n=t[e],i=n.children.length,o=this._minEntries;this._chooseSplitAxis(n,o,i);var r=this._chooseSplitIndex(n,o,i),a=g(n.children.splice(r,n.children.length-r));a.height=n.height,a.leaf=n.leaf,s(n,this.toBBox),s(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(n,a)},_splitRoot:function(t,e){this.data=g([t,e]),this.data.height=t.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,n){var i,o,r,s,h,u,l,p,f,d,g,y,v,m;for(u=l=1/0,i=e;i<=n-e;i++)o=a(t,0,i,this.toBBox),r=a(t,i,n,this.toBBox),f=o,d=r,g=void 0,y=void 0,v=void 0,m=void 0,g=Math.max(f.minX,d.minX),y=Math.max(f.minY,d.minY),v=Math.min(f.maxX,d.maxX),m=Math.min(f.maxY,d.maxY),s=Math.max(0,v-g)*Math.max(0,m-y),h=c(o)+c(r),s<u?(u=s,p=i,l=h<l?h:l):s===u&&h<l&&(l=h,p=i);return p},_chooseSplitAxis:function(t,e,n){var i=t.leaf?this.compareMinX:u,o=t.leaf?this.compareMinY:l;this._allDistMargin(t,e,n,i)<this._allDistMargin(t,e,n,o)&&t.children.sort(i)},_allDistMargin:function(t,e,n,i){t.children.sort(i);var o,r,s=this.toBBox,u=a(t,0,e,s),l=a(t,n-e,n,s),c=p(u)+p(l);for(o=e;o<n-e;o++)r=t.children[o],h(u,t.leaf?s(r):r),c+=p(u);for(o=n-e-1;o>=e;o--)r=t.children[o],h(l,t.leaf?s(r):r),c+=p(l);return c},_adjustParentBBoxes:function(t,e,n){for(var i=n;i>=0;i--)h(e[i],t)},_condense:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children).splice(e.indexOf(t[n]),1):this.clear():s(t[n],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},AKIq:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("/rf6");e.getCoord=function(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")},e.getCoords=function(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")},e.containsNumber=function t(e){if(e.length>1&&i.isNumber(e[0])&&i.isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return t(e[0]);throw new Error("coordinates must only contain numbers")},e.geojsonType=function(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)},e.featureOf=function(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||"Feature"!==t.type||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)},e.collectionOf=function(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||"FeatureCollection"!==t.type)throw new Error("Invalid input to "+n+", FeatureCollection required");for(var i=0,o=t.features;i<o.length;i++){var r=o[i];if(!r||"Feature"!==r.type||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}},e.getGeom=function(t){return"Feature"===t.type?t.geometry:t},e.getType=function(t,e){return"FeatureCollection"===t.type?"FeatureCollection":"GeometryCollection"===t.type?"GeometryCollection":"Feature"===t.type&&null!==t.geometry?t.geometry.type:t.type}},BQ1l:function(t,e,n){var i=n("f66B"),o=function(t){this.precision=t&&t.precision?t.precision:17,this.direction=!(!t||!t.direction)&&t.direction,this.pseudoNode=!(!t||!t.pseudoNode)&&t.pseudoNode,this.objectComparator=t&&t.objectComparator?t.objectComparator:a};function r(t){return t.coordinates.map((function(e){return{type:t.type.replace("Multi",""),coordinates:e}}))}function s(t,e){return t.hasOwnProperty("coordinates")?t.coordinates.length===e.coordinates.length:t.length===e.length}function a(t,e){return i(t,e,{strict:!0})}o.prototype.compare=function(t,e){if(t.type!==e.type||!s(t,e))return!1;switch(t.type){case"Point":return this.compareCoord(t.coordinates,e.coordinates);case"LineString":return this.compareLine(t.coordinates,e.coordinates,0,!1);case"Polygon":return this.comparePolygon(t,e);case"Feature":return this.compareFeature(t,e);default:if(0===t.type.indexOf("Multi")){var n=this,i=r(t),o=r(e);return i.every((function(t){return this.some((function(e){return n.compare(t,e)}))}),o)}}return!1},o.prototype.compareCoord=function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n].toFixed(this.precision)!==e[n].toFixed(this.precision))return!1;return!0},o.prototype.compareLine=function(t,e,n,i){if(!s(t,e))return!1;var o=this.pseudoNode?t:this.removePseudo(t),r=this.pseudoNode?e:this.removePseudo(e);if(!i||this.compareCoord(o[0],r[0])||(r=this.fixStartIndex(r,o))){var a=this.compareCoord(o[n],r[n]);return this.direction||a?this.comparePath(o,r):!!this.compareCoord(o[n],r[r.length-(1+n)])&&this.comparePath(o.slice().reverse(),r)}},o.prototype.fixStartIndex=function(t,e){for(var n,i=-1,o=0;o<t.length;o++)if(this.compareCoord(t[o],e[0])){i=o;break}return i>=0&&(n=[].concat(t.slice(i,t.length),t.slice(1,i+1))),n},o.prototype.comparePath=function(t,e){var n=this;return t.every((function(t,e){return n.compareCoord(t,this[e])}),e)},o.prototype.comparePolygon=function(t,e){if(this.compareLine(t.coordinates[0],e.coordinates[0],1,!0)){var n=t.coordinates.slice(1,t.coordinates.length),i=e.coordinates.slice(1,e.coordinates.length),o=this;return n.every((function(t){return this.some((function(e){return o.compareLine(t,e,1,!0)}))}),i)}return!1},o.prototype.compareFeature=function(t,e){return!(t.id!==e.id||!this.objectComparator(t.properties,e.properties)||!this.compareBBox(t,e))&&this.compare(t.geometry,e.geometry)},o.prototype.compareBBox=function(t,e){return!!(!t.bbox&&!e.bbox||t.bbox&&e.bbox&&this.compareCoord(t.bbox,e.bbox))},o.prototype.removePseudo=function(t){return t},t.exports=o},D3zA:function(t,e,n){"use strict";var i=n("aI7X");t.exports=Function.prototype.bind||i},DmXP:function(t,e,n){"use strict";var i=Date.prototype.getDay,o=Object.prototype.toString,r="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;t.exports=function(t){return"object"==typeof t&&null!==t&&(r?function(t){try{return i.call(t),!0}catch(t){return!1}}(t):"[object Date]"===o.call(t))}},FpZJ:function(t,e,n){"use strict";t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),n=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var i=Object.getOwnPropertySymbols(t);if(1!==i.length||i[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(t,e);if(42!==o.value||!0!==o.enumerable)return!1}return!0}},HH6Z:function(t,e,n){"use strict";var i=n("82c2").supportsDescriptors,o=n("V+xs"),r=Object.getOwnPropertyDescriptor,s=Object.defineProperty,a=TypeError,h=Object.getPrototypeOf,u=/a/;t.exports=function(){if(!i||!h)throw new a("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=o(),e=h(u),n=r(e,"flags");return n&&n.get===t||s(e,"flags",{configurable:!0,enumerable:!1,get:t}),t}},"O3R+":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("cWyK");function o(t){var e=0;if(t&&t.length>0){e+=Math.abs(r(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(r(t[n]))}return e}function r(t){var e,n,i,o,r,a,h=0,u=t.length;if(u>2){for(a=0;a<u;a++)a===u-2?(i=u-2,o=u-1,r=0):a===u-1?(i=u-1,o=0,r=1):(i=a,o=a+1,r=a+2),e=t[i],n=t[o],h+=(s(t[r][0])-s(e[0]))*Math.sin(s(n[1]));h=6378137*h*6378137/2}return h}function s(t){return t*Math.PI/180}e.default=function(t){return i.geomReduce(t,(function(t,e){return t+function(t){var e,n=0;switch(t.type){case"Polygon":return o(t.coordinates);case"MultiPolygon":for(e=0;e<t.coordinates.length;e++)n+=o(t.coordinates[e]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(e)}),0)}},OpTr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("cWyK"),o=n("AKIq"),r=n("z8fI"),s=n("sk2A"),a=n("BQ1l");e.default=function(t,e){if(!t)throw new Error("feature1 is required");if(!e)throw new Error("feature2 is required");var n=o.getType(t);if(n!==o.getType(e))throw new Error("features must be of the same type");if("Point"===n)throw new Error("Point geometry not supported");if(new a({precision:6}).compare(t,e))return!1;var h=0;switch(n){case"MultiPoint":var u=i.coordAll(t),l=i.coordAll(e);u.forEach((function(t){l.forEach((function(e){t[0]===e[0]&&t[1]===e[1]&&h++}))}));break;case"LineString":case"MultiLineString":i.segmentEach(t,(function(t){i.segmentEach(e,(function(e){r.default(t,e).features.length&&h++}))}));break;case"Polygon":case"MultiPolygon":i.segmentEach(t,(function(t){i.segmentEach(e,(function(e){s.default(t,e).features.length&&h++}))}))}return h>0}},"QJ+7":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("cWyK");e.default=function(t){var e=[1/0,1/0,-1/0,-1/0];return i.coordEach(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}},Qnnh:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("Zsd0"),o=n("AKIq"),r=n("/rf6");e.default=function(t,e,n){void 0===n&&(n={});var s=o.getGeom(t).coordinates,a=o.getGeom(e).coordinates,h=i.union(s,a);return 0===h.length?null:1===h.length?r.polygon(h[0],n.properties):r.multiPolygon(h,n.properties)}},RLeF:function(t,e,n){"use strict";var i=n("D3zA"),o=n("6ayh"),r=o("%Function.prototype.apply%"),s=o("%Function.prototype.call%"),a=o("%Reflect.apply%",!0)||i.call(s,r);t.exports=function(){return a(i,s,arguments)},t.exports.apply=function(){return a(i,r,arguments)}},RZZ2:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("AKIq");function o(t,e,n){var i=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var o=0,r=e.length-1;o<e.length;r=o++){var s=e[o][0],a=e[o][1],h=e[r][0],u=e[r][1];if(t[1]*(s-h)+a*(h-t[0])+u*(t[0]-s)==0&&(s-t[0])*(h-t[0])<=0&&(a-t[1])*(u-t[1])<=0)return!n;a>t[1]!=u>t[1]&&t[0]<(h-s)*(t[1]-a)/(u-a)+s&&(i=!i)}return i}e.default=function(t,e,n){if(void 0===n&&(n={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var r=i.getCoord(t),s=i.getGeom(e),a=s.type,h=e.bbox,u=s.coordinates;if(h&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(r,h))return!1;"Polygon"===a&&(u=[u]);for(var l=!1,c=0;c<u.length&&!l;c++)if(o(r,u[c][0],n.ignoreBoundary)){for(var p=!1,f=1;f<u[c].length&&!p;)o(r,u[c][f],!n.ignoreBoundary)&&(p=!0),f++;p||(l=!0)}return l}},UVaH:function(t,e,n){"use strict";(function(e){var i=e.Symbol,o=n("FpZJ");t.exports=function(){return"function"==typeof i&&("function"==typeof Symbol&&("symbol"==typeof i("foo")&&("symbol"==typeof Symbol("bar")&&o())))}}).call(this,n("yLpj"))},"V+xs":function(t,e,n){"use strict";var i=n("VwiP"),o=n("82c2").supportsDescriptors,r=Object.getOwnPropertyDescriptor,s=TypeError;t.exports=function(){if(!o)throw new s("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");if("gim"===/a/gim.flags){var t=r(RegExp.prototype,"flags");if(t&&"function"==typeof t.get&&"boolean"==typeof/a/.dotAll)return t.get}return i}},VwiP:function(t,e,n){"use strict";var i=Object,o=TypeError;t.exports=function(){if(null!=this&&this!==i(this))throw new o("RegExp.prototype.flags getter called on non-object");var t="";return this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.dotAll&&(t+="s"),this.unicode&&(t+="u"),this.sticky&&(t+="y"),t}},WDQk:function(t,e,n){"use strict";var i=n("1u+m");t.exports=function(){return"function"==typeof Object.is?Object.is:i}},WfG0:function(t,e,n){"use strict";n.r(e);var o=biigle.$require("annotations.ol.AttachLabelInteraction"),r=biigle.$require("core.mixins.editor"),s=biigle.$require("messages").handleErrorResponse,a=biigle.$require("keyboard"),h=biigle.$require("annotations.components.labelTooltip"),u=biigle.$require("core.mixins.loader"),l=biigle.$require("messages"),c=biigle.$require("annotations.components.mousePositionIndicator"),p=biigle.$require("projects.components.previewThumbnail"),f=biigle.$require("annotations.stores.styles"),d=biigle.$require("utils.throttle"),g=biigle.$require("annotations.ol.TranslateInteraction"),y=biigle.$require("utils.urlParams"),v={mixins:[u],mounted:function(){this.$refs.nameInput.focus()}},m={components:{previewThumbnail:p}},_=Vue.resource("api/v1/video-annotations{/id}",{},{query:{method:"GET",url:"api/v1/videos{/id}/annotations"},save:{method:"POST",url:"api/v1/videos{/id}/annotations"},split:{method:"POST",url:"api/v1/video-annotations{/id}/split"},link:{method:"POST",url:"api/v1/video-annotations{/id}/link"},attachLabel:{method:"POST",url:"api/v1/video-annotations{/id}/labels"},detachLabel:{method:"DELETE",url:"api/v1/video-annotation-labels{/id}"}});const w=void 0;function b(t){return"string"==typeof t}const x=Math,C=x.abs,P=x.min,E=x.max,S=x.floor,R=x.round,M=x.sqrt,k=x.pow,I=x.cos,F=x.asin,A=x.sin,O=x.tan,T=x.PI,L=k(2,-52);function j(){throw new Error(Array.prototype.join.call(arguments," "))}function D(t,e){for(let n in e)t.hasOwnProperty(n)||(t[n]=e[n]);return t}var G="undefined"!=typeof window&&window.navigator.userAgent;const B=/(MSIE |Trident\/|Edge\/)/i.test(G)?Array:Float32Array;function q(t){return new B(t)}function U(t,e,n,i){return M((t-n)*(t-n)+(e-i)*(e-i))}function N(t,e,n){let i=n.length;if(n[i-2]!==n[0]||n[i-1]!==n[1])return;const o=n.slice(2);let r,s;i=o.length;for(let n=0;n<i;n+=6){const i=U(t,e,o[n],o[n+1]);(s===w||i<s)&&(s=i,r=n)}!function(t,e){const n=t.length,i=n-e,o=q(e);let r;for(r=0;r<e;r++)o[r]=t[r];for(r=e;r<n;r++)t[r-e]=t[r];for(r=0;r<e;r++)t[i+r]=o[r]}(o,r),n[0]=o[i-2],n[1]=o[i-1];for(let t=0;t<o.length;t++)n[t+2]=o[t]}function V(t,e){let n=e-t.length;const i=Math.ceil(n/t.length),o=q(e);o[0]=t[0],o[1]=t[1];let r=1,s=1;for(;s<e-1;){o[++s]=t[++r],o[++s]=t[++r],o[++s]=t[++r],o[++s]=t[++r];const e=o[++s]=t[++r],a=o[++s]=t[++r];if(n)for(let t=0;t<i&&n;t++)o[s+5]=o[s+3]=o[s+1]=e,o[s+6]=o[s+4]=o[s+2]=a,s+=6,n-=6}return o}function W(t,e){return e.p-t.p}function $(t,e,n){const i=z(t),o=z(e),r=n.origin,s=r.x,a=r.y,h=r.absolute;i.length!==o.length&&("fill"===n.optimize?function t(e,n,i){const o=e.length,r=n.length;if(o<r)return t(n,e,i);n.length=o;for(let t=r;t<o;t++){const o=e[t],r=q(o.d.length);for(let t=0;t<o.d.length;t+=2)r[t]=i.absolute?i.x:o.x+o.w*i.x,r[t+1]=i.absolute?i.y:o.y+o.y*i.y;n[t]=D({d:r},o)}}(i,o,n.origin):j("optimize:none requires equal lengths"));const u=Array(2);if(u[0]=i.map(X),u[1]=o.map(X),"none"!==n.optimize)for(let t=0;t<i.length;t++){const e=i[t],n=o[t];N(h?s:e.x+e.w*s,h?a:e.y+e.h*a,u[0][t]),N(h?s:n.x+n.w*s,h?a:n.y+n.h*a,u[1][t])}return"fill"===n.optimize&&function(t,e){const n=t[0].length;for(let i=0;i<n;i++){const n=t[0][i],o=t[1][i],r=E(n.length+e,o.length+e);t[0][i]=V(n,r),t[1][i]=V(o,r)}}(u,6*n.addPoints),u}function z(t){return t.data.slice().sort(W)}function X(t){return t.d}const K={addPoints:0,optimize:"fill",origin:{x:0,y:0},precision:0};function Y(t,e){e=D(e,K),(!t||t.length<2)&&j("invalid arguments");const n=t.length-1,i=Array(n);for(let o=0;o<n;o++)i[o]=H(t[o],t[o+1],e);const o=e.precision?t=>t.toFixed(e.precision):R;return t=>{const e=n*t,r=P(S(e),n-1);return function(t,e){if(b(t))return t;let n=[];for(let i=0;i<t.length;i++){const o=t[i];let r;n.push("M",e(o[0]),e(o[1]),"C");for(let t=2;t<o.length;t+=6){const i=e(o[t]),s=e(o[t+1]),a=e(o[t+2]),h=e(o[t+3]),u=e(o[t+4]),l=e(o[t+5]);i==u&&a==u&&s==l&&h==l&&r==(r=""+i+s+a+h+u+l)||n.push(i,s,a,h,u,l)}}return n.join(" ")}(i[r]((e-r)/(r+1)),o)}}function H(t,e,n){const i=$(t,e,n),o=i[0].length;return n=>{if(C(n-0)<L)return t.path;if(C(n-1)<L)return e.path;const r=Array(o);for(let t=0;t<o;t++)r[t]=Z(i[0][t],i[1][t],n);return r}}function Z(t,e,n){const i=t.length,o=q(i);for(let r=0;r<i;r++)o[r]=t[r]+(e[r]-t[r])*n;return o}function J(t,e){return t===w?e:t}const Q=120*T/180,tt=2*T;function et(t,e,n,i,o,r,s,a,h,u,l,c,p){if(n<=0||i<=0)return[t,e,a,h,a,h];const f=T/180*(+o||0),d=I(f),g=A(f),y=!!u;if(!y){const o=t,f=a,y=((t=o*d-e*-g)-(a=f*d-h*-g))/2,v=((e=o*-g+e*d)-(h=f*-g+h*d))/2;let m=y*y/(n*n)+v*v/(i*i);m>1&&(m=M(m),n*=m,i*=m);const _=(r===s?-1:1)*M(C((n*n*i*i-n*n*v*v-i*i*y*y)/(n*n*v*v+i*i*y*y)));c=_*n*v/i+(t+a)/2,u=F((e-(p=_*-i*y/n+(e+h)/2))/i),l=F((h-p)/i),t<c&&(u=T-u),a<c&&(l=T-l),u<0&&(u+=tt),l<0&&(l+=tt),s&&u>l&&(u-=tt),!s&&l>u&&(l-=tt)}let v;if(C(l-u)>Q){const t=l,e=a,r=h;v=et(a=c+n*I(l=u+Q*(s&&l>u?1:-1)),h=p+i*A(l),n,i,o,0,s,e,r,l,t,c,p)}else v=[];const m=4/3*O((l-u)/4);if(v.splice(0,0,2*t-(t+m*n*A(u)),2*e-(e-m*i*I(u)),a+m*n*A(l),h-m*i*I(l),a,h),!y)for(let t=0,e=v.length;t<e;t+=2){const e=v[t],n=v[t+1];v[t]=e*d-n*g,v[t+1]=e*g+n*d}return v}const nt={M:2,H:1,V:1,L:2,Z:0,C:6,S:4,Q:4,T:2,A:7};function it(t,e,n,i,o,r,s){const a=t.x,h=t.y;t.x=J(r,a),t.y=J(s,h),t.p.push(J(e,a),n=J(n,h),i=J(i,a),o=J(o,h),t.x,t.y),t.lc=t.c}function ot(t){const e=t.c,n=t.t,i=t.x,o=t.y;if("V"===e)n[0]+=o;else if("H"===e)n[0]+=i;else if("A"===e)n[5]+=i,n[6]+=o;else for(let t=0;t<n.length;t+=2)n[t]+=i,n[t+1]+=o}function rt(t){return t.split(" ").map(st)}function st(t,e){return 0===e?t:+t}function at(t){const e={x:0,y:0,s:[]},n=function(t){return t.replace(/[\^\s]*([mhvlzcsqta]|\-?\d*\.?\d+)[,\$\s]*/gi," $1").replace(/([mhvlzcsqta])/gi," $1").trim().split("  ").map(rt)}(t);for(let t=0;t<n.length;t++){const i=n[t],o=i[0],r=o.toUpperCase(),s="Z"!==r&&r!==o;e.c=r;const a=nt[r],h=i;let u=1;do{e.t=1===h.length?h:h.slice(u,u+a),s&&ot(e);const t=e.t,n=e.x,i=e.y;let o,l,c,p,f,d;if("M"===r)e.s.push(e.p=[e.x=t[0],e.y=t[1]]);else if("H"===r)it(e,w,w,w,w,t[0],w);else if("V"===r)it(e,w,w,w,w,w,t[0]);else if("L"===r)it(e,w,w,w,w,t[0],t[1]);else if("Z"===r)it(e,w,w,w,w,e.p[0],e.p[1]);else if("C"===r)it(e,t[0],t[1],t[2],t[3],t[4],t[5]),e.cx=t[2],e.cy=t[3];else if("S"===r){const r="S"!==e.lc&&"C"!==e.lc;o=r?w:2*n-e.cx,l=r?w:2*i-e.cy,it(e,o,l,t[0],t[1],t[2],t[3]),e.cx=t[0],e.cy=t[1]}else if("Q"===r){const o=t[0],r=t[1];c=t[2],p=t[3],it(e,n+2/3*(o-n),i+2/3*(r-i),c+2/3*(o-c),p+2/3*(r-p),c,p),e.cx=o,e.cy=r}else if("T"===r)c=t[0],p=t[1],"Q"===e.lc||"T"===e.lc?(o=n+(2*n-e.cx-n)*(2/3),l=i+(2*i-e.cy-i)*(2/3),f=c+(2*n-e.cx-c)*(2/3),d=p+(2*i-e.cy-p)*(2/3)):(o=f=n,l=d=i),it(e,o,l,f,d,c,p),e.cx=f,e.cy=d;else if("A"===r){const o=et(n,i,t[0],t[1],t[2],t[3],t[4],t[5],t[6]);for(let t=0;t<o.length;t+=6)it(e,o[t],o[t+1],o[t+2],o[t+3],o[t+4],o[t+5])}else j(e.c," is not supported");u+=a}while(u<h.length)}return e.s}function ht(t){const e=t.length;let n=t[e-2],i=t[e-1],o=0;for(let r=0;r<e;r+=6)o+=U(t[r],t[r+1],n,i),n=t[r],i=t[r+1];return S(o)}function ut(t){let e=t[0],n=t[1],i=n,o=e;for(let r=2;r<t.length;r+=6){let s=t[r+4],a=t[r+5];e=P(e,s),o=E(o,s),n=P(n,a),i=E(i,a)}return{d:t,x:e,y:n,w:o-e,h:i-n,p:ht(t)}}const lt=/^([#|\.]|path)/i;function ct(t){return function(t){return{path:t,data:at(t).map(ut)}}(function(t){if(b(t)){if(!lt.test(t))return t;t=document.querySelector(t)}return t.getAttribute("d")}(t))}var pt=Vue.extend({data:function(){return{id:0,frames:[],points:[],video_id:0,shape_id:0,created_at:"",updated_at:"",labels:[],selected:!1,revision:1,tracking:!1}},computed:{startFrame:function(){return this.frames[0]},endFrame:function(){return this.frames[this.frames.length-1]},interpolationPoints:function(){switch(this.shape){case"Rectangle":case"Ellipse":return this.points.map(this.rectangleToInterpolationPoints);case"LineString":case"Polygon":return this.points.map(this.polygonToSvgPath);default:return this.points}},gapRanges:function(){var t=[];return this.frames.map((function(e,n,i){null===e&&t.push([i[n-1],i[n+1]])})),t},isSelected:function(){return!1!==this.selected},isClip:function(){return this.frames.length>1}},methods:{startPollTracking:function(){this.tracking=!0,this.continuePollTracking()},pollTracking:function(){_.get({id:this.id}).then(this.maybeFinishPollTracking,this.cancelPollTracking)},maybeFinishPollTracking:function(t){var e=t.body;e.frames.length>1?(this.tracking=!1,this.frames=e.frames,this.points=e.points):this.continuePollTracking()},continuePollTracking:function(){this.pollTimeout=window.setTimeout(this.pollTracking,5e3)},cancelPollTracking:function(){l.danger("Tracking of annotation ".concat(this.id," failed.")),this.tracking=!1,this.$emit("tracking-failed",this)},interpolatePoints:function(t){if(t<this.startFrame||t>this.endFrame)return[];if(this.hasGapAt(t))return[];for(var e=this.frames,n=e.length-1;n>=0&&!(e[n]<=t&&null!==e[n]);n--);if(e[n]===t)return this.points[n];var i=(t-e[n])/(e[n+1]-e[n]);return this.interpolateBetweenFrames(n,n+1,i)},interpolateBetweenFrames:function(t,e,n){var i=this.interpolationPoints[t],o=this.interpolationPoints[e];switch(this.shape){case"Rectangle":case"Ellipse":return this.interpolationPointsToRectangle(this.interpolateNaive(i,o,n));case"LineString":case"Polygon":return this.interpolatePolymorph(i,o,n);default:return this.interpolateNaive(i,o,n)}},interpolateNaive:function(t,e,n){return t.map((function(t,i){return t+(e[i]-t)*n}))},interpolatePolymorph:function(t,e,n){var i;return Y([t,e].map(ct),i||{})(n).replace(/[MCL\s]+/g," ").trim().split(" ").map((function(t){return parseInt(t,10)}))},rectangleToInterpolationPoints:function(t){var e=[t[2]-t[0],t[3]-t[1]],n=[t[6]-t[0],t[7]-t[1]],i=Math.sqrt(n[0]*n[0]+n[1]*n[1]),o=Math.sqrt(e[0]*e[0]+e[1]*e[1]),r=[e[0]/o,e[1]/o],s=[(t[0]+t[2]+t[4]+t[6])/4,(t[1]+t[3]+t[5]+t[7])/4];return[s[0],s[1],r[0],r[1],i,o]},interpolationPointsToRectangle:function(t){var e=[t[2],t[3]],n=[-e[1],e[0]],i=t[4]/2*n[0],o=t[4]/2*n[1],r=t[5]/2*e[0],s=t[5]/2*e[1];return[t[0]-r-i,t[1]-s-o,t[0]+r-i,t[1]+s-o,t[0]+r+i,t[1]+s+o,t[0]-r+i,t[1]-s+o]},polygonToSvgPath:function(t){return(t=t.slice()).unshift("M"),t.splice(3,0,"L"),t.join(" ")},hasGapAt:function(t){if(t<this.startFrame||t>this.endFrame)return!1;for(var e=this.gapRanges.length-1;e>=0;e--)if(this.gapRanges[e][0]<t&&this.gapRanges[e][1]>t)return!0;return!1},detachAnnotationLabel:function(t){var e=this.labels.indexOf(t);return-1!==e&&this.labels.splice(e,1),_.detachLabel({id:t.id})},attachAnnotationLabel:function(t){return _.attachLabel({id:this.id},{label_id:t.id}).then(this.handleAttachedLabel)},handleAttachedLabel:function(t){return this.labels.push(t.body),t},hasKeyframe:function(t){return-1!==this.frames.indexOf(t)},modify:function(t,e){var n=this.frames.indexOf(t);if(-1!==n)this.points.splice(n,1,e);else{for(var o=this.frames.length-1;o>=0&&!(this.frames[o]<=t);o--);this.frames.splice(i+1,0,t),this.points.splice(i+1,0,e)}return _.update({id:this.id},{frames:this.frames,points:this.points})},split:function(t){return _.split({id:this.id},{time:t}).then(this.handleFinishedSplit)},handleFinishedSplit:function(t){return this.frames=t.body[0].frames,this.points=t.body[0].points,t.body=t.body[1],t},link:function(t){return _.link({id:this.id},{annotation_id:t.id}).then(this.handleFinishedLink)},handleFinishedLink:function(t){return this.frames=t.body.frames,this.points=t.body.points,this.labels=t.body.labels,t},deleteKeyframe:function(t){var e=this.frames.indexOf(t);return-1!==e?(this.frames.splice(e,1),this.points.splice(e,1),_.update({id:this.id},{frames:this.frames,points:this.points})):Vue.Promise.reject("Unknown keyframe ".concat(t," of annotation ").concat(this.id))},delete:function(){return _.delete({id:this.id})}},watch:{points:function(t){this.revision+=1}},created:function(){this.shape=biigle.$require("videos.shapes")[this.shape_id]}});function ft(){return function(){throw new Error("Unimplemented abstract method.")}()}var dt=0;function gt(t){return t.ol_uid||(t.ol_uid=String(++dt))}var yt=function(t){function e(e){var n="Assertion failed. See https://openlayers.org/en/"+("v"+"5.3.0".split("-")[0])+"/doc/errors/#"+e+" for details.";t.call(this,n),this.code=e,this.name="AssertionError",this.message=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error);function vt(t,e){if(!t)throw new yt(e)}var mt=0,_t=1,wt=2,bt=4,xt=8,Ct=16;function Pt(t){for(var e=kt(),n=0,i=t.length;n<i;++n)Lt(e,t[n]);return e}function Et(t,e,n){var i,o;return(i=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0)*i+(o=n<t[1]?t[1]-n:t[3]<n?n-t[3]:0)*o}function St(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function Rt(t,e,n){return t[0]<=e&&e<=t[2]&&t[1]<=n&&n<=t[3]}function Mt(t,e){var n=t[0],i=t[1],o=t[2],r=t[3],s=e[0],a=e[1],h=mt;return s<n?h|=Ct:s>o&&(h|=bt),a<i?h|=xt:a>r&&(h|=wt),h===mt&&(h=_t),h}function kt(){return[1/0,1/0,-1/0,-1/0]}function It(t,e,n,i,o){return o?(o[0]=t,o[1]=e,o[2]=n,o[3]=i,o):[t,e,n,i]}function Ft(t){return It(1/0,1/0,-1/0,-1/0,t)}function At(t,e){var n=t[0],i=t[1];return It(n,i,n,i,e)}function Ot(t,e,n,i,o){return jt(Ft(o),t,e,n,i)}function Tt(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function Lt(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function jt(t,e,n,i,o){for(;n<i;n+=o)Dt(t,e[n],e[n+1]);return t}function Dt(t,e,n){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],n),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],n)}function Gt(t,e,n){var i;return(i=e.call(n,Bt(t)))||(i=e.call(n,qt(t)))||(i=e.call(n,$t(t)))?i:(i=e.call(n,Wt(t)))||!1}function Bt(t){return[t[0],t[1]]}function qt(t){return[t[2],t[1]]}function Ut(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function Nt(t){return t[3]-t[1]}function Vt(t,e,n){var i=n||[1/0,1/0,-1/0,-1/0];return Xt(t,e)?(t[0]>e[0]?i[0]=t[0]:i[0]=e[0],t[1]>e[1]?i[1]=t[1]:i[1]=e[1],t[2]<e[2]?i[2]=t[2]:i[2]=e[2],t[3]<e[3]?i[3]=t[3]:i[3]=e[3]):Ft(i),i}function Wt(t){return[t[0],t[3]]}function $t(t){return[t[2],t[3]]}function zt(t){return t[2]-t[0]}function Xt(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function Kt(t){return t[2]<t[0]||t[3]<t[1]}var Yt="Point",Ht="LineString",Zt="LinearRing",Jt="Polygon",Qt="MultiPoint",te="MultiLineString",ee="MultiPolygon",ne="GeometryCollection",ie="Circle",oe="Rectangle",re="Ellipse",se="propertychange",ae="function"==typeof Object.assign?Object.assign:function(t,e){var n=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),o=1,r=arguments.length;o<r;++o){var s=n[o];if(null!=s)for(var a in s)s.hasOwnProperty(a)&&(i[a]=s[a])}return i};function he(t){for(var e in t)delete t[e]}function ue(t){var e=[];for(var n in t)e.push(t[n]);return e}function le(t){var e;for(e in t)return!1;return!e}function ce(t,e,n,i){for(var o,r=0,s=t.length;r<s;++r)if((o=t[r]).listener===e&&o.bindTo===n)return i&&(o.deleteIndex=r),o}function pe(t,e){var n=fe(t);return n?n[e]:void 0}function fe(t,e){var n=t.ol_lm;return!n&&e&&(n=t.ol_lm={}),n}function de(t,e){var n=pe(t,e);if(n){for(var i=0,o=n.length;i<o;++i)t.removeEventListener(e,n[i].boundListener),he(n[i]);n.length=0;var r=fe(t);r&&(delete r[e],0===Object.keys(r).length&&function(t){delete t.ol_lm}(t))}}function ge(t,e,n,i,o){var r=fe(t,!0),s=r[e];s||(s=r[e]=[]);var a=ce(s,n,i,!1);return a?o||(a.callOnce=!1):(a={bindTo:i,callOnce:!!o,listener:n,target:t,type:e},t.addEventListener(e,function(t){var e=function(e){var n=t.listener,i=t.bindTo||t.target;return t.callOnce&&me(t),n.call(i,e)};return t.boundListener=e,e}(a)),s.push(a)),a}function ye(t,e,n,i){return ge(t,e,n,i,!0)}function ve(t,e,n,i){var o=pe(t,e);if(o){var r=ce(o,n,i,!0);r&&me(r)}}function me(t){if(t&&t.target){t.target.removeEventListener(t.type,t.boundListener);var e=pe(t.target,t.type);if(e){var n="deleteIndex"in t?t.deleteIndex:e.indexOf(t);-1!==n&&e.splice(n,1),0===e.length&&de(t.target,t.type)}he(t)}}var _e=function(){this.disposed_=!1};_e.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())},_e.prototype.disposeInternal=function(){};var we=_e;function be(){return!0}function xe(){return!1}function Ce(){}var Pe=function(t){this.propagationStopped,this.type=t,this.target=null};Pe.prototype.preventDefault=function(){this.propagationStopped=!0},Pe.prototype.stopPropagation=function(){this.propagationStopped=!0};var Ee=Pe,Se=function(t){function e(){t.call(this),this.pendingRemovals_={},this.dispatching_={},this.listeners_={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addEventListener=function(t,e){var n=this.listeners_[t];n||(n=this.listeners_[t]=[]),-1===n.indexOf(e)&&n.push(e)},e.prototype.dispatchEvent=function(t){var e="string"==typeof t?new Ee(t):t,n=e.type;e.target=this;var i,o=this.listeners_[n];if(o){n in this.dispatching_||(this.dispatching_[n]=0,this.pendingRemovals_[n]=0),++this.dispatching_[n];for(var r=0,s=o.length;r<s;++r)if(!1===o[r].call(this,e)||e.propagationStopped){i=!1;break}if(--this.dispatching_[n],0===this.dispatching_[n]){var a=this.pendingRemovals_[n];for(delete this.pendingRemovals_[n];a--;)this.removeEventListener(n,Ce);delete this.dispatching_[n]}return i}},e.prototype.disposeInternal=function(){!function(t){var e=fe(t);if(e)for(var n in e)de(t,n)}(this)},e.prototype.getListeners=function(t){return this.listeners_[t]},e.prototype.hasListener=function(t){return t?t in this.listeners_:Object.keys(this.listeners_).length>0},e.prototype.removeEventListener=function(t,e){var n=this.listeners_[t];if(n){var i=n.indexOf(e);t in this.pendingRemovals_?(n[i]=Ce,++this.pendingRemovals_[t]):(n.splice(i,1),0===n.length&&delete this.listeners_[t])}},e}(we),Re="change",Me="clear",ke="contextmenu",Ie="click",Fe="dblclick",Ae="mousewheel",Oe="wheel";var Te=function(t){function e(){t.call(this),this.revision_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.changed=function(){++this.revision_,this.dispatchEvent(Re)},e.prototype.getRevision=function(){return this.revision_},e.prototype.on=function(t,e){if(Array.isArray(t)){for(var n=t.length,i=new Array(n),o=0;o<n;++o)i[o]=ge(this,t[o],e);return i}return ge(this,t,e)},e.prototype.once=function(t,e){if(Array.isArray(t)){for(var n=t.length,i=new Array(n),o=0;o<n;++o)i[o]=ye(this,t[o],e);return i}return ye(this,t,e)},e.prototype.un=function(t,e){if(Array.isArray(t))for(var n=0,i=t.length;n<i;++n)ve(this,t[n],e);else ve(this,t,e)},e}(Se),Le=function(t){function e(e,n,i){t.call(this,e),this.key=n,this.oldValue=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ee),je={};function De(t){return je.hasOwnProperty(t)?je[t]:je[t]="change:"+t}var Ge=function(t){function e(e){t.call(this),gt(this),this.values_={},void 0!==e&&this.setProperties(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){var e;return this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e},e.prototype.getKeys=function(){return Object.keys(this.values_)},e.prototype.getProperties=function(){return ae({},this.values_)},e.prototype.notify=function(t,e){var n;n=De(t),this.dispatchEvent(new Le(n,t,e)),n=se,this.dispatchEvent(new Le(n,t,e))},e.prototype.set=function(t,e,n){if(n)this.values_[t]=e;else{var i=this.values_[t];this.values_[t]=e,i!==e&&this.notify(t,i)}},e.prototype.setProperties=function(t,e){for(var n in t)this.set(n,t[n],e)},e.prototype.unset=function(t,e){if(t in this.values_){var n=this.values_[t];delete this.values_[t],e||this.notify(t,n)}},e}(Te);function Be(t,e,n,i,o,r){for(var s=r||[],a=0,h=e;h<n;h+=i){var u=t[h],l=t[h+1];s[a++]=o[0]*u+o[2]*l+o[4],s[a++]=o[1]*u+o[3]*l+o[5]}return r&&s.length!=a&&(s.length=a),s}function qe(t,e,n){return Math.min(Math.max(t,e),n)}var Ue="cosh"in Math?Math.cosh:function(t){var e=Math.exp(t);return(e+1/e)/2};function Ne(t,e,n,i,o,r){var s=o-n,a=r-i;if(0!==s||0!==a){var h=((t-n)*s+(e-i)*a)/(s*s+a*a);h>1?(n=o,i=r):h>0&&(n+=s*h,i+=a*h)}return Ve(t,e,n,i)}function Ve(t,e,n,i){var o=n-t,r=i-e;return o*o+r*r}function We(t){return t*Math.PI/180}function $e(t,e){var n=t%e;return n*e<0?n+e:n}function ze(t,e,n){return t+n*(e-t)}function Xe(t,e,n){var i=n||6371008.8,o=We(t[1]),r=We(e[1]),s=(r-o)/2,a=We(e[0]-t[0])/2,h=Math.sin(s)*Math.sin(s)+Math.sin(a)*Math.sin(a)*Math.cos(o)*Math.cos(r);return 2*i*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))}var Ke={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},Ye={};Ye[Ke.DEGREES]=2*Math.PI*6370997/360,Ye[Ke.FEET]=.3048,Ye[Ke.METERS]=1,Ye[Ke.USFEET]=1200/3937;var He=Ke,Ze=function(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit};Ze.prototype.canWrapX=function(){return this.canWrapX_},Ze.prototype.getCode=function(){return this.code_},Ze.prototype.getExtent=function(){return this.extent_},Ze.prototype.getUnits=function(){return this.units_},Ze.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||Ye[this.units_]},Ze.prototype.getWorldExtent=function(){return this.worldExtent_},Ze.prototype.getAxisOrientation=function(){return this.axisOrientation_},Ze.prototype.isGlobal=function(){return this.global_},Ze.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)},Ze.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},Ze.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},Ze.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)},Ze.prototype.setWorldExtent=function(t){this.worldExtent_=t},Ze.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},Ze.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_};var Je=Ze,Qe=6378137*Math.PI,tn=[-Qe,-Qe,Qe,Qe],en=[-180,-85,180,85],nn=function(t){function e(e){t.call(this,{code:e,units:He.METERS,extent:tn,global:!0,worldExtent:en,getPointResolution:function(t,e){return t/Ue(e[1]/6378137)}})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Je),on=[new nn("EPSG:3857"),new nn("EPSG:102100"),new nn("EPSG:102113"),new nn("EPSG:900913"),new nn("urn:ogc:def:crs:EPSG:6.18:3:3857"),new nn("urn:ogc:def:crs:EPSG::3857"),new nn("http://www.opengis.net/gml/srs/epsg.xml#3857")];function rn(t,e,n){var i=t.length,o=n>1?n:2,r=e;void 0===r&&(r=o>2?t.slice():new Array(i));for(var s=Qe,a=0;a<i;a+=o){r[a]=s*t[a]/180;var h=6378137*Math.log(Math.tan(Math.PI*(t[a+1]+90)/360));h>s?h=s:h<-s&&(h=-s),r[a+1]=h}return r}function sn(t,e,n){var i=t.length,o=n>1?n:2,r=e;void 0===r&&(r=o>2?t.slice():new Array(i));for(var s=0;s<i;s+=o)r[s]=180*t[s]/Qe,r[s+1]=360*Math.atan(Math.exp(t[s+1]/6378137))/Math.PI-90;return r}var an=[-180,-90,180,90],hn=6378137*Math.PI/180,un=function(t){function e(e,n){t.call(this,{code:e,units:He.DEGREES,extent:an,axisOrientation:n,global:!0,metersPerUnit:hn,worldExtent:an})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Je),ln=[new un("CRS:84"),new un("EPSG:4326","neu"),new un("urn:ogc:def:crs:EPSG::4326","neu"),new un("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new un("urn:ogc:def:crs:OGC:1.3:CRS84"),new un("urn:ogc:def:crs:OGC:2:84"),new un("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new un("urn:x-ogc:def:crs:EPSG:4326","neu")],cn={};var pn,fn,dn,gn={};function yn(t,e,n){var i=t.getCode(),o=e.getCode();i in gn||(gn[i]={}),gn[i][o]=n}function vn(t,e,n){var i;if(void 0!==e){for(var o=0,r=t.length;o<r;++o)e[o]=t[o];i=e}else i=t.slice();return i}function mn(t,e,n){if(void 0!==e&&t!==e){for(var i=0,o=t.length;i<o;++i)e[i]=t[i];t=e}return t}function _n(t){!function(t,e){cn[t]=e}(t.getCode(),t),yn(t,t,vn)}function wn(t){return"string"==typeof t?cn[t]||null:t||null}function bn(t,e,n,i){var o,r=(t=wn(t)).getPointResolutionFunc();if(r)o=r(e,n);else if(t.getUnits()==He.DEGREES&&!i||i==He.DEGREES)o=e;else{var s=En(t,wn("EPSG:4326")),a=[n[0]-e/2,n[1],n[0]+e/2,n[1],n[0],n[1]-e/2,n[0],n[1]+e/2];o=(Xe((a=s(a,a,2)).slice(0,2),a.slice(2,4))+Xe(a.slice(4,6),a.slice(6,8)))/2;var h=i?Ye[i]:t.getMetersPerUnit();void 0!==h&&(o/=h)}return o}function xn(t){!function(t){t.forEach(_n)}(t),t.forEach((function(e){t.forEach((function(t){e!==t&&yn(e,t,vn)}))}))}function Cn(t,e){return t?"string"==typeof t?wn(t):t:wn(e)}function Pn(t,e){if(t===e)return!0;var n=t.getUnits()===e.getUnits();return(t.getCode()===e.getCode()||En(t,e)===vn)&&n}function En(t,e){var n=function(t,e){var n;return t in gn&&e in gn[t]&&(n=gn[t][e]),n}(t.getCode(),e.getCode());return n||(n=mn),n}function Sn(t,e){return En(wn(t),wn(e))}function Rn(t,e,n){return Sn(e,n)(t,void 0,t.length)}xn(on),xn(ln),pn=on,fn=rn,dn=sn,ln.forEach((function(t){pn.forEach((function(e){yn(t,e,fn),yn(e,t,dn)}))}));new Array(6);var Mn=[1,0,0,1,0,0],kn="XY",In="XYZ",Fn="XYM",An="XYZM";function On(t){var e;return t==kn?e=2:t==In||t==Fn?e=3:t==An&&(e=4),e}var Tn=function(t){function e(){t.call(this),this.layout=kn,this.stride=2,this.flatCoordinates=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeExtent=function(t){return Ot(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinates=function(){return ft()},e.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},e.prototype.getFlatCoordinates=function(){return this.flatCoordinates},e.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},e.prototype.getLayout=function(){return this.layout},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!=this.getRevision()&&(he(this.simplifiedGeometryCache),this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=t.toString();if(this.simplifiedGeometryCache.hasOwnProperty(e))return this.simplifiedGeometryCache[e];var n=this.getSimplifiedGeometryInternal(t);return n.getFlatCoordinates().length<this.flatCoordinates.length?(this.simplifiedGeometryCache[e]=n,n):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)},e.prototype.getSimplifiedGeometryInternal=function(t){return this},e.prototype.getStride=function(){return this.stride},e.prototype.setFlatCoordinates=function(t,e){this.stride=On(t),this.layout=t,this.flatCoordinates=e},e.prototype.setCoordinates=function(t,e){ft()},e.prototype.setLayout=function(t,e,n){var i;if(t)i=On(t);else{for(var o=0;o<n;++o){if(0===e.length)return this.layout=kn,void(this.stride=2);e=e[0]}t=function(t){var e;2==t?e=kn:3==t?e=In:4==t&&(e=An);return e}(i=e.length)}this.layout=t,this.stride=i},e.prototype.applyTransform=function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},e.prototype.rotate=function(t,e){var n=this.getFlatCoordinates();if(n){var i=this.getStride();!function(t,e,n,i,o,r,s){for(var a=s||[],h=Math.cos(o),u=Math.sin(o),l=r[0],c=r[1],p=0,f=e;f<n;f+=i){var d=t[f]-l,g=t[f+1]-c;a[p++]=l+d*h-g*u,a[p++]=c+d*u+g*h;for(var y=f+2;y<f+i;++y)a[p++]=t[y]}s&&a.length!=p&&(a.length=p)}(n,0,n.length,i,t,e,n),this.changed()}},e.prototype.scale=function(t,e,n){var i=e;void 0===i&&(i=t);var o=n;o||(o=Ut(this.getExtent()));var r=this.getFlatCoordinates();if(r){var s=this.getStride();!function(t,e,n,i,o,r,s,a){for(var h=a||[],u=s[0],l=s[1],c=0,p=e;p<n;p+=i){var f=t[p]-u,d=t[p+1]-l;h[c++]=u+o*f,h[c++]=l+r*d;for(var g=p+2;g<p+i;++g)h[c++]=t[g]}a&&h.length!=c&&(h.length=c)}(r,0,r.length,s,t,i,o,r),this.changed()}},e.prototype.translate=function(t,e){var n=this.getFlatCoordinates();if(n){var i=this.getStride();!function(t,e,n,i,o,r,s){for(var a=s||[],h=0,u=e;u<n;u+=i){a[h++]=t[u]+o,a[h++]=t[u+1]+r;for(var l=u+2;l<u+i;++l)a[h++]=t[l]}s&&a.length!=h&&(a.length=h)}(n,0,n.length,i,t,e,n),this.changed()}},e}(function(t){function e(){t.call(this),this.extent_=[1/0,1/0,-1/0,-1/0],this.extentRevision_=-1,this.simplifiedGeometryCache={},this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return ft()},e.prototype.closestPointXY=function(t,e,n,i){return ft()},e.prototype.containsXY=function(t,e){return!1},e.prototype.getClosestPoint=function(t,e){var n=e||[NaN,NaN];return this.closestPointXY(t[0],t[1],n,1/0),n},e.prototype.intersectsCoordinate=function(t){return this.containsXY(t[0],t[1])},e.prototype.computeExtent=function(t){return ft()},e.prototype.getExtent=function(t){return this.extentRevision_!=this.getRevision()&&(this.extent_=this.computeExtent(this.extent_),this.extentRevision_=this.getRevision()),function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t}(this.extent_,t)},e.prototype.rotate=function(t,e){ft()},e.prototype.scale=function(t,e,n){ft()},e.prototype.simplify=function(t){return this.getSimplifiedGeometry(t*t)},e.prototype.getSimplifiedGeometry=function(t){return ft()},e.prototype.getType=function(){return ft()},e.prototype.applyTransform=function(t){ft()},e.prototype.intersectsExtent=function(t){return ft()},e.prototype.translate=function(t,e){ft()},e.prototype.transform=function(t,e){var n=wn(t),i=n.getUnits()==He.TILE_PIXELS?function(t,i,o){var r=n.getExtent(),s=n.getWorldExtent(),a=Nt(s)/Nt(r);return function(t,e,n,i,o,r,s,a){var h=Math.sin(r),u=Math.cos(r);t[0]=i*u,t[1]=o*h,t[2]=-i*h,t[3]=o*u,t[4]=s*i*u-a*i*h+e,t[5]=s*o*h+a*o*u+n}(Mn,s[0],s[3],a,-a,0,0,0),Be(t,0,t.length,o,Mn,i),Sn(n,e)(t,i,o)}:Sn(n,e);return this.applyTransform(i),this},e}(Ge));function Ln(t,e,n,i){for(var o=0,r=n.length;o<r;++o)t[e++]=n[o];return e}function jn(t,e,n,i){for(var o=0,r=n.length;o<r;++o)for(var s=n[o],a=0;a<i;++a)t[e++]=s[a];return e}function Dn(t,e,n,i,o){for(var r=o||[],s=0,a=0,h=n.length;a<h;++a){var u=jn(t,e,n[a],i);r[s++]=u,e=u}return r.length=s,r}var Gn=function(t){function e(e,n,i){if(t.call(this),void 0!==i&&void 0===n)this.setFlatCoordinates(i,e);else{var o=n||0;this.setCenterAndRadius(e,o,i)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),void 0,this.layout)},e.prototype.closestPointXY=function(t,e,n,i){var o=this.flatCoordinates,r=t-o[0],s=e-o[1],a=r*r+s*s;if(a<i){if(0===a)for(var h=0;h<this.stride;++h)n[h]=o[h];else{var u=this.getRadius()/Math.sqrt(a);n[0]=o[0]+u*r,n[1]=o[1]+u*s;for(var l=2;l<this.stride;++l)n[l]=o[l]}return n.length=this.stride,a}return i},e.prototype.containsXY=function(t,e){var n=this.flatCoordinates,i=t-n[0],o=e-n[1];return i*i+o*o<=this.getRadiusSquared_()},e.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},e.prototype.computeExtent=function(t){var e=this.flatCoordinates,n=e[this.stride]-e[0];return It(e[0]-n,e[1]-n,e[0]+n,e[1]+n,t)},e.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())},e.prototype.getRadiusSquared_=function(){var t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e},e.prototype.getType=function(){return ie},e.prototype.intersectsExtent=function(t){if(Xt(t,this.getExtent())){var e=this.getCenter();return t[0]<=e[0]&&t[2]>=e[0]||(t[1]<=e[1]&&t[3]>=e[1]||Gt(t,this.intersectsCoordinate,this))}return!1},e.prototype.setCenter=function(t){var e=this.stride,n=this.flatCoordinates[e]-this.flatCoordinates[0],i=t.slice();i[e]=i[0]+n;for(var o=1;o<e;++o)i[e+o]=t[o];this.setFlatCoordinates(this.layout,i),this.changed()},e.prototype.setCenterAndRadius=function(t,e,n){this.setLayout(n,t,0),this.flatCoordinates||(this.flatCoordinates=[]);var i=this.flatCoordinates,o=Ln(i,0,t,this.stride);i[o++]=i[0]+e;for(var r=1,s=this.stride;r<s;++r)i[o++]=i[r];i.length=o,this.changed()},e.prototype.getCoordinates=function(){return null},e.prototype.setCoordinates=function(t,e){},e.prototype.setRadius=function(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()},e}(Tn);Gn.prototype.transform;var Bn=Gn;function qn(t,e){return t>e?1:t<e?-1:0}function Un(t,e){return t.indexOf(e)>=0}function Nn(t,e,n){var i,o=t.length;if(t[0]<=e)return 0;if(e<=t[o-1])return o-1;if(n>0){for(i=1;i<o;++i)if(t[i]<e)return i-1}else if(n<0){for(i=1;i<o;++i)if(t[i]<=e)return i}else for(i=1;i<o;++i){if(t[i]==e)return i;if(t[i]<e)return t[i-1]-e<e-t[i]?i-1:i}return o-1}function Vn(t,e){for(var n=Array.isArray(e)?e:[e],i=n.length,o=0;o<i;o++)t[t.length]=n[o]}function Wn(t,e,n,i){for(var o=0,r=t[n-i],s=t[n-i+1];e<n;e+=i){var a=t[e],h=t[e+1];o+=s*a-r*h,r=a,s=h}return o/2}function $n(t,e,n,i){for(var o=0,r=0,s=n.length;r<s;++r){var a=n[r];o+=Wn(t,e,a,i),e=a}return o}function zn(t,e,n,i,o,r,s){var a,h=t[e],u=t[e+1],l=t[n]-h,c=t[n+1]-u;if(0===l&&0===c)a=e;else{var p=((o-h)*l+(r-u)*c)/(l*l+c*c);if(p>1)a=n;else{if(p>0){for(var f=0;f<i;++f)s[f]=ze(t[e+f],t[n+f],p);return void(s.length=i)}a=e}}for(var d=0;d<i;++d)s[d]=t[a+d];s.length=i}function Xn(t,e,n,i,o){var r=t[e],s=t[e+1];for(e+=i;e<n;e+=i){var a=t[e],h=t[e+1],u=Ve(r,s,a,h);u>o&&(o=u),r=a,s=h}return o}function Kn(t,e,n,i,o){for(var r=0,s=n.length;r<s;++r){var a=n[r];o=Xn(t,e,a,i,o),e=a}return o}function Yn(t,e,n,i,o,r,s,a,h,u,l){if(e==n)return u;var c,p;if(0===o){if((p=Ve(s,a,t[e],t[e+1]))<u){for(c=0;c<i;++c)h[c]=t[e+c];return h.length=i,p}return u}for(var f=l||[NaN,NaN],d=e+i;d<n;)if(zn(t,d-i,d,i,s,a,f),(p=Ve(s,a,f[0],f[1]))<u){for(u=p,c=0;c<i;++c)h[c]=f[c];h.length=i,d+=i}else d+=i*Math.max((Math.sqrt(p)-Math.sqrt(u))/o|0,1);if(r&&(zn(t,n-i,e,i,s,a,f),(p=Ve(s,a,f[0],f[1]))<u)){for(u=p,c=0;c<i;++c)h[c]=f[c];h.length=i}return u}function Hn(t,e,n,i,o,r,s,a,h,u,l){for(var c=l||[NaN,NaN],p=0,f=n.length;p<f;++p){var d=n[p];u=Yn(t,e,d,i,o,r,s,a,h,u,c),e=d}return u}function Zn(t,e,n,i,o){for(var r=void 0!==o?o:[],s=0,a=e;a<n;a+=i)r[s++]=t.slice(a,a+i);return r.length=s,r}function Jn(t,e,n,i,o){for(var r=void 0!==o?o:[],s=0,a=0,h=n.length;a<h;++a){var u=n[a];r[s++]=Zn(t,e,u,i,r[s]),e=u}return r.length=s,r}function Qn(t,e,n,i,o,r,s){var a=(n-e)/i;if(a<3){for(;e<n;e+=i)r[s++]=t[e],r[s++]=t[e+1];return s}var h=new Array(a);h[0]=1,h[a-1]=1;for(var u=[e,n-i],l=0;u.length>0;){for(var c=u.pop(),p=u.pop(),f=0,d=t[p],g=t[p+1],y=t[c],v=t[c+1],m=p+i;m<c;m+=i){var _=Ne(t[m],t[m+1],d,g,y,v);_>f&&(l=m,f=_)}f>o&&(h[(l-e)/i]=1,p+i<l&&u.push(p,l),l+i<c&&u.push(l,c))}for(var w=0;w<a;++w)h[w]&&(r[s++]=t[e+w*i],r[s++]=t[e+w*i+1]);return s}function ti(t,e,n,i,o,r,s,a){for(var h=0,u=n.length;h<u;++h){var l=n[h];s=Qn(t,e,l,i,o,r,s),a.push(s),e=l}return s}function ei(t,e){return e*Math.round(t/e)}function ni(t,e,n,i,o,r,s){if(e==n)return s;var a,h,u=ei(t[e],o),l=ei(t[e+1],o);e+=i,r[s++]=u,r[s++]=l;do{if(a=ei(t[e],o),h=ei(t[e+1],o),(e+=i)==n)return r[s++]=a,r[s++]=h,s}while(a==u&&h==l);for(;e<n;){var c=ei(t[e],o),p=ei(t[e+1],o);if(e+=i,c!=a||p!=h){var f=a-u,d=h-l,g=c-u,y=p-l;f*y==d*g&&(f<0&&g<f||f==g||f>0&&g>f)&&(d<0&&y<d||d==y||d>0&&y>d)?(a=c,h=p):(r[s++]=a,r[s++]=h,u=a,l=h,a=c,h=p)}}return r[s++]=a,r[s++]=h,s}function ii(t,e,n,i,o,r,s,a){for(var h=0,u=n.length;h<u;++h){var l=n[h];s=ni(t,e,l,i,o,r,s),a.push(s),e=l}return s}function oi(t,e){return e=e?Math.pow(10,e):1e3,t.map((function(t){return t.map((function(t){return t.map((function(t){return Math.round(t*e)/e}))}))}))}var ri=function(t){function e(e,n){t.call(this),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===n||Array.isArray(e[0])?this.setCoordinates(e,n):this.setFlatCoordinates(n,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,n,i){return i<Et(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Xn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Yn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,i))},e.prototype.getArea=function(){return Wn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinates=function(){return Zn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getSimplifiedGeometryInternal=function(t){var n=[];return n.length=Qn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,n,0),new e(n,kn)},e.prototype.getType=function(){return Zt},e.prototype.intersectsExtent=function(t){return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=jn(this.flatCoordinates,0,t,this.stride),this.changed()},e}(Tn),si=function(t){function e(e,n){t.call(this),this.setCoordinates(e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,n,i){var o=this.flatCoordinates,r=Ve(t,e,o[0],o[1]);if(r<i){for(var s=this.stride,a=0;a<s;++a)n[a]=o[a];return n.length=s,r}return i},e.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},e.prototype.computeExtent=function(t){return At(this.flatCoordinates,t)},e.prototype.getType=function(){return Yt},e.prototype.intersectsExtent=function(t){return Rt(t,this.flatCoordinates[0],this.flatCoordinates[1])},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ln(this.flatCoordinates,0,t,this.stride),this.changed()},e}(Tn);function ai(t,e,n,i,o){return!Gt(o,(function(o){return!hi(t,e,n,i,o[0],o[1])}))}function hi(t,e,n,i,o,r){for(var s=0,a=t[n-i],h=t[n-i+1];e<n;e+=i){var u=t[e],l=t[e+1];h<=r?l>r&&(u-a)*(r-h)-(o-a)*(l-h)>0&&s++:l<=r&&(u-a)*(r-h)-(o-a)*(l-h)<0&&s--,a=u,h=l}return 0!==s}function ui(t,e,n,i,o,r){if(0===n.length)return!1;if(!hi(t,e,n[0],i,o,r))return!1;for(var s=1,a=n.length;s<a;++s)if(hi(t,n[s-1],n[s],i,o,r))return!1;return!0}function li(t,e,n,i,o,r,s){for(var a,h,u,l,c,p,f,d=o[r+1],g=[],y=0,v=n.length;y<v;++y){var m=n[y];for(l=t[m-i],p=t[m-i+1],a=e;a<m;a+=i)c=t[a],f=t[a+1],(d<=p&&f<=d||p<=d&&d<=f)&&(u=(d-p)/(f-p)*(c-l)+l,g.push(u)),l=c,p=f}var _=NaN,w=-1/0;for(g.sort(qn),l=g[0],a=1,h=g.length;a<h;++a){c=g[a];var b=Math.abs(c-l);b>w&&ui(t,e,n,i,u=(l+c)/2,d)&&(_=u,w=b),l=c}return isNaN(_)&&(_=o[r]),s?(s.push(_,d,w),s):[_,d,w]}function ci(t,e,n,i,o,r){for(var s,a=[t[e],t[e+1]],h=[];e+i<n;e+=i){if(h[0]=t[e+i],h[1]=t[e+i+1],s=o.call(r,a,h))return s;a[0]=h[0],a[1]=h[1]}return!1}function pi(t,e,n,i,o){var r=jt([1/0,1/0,-1/0,-1/0],t,e,n,i);return!!Xt(o,r)&&(!!St(o,r)||(r[0]>=o[0]&&r[2]<=o[2]||(r[1]>=o[1]&&r[3]<=o[3]||ci(t,e,n,i,(function(t,e){return function(t,e,n){var i=!1,o=Mt(t,e),r=Mt(t,n);if(o===_t||r===_t)i=!0;else{var s,a,h=t[0],u=t[1],l=t[2],c=t[3],p=e[0],f=e[1],d=n[0],g=n[1],y=(g-f)/(d-p);r&wt&&!(o&wt)&&(i=(s=d-(g-c)/y)>=h&&s<=l),i||!(r&bt)||o&bt||(i=(a=g-(d-l)*y)>=u&&a<=c),i||!(r&xt)||o&xt||(i=(s=d-(g-u)/y)>=h&&s<=l),i||!(r&Ct)||o&Ct||(i=(a=g-(d-h)*y)>=u&&a<=c)}return i}(o,t,e)})))))}function fi(t,e,n,i,o){if(!function(t,e,n,i,o){return!!pi(t,e,n,i,o)||(!!hi(t,e,n,i,o[0],o[1])||(!!hi(t,e,n,i,o[0],o[3])||(!!hi(t,e,n,i,o[2],o[1])||!!hi(t,e,n,i,o[2],o[3]))))}(t,e,n[0],i,o))return!1;if(1===n.length)return!0;for(var r=1,s=n.length;r<s;++r)if(ai(t,n[r-1],n[r],i,o)&&!pi(t,n[r-1],n[r],i,o))return!1;return!0}function di(t,e,n,i){for(;e<n-i;){for(var o=0;o<i;++o){var r=t[e+o];t[e+o]=t[n-i+o],t[n-i+o]=r}e+=i,n-=i}}function gi(t,e,n,i){for(var o=0,r=t[n-i],s=t[n-i+1];e<n;e+=i){var a=t[e],h=t[e+1];o+=(a-r)*(h+s),r=a,s=h}return o>0}function yi(t,e,n,i,o){for(var r=void 0!==o&&o,s=0,a=n.length;s<a;++s){var h=n[s],u=gi(t,e,h,i);if(0===s){if(r&&u||!r&&!u)return!1}else if(r&&!u||!r&&u)return!1;e=h}return!0}function vi(t,e,n,i,o){for(var r=void 0!==o&&o,s=0,a=n.length;s<a;++s){var h=n[s],u=gi(t,e,h,i);(0===s?r&&u||!r&&!u:r&&!u||!r&&u)&&di(t,e,h,i),e=h}return e}function mi(t,e,n,i,o){for(var r=0,s=n.length;r<s;++r)e=vi(t,e,n[r],i,o);return e}var _i=function(t){function e(e,n,i){t.call(this),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==n&&i?(this.setFlatCoordinates(n,e),this.ends_=i):this.setCoordinates(e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.appendLinearRing=function(t){this.flatCoordinates?Vn(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},e.prototype.closestPointXY=function(t,e,n,i){return i<Et(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Kn(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Hn(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,i))},e.prototype.containsXY=function(t,e){return ui(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)},e.prototype.getArea=function(){return $n(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?vi(e=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,t):e=this.flatCoordinates,Jn(e,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=Ut(this.getExtent());this.flatInteriorPoint_=li(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},e.prototype.getInteriorPoint=function(){return new si(this.getFlatInteriorPoint(),Fn)},e.prototype.getLinearRingCount=function(){return this.ends_.length},e.prototype.getLinearRing=function(t){return t<0||this.ends_.length<=t?null:new ri(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLinearRings=function(){for(var t=this.layout,e=this.flatCoordinates,n=this.ends_,i=[],o=0,r=0,s=n.length;r<s;++r){var a=n[r],h=new ri(e.slice(o,a),t);i.push(h),o=a}return i},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;yi(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=vi(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var n=[],i=[];return n.length=ii(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),n,0,i),new e(n,kn,i)},e.prototype.getType=function(){return Jt},e.prototype.intersectsExtent=function(t){return fi(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var n=Dn(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===n.length?0:n[n.length-1],this.changed()},e}(Tn),wi=_i;function bi(t){var e=t[0],n=t[1],i=t[2],o=t[3],r=[e,n,e,o,i,o,i,n,e,n];return new _i(r,kn,[r.length])}function xi(t,e,n){for(var i=e||32,o=t.getStride(),r=t.getLayout(),s=t.getCenter(),a=o*(i+1),h=new Array(a),u=0;u<a;u+=o){h[u]=0,h[u+1]=0;for(var l=2;l<o;l++)h[u+l]=s[l]}var c=[h.length],p=new _i(h,r,c);return Ci(p,s,t.getRadius(),n),p}function Ci(t,e,n,i){for(var o=t.getFlatCoordinates(),r=t.getStride(),s=o.length/r-1,a=i||0,h=0;h<=s;++h){var u=h*r,l=a+2*$e(h,s)*Math.PI/s;o[u]=e[0]+n*Math.cos(l),o[u+1]=e[1]+n*Math.sin(l)}t.changed()}var Pi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getType=function(){return re},e.prototype.closestPointXY=function(t,e,n,i){var o,r,s,a=this.flatCoordinates,h=i;n[0]=a[0],n[1]=a[1];for(var u=0,l=a.length;u<l;u+=2)(o=(r=t-a[u])*r+(s=e-a[u+1])*s)<h&&(h=o,n[0]=a[u],n[1]=a[u+1]);return h},e.prototype.getArea=function(){var t=this.flatCoordinates,e=Math.sqrt(Math.pow(t[0]-t[4],2)+Math.pow(t[1]-t[5],2)),n=Math.sqrt(Math.pow(t[2]-t[6],2)+Math.pow(t[3]-t[7],2));return Math.PI*e*n*.25},e}(wi);var Ei=function(t){function e(e){if(t.call(this),this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,ge(this,De(this.geometryName_),this.handleGeometryChanged_,this),e)if("function"==typeof e.getSimplifiedGeometry){var n=e;this.setGeometry(n)}else{var i=e;this.setProperties(i)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){var t=new e(this.getProperties());t.setGeometryName(this.getGeometryName());var n=this.getGeometry();n&&t.setGeometry(n.clone());var i=this.getStyle();return i&&t.setStyle(i),t},e.prototype.getGeometry=function(){return this.get(this.geometryName_)},e.prototype.getId=function(){return this.id_},e.prototype.getGeometryName=function(){return this.geometryName_},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.handleGeometryChange_=function(){this.changed()},e.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(me(this.geometryChangeKey_),this.geometryChangeKey_=null);var t=this.getGeometry();t&&(this.geometryChangeKey_=ge(t,Re,this.handleGeometryChange_,this)),this.changed()},e.prototype.setGeometry=function(t){this.set(this.geometryName_,t)},e.prototype.setStyle=function(t){this.style_=t,this.styleFunction_=t?function(t){if("function"==typeof t)return t;var e;Array.isArray(t)?e=t:(vt("function"==typeof t.getZIndex,41),e=[t]);return function(){return e}}(t):void 0,this.changed()},e.prototype.setId=function(t){this.id_=t,this.changed()},e.prototype.setGeometryName=function(t){ve(this,De(this.geometryName_),this.handleGeometryChanged_,this),this.geometryName_=t,ge(this,De(this.geometryName_),this.handleGeometryChanged_,this),this.handleGeometryChanged_()},e}(Ge);function Si(t,e,n,i,o,r){var s=NaN,a=NaN,h=(n-e)/i;if(1===h)s=t[e],a=t[e+1];else if(2==h)s=(1-o)*t[e]+o*t[e+i],a=(1-o)*t[e+1]+o*t[e+i+1];else if(0!==h){for(var u=t[e],l=t[e+1],c=0,p=[0],f=e+i;f<n;f+=i){var d=t[f],g=t[f+1];c+=Math.sqrt((d-u)*(d-u)+(g-l)*(g-l)),p.push(c),u=d,l=g}var y=o*c,v=function(t,e,n){for(var i,o,r=n||qn,s=0,a=t.length,h=!1;s<a;)(o=+r(t[i=s+(a-s>>1)],e))<0?s=i+1:(a=i,h=!o);return h?s:~s}(p,y);if(v<0){var m=(y-p[-v-2])/(p[-v-1]-p[-v-2]),_=e+(-v-2)*i;s=ze(t[_],t[_+i],m),a=ze(t[_+1],t[_+i+1],m)}else s=t[e+v*i],a=t[e+v*i+1]}return r?(r[0]=s,r[1]=a,r):[s,a]}function Ri(t,e,n,i,o,r){if(n==e)return null;var s;if(o<t[e+i-1])return r?((s=t.slice(e,e+i))[i-1]=o,s):null;if(t[n-1]<o)return r?((s=t.slice(n-i,n))[i-1]=o,s):null;if(o==t[e+i-1])return t.slice(e,e+i);for(var a=e/i,h=n/i;a<h;){var u=a+h>>1;o<t[(u+1)*i-1]?h=u:a=u+1}var l=t[a*i-1];if(o==l)return t.slice((a-1)*i,(a-1)*i+i);var c=(o-l)/(t[(a+1)*i-1]-l);s=[];for(var p=0;p<i-1;++p)s.push(ze(t[(a-1)*i+p],t[a*i+p],c));return s.push(o),s}function Mi(t,e,n,i){for(var o=t[e],r=t[e+1],s=0,a=e+i;a<n;a+=i){var h=t[a],u=t[a+1];s+=Math.sqrt((h-o)*(h-o)+(u-r)*(u-r)),o=h,r=u}return s}var ki=function(t){function e(e,n){t.call(this),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===n||Array.isArray(e[0])?this.setCoordinates(e,n):this.setFlatCoordinates(n,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.appendCoordinate=function(t){this.flatCoordinates?Vn(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,n,i){return i<Et(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Xn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Yn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,n,i))},e.prototype.forEachSegment=function(t){return ci(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinateAtM=function(t,e){if(this.layout!=Fn&&this.layout!=An)return null;var n=void 0!==e&&e;return Ri(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,n)},e.prototype.getCoordinates=function(){return Zn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinateAt=function(t,e){return Si(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e)},e.prototype.getLength=function(){return Mi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},e.prototype.getSimplifiedGeometryInternal=function(t){var n=[];return n.length=Qn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,n,0),new e(n,kn)},e.prototype.getType=function(){return Ht},e.prototype.intersectsExtent=function(t){return pi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=jn(this.flatCoordinates,0,t,this.stride),this.changed()},e}(Tn),Ii=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getType=function(){return oe},e.prototype.closestPointXY=function(t,e,n,i){var o,r,s,a=this.flatCoordinates,h=i;n[0]=a[0],n[1]=a[1];for(var u=0,l=a.length;u<l;u+=2)(o=(r=t-a[u])*r+(s=e-a[u+1])*s)<h&&(h=o,n[0]=a[u],n[1]=a[u+1]);return h},e}(wi),Fi={data:function(){return{renderedAnnotationMap:{}}},computed:{annotationsRevision:function(){return this.annotations.reduce((function(t,e){return t+e.revision}),0)},annotationsPreparedToRender:function(){return this.annotations.map((function(t){return{id:t.id,start:t.startFrame,end:t.endFrame,self:t}})).sort((function(t,e){return t.start-e.start}))}},methods:{refreshAnnotations:function(t){var e=this,n=this.annotationSource,i=this.selectedFeatures,o=this.annotationsPreparedToRender,r=this.renderedAnnotationMap,s={};this.renderedAnnotationMap=s;for(var a,h=[],u=!1,l=0,c=o.length;l<c;l++)if(!(o[l].end<t&&o[l].start!==t||o[l].self.hasGapAt(t))){if(o[l].start>t)break;a=o[l],u=!0,r.hasOwnProperty(a.id)?(s[a.id]=r[a.id],delete r[a.id]):h.push(a.self)}u?Object.values(r).forEach((function(t){n.removeFeature(t),i.remove(t)})):(n.clear(),i.clear());var p=h.map(this.createFeature);p.forEach((function(t){s[t.getId()]=t,t.get("annotation").isSelected&&i.push(t)})),p.length>0&&n.addFeatures(p),Object.values(s).forEach((function(n){e.updateGeometry(n,t)}))},createFeature:function(t){var e=new Ei(this.getGeometryFromPoints(t.shape,t.points[0]));return e.setId(t.id),e.set("annotation",t),t.labels&&t.labels.length>0&&e.set("color",t.labels[0].label.color),e},updateGeometry:function(t,e){var n=t.get("annotation"),i=n.interpolatePoints(e);t.setGeometry(this.getGeometryFromPoints(n.shape,i))},getGeometryFromPoints:function(t,e){switch(e=this.convertPointsFromDbToOl(e),t){case"Point":return new si(e[0]);case"Rectangle":return new Ii([e]);case"Polygon":return new wi([e]);case"LineString":return new ki(e);case"Circle":return new Bn(e[0],e[1][0]);case"Ellipse":return new Pi([e]);default:return void console.error("Unknown annotation shape: "+t)}},getPointsFromGeometry:function(t){var e;switch(t.getType()){case"Circle":e=[t.getCenter(),[t.getRadius()]];break;case"Polygon":case"Rectangle":case"Ellipse":e=t.getCoordinates()[0];break;case"Point":e=[t.getCoordinates()];break;default:e=t.getCoordinates()}return this.convertPointsFromOlToDb(e)},invertPointsYAxis:function(t){for(var e=this.videoCanvas.height,n=1;n<t.length;n+=2)t[n]=e-t[n];return t},convertPointsFromOlToDb:function(t){return this.invertPointsYAxis(Array.prototype.concat.apply([],t))},convertPointsFromDbToOl:function(t){t=this.invertPointsYAxis(t.slice());for(var e=[],n=0;n<t.length;n+=2)e.push([t[n],t[n+1]||0]);return e}},created:function(){var t=this;this.$on("refresh",this.refreshAnnotations),this.$once("map-ready",(function(){t.$watch("annotationsRevision",(function(){t.refreshAnnotations(t.video.currentTime)}))}))}},Ai=0,Oi=1,Ti=2,Li=3,ji=function(t){function e(e,n,i,o){t.call(this),this.extent=e,this.pixelRatio_=i,this.resolution=n,this.state=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.changed=function(){this.dispatchEvent(Re)},e.prototype.getExtent=function(){return this.extent},e.prototype.getImage=function(){return ft()},e.prototype.getPixelRatio=function(){return this.pixelRatio_},e.prototype.getResolution=function(){return this.resolution},e.prototype.getState=function(){return this.state},e.prototype.load=function(){ft()},e}(Se);function Di(t,e){var n=document.createElement("canvas");return t&&(n.width=t),e&&(n.height=e),n.getContext("2d")}function Gi(t,e,n,i){var o=Rn(n,e,t),r=bn(e,i,n),s=e.getMetersPerUnit();void 0!==s&&(r*=s);var a=t.getMetersPerUnit();void 0!==a&&(r/=a);var h,u=t.getExtent();if(!u||Rt(u,(h=o)[0],h[1])){var l=bn(t,r,o)/r;isFinite(l)&&l>0&&(r/=l)}return r}function Bi(t,e,n,i){var o=n-t,r=i-e,s=Math.sqrt(o*o+r*r);return[Math.round(n+o/s),Math.round(i+r/s)]}function qi(t,e,n,i,o,r,s,a,h,u,l){var c=Di(Math.round(n*t),Math.round(n*e));if(0===h.length)return c.canvas;c.scale(n,n);var p=[1/0,1/0,-1/0,-1/0];h.forEach((function(t,e,n){var i,o;i=p,(o=t.extent)[0]<i[0]&&(i[0]=o[0]),o[2]>i[2]&&(i[2]=o[2]),o[1]<i[1]&&(i[1]=o[1]),o[3]>i[3]&&(i[3]=o[3])}));var f=zt(p),d=Nt(p),g=Di(Math.round(n*f/i),Math.round(n*d/i)),y=n/i;h.forEach((function(t,e,n){var i=t.extent[0]-p[0],o=-(t.extent[3]-p[3]),r=zt(t.extent),s=Nt(t.extent);g.drawImage(t.image,u,u,t.image.width-2*u,t.image.height-2*u,i*y,o*y,r*y,s*y)}));var v=Wt(s);return a.getTriangles().forEach((function(t,e,o){var s=t.source,a=t.target,h=s[0][0],u=s[0][1],l=s[1][0],f=s[1][1],d=s[2][0],y=s[2][1],m=(a[0][0]-v[0])/r,_=-(a[0][1]-v[1])/r,w=(a[1][0]-v[0])/r,b=-(a[1][1]-v[1])/r,x=(a[2][0]-v[0])/r,C=-(a[2][1]-v[1])/r,P=h,E=u;h=0,u=0;var S=function(t){for(var e=t.length,n=0;n<e;n++){for(var i=n,o=Math.abs(t[n][n]),r=n+1;r<e;r++){var s=Math.abs(t[r][n]);s>o&&(o=s,i=r)}if(0===o)return null;var a=t[i];t[i]=t[n],t[n]=a;for(var h=n+1;h<e;h++)for(var u=-t[h][n]/t[n][n],l=n;l<e+1;l++)n==l?t[h][l]=0:t[h][l]+=u*t[n][l]}for(var c=new Array(e),p=e-1;p>=0;p--){c[p]=t[p][e]/t[p][p];for(var f=p-1;f>=0;f--)t[f][e]-=t[f][p]*c[p]}return c}([[l-=P,f-=E,0,0,w-m],[d-=P,y-=E,0,0,x-m],[0,0,l,f,b-_],[0,0,d,y,C-_]]);if(S){c.save(),c.beginPath();var R=(m+w+x)/3,M=(_+b+C)/3,k=Bi(R,M,m,_),I=Bi(R,M,w,b),F=Bi(R,M,x,C);c.moveTo(I[0],I[1]),c.lineTo(k[0],k[1]),c.lineTo(F[0],F[1]),c.clip(),c.transform(S[0],S[2],S[1],S[3],m,_),c.translate(p[0]-P,p[3]-E),c.scale(i/n,-i/n),c.drawImage(g.canvas,0,0),c.restore()}})),l&&(c.save(),c.strokeStyle="black",c.lineWidth=1,a.getTriangles().forEach((function(t,e,n){var i=t.target,o=(i[0][0]-v[0])/r,s=-(i[0][1]-v[1])/r,a=(i[1][0]-v[0])/r,h=-(i[1][1]-v[1])/r,u=(i[2][0]-v[0])/r,l=-(i[2][1]-v[1])/r;c.beginPath(),c.moveTo(a,h),c.lineTo(o,s),c.lineTo(u,l),c.closePath(),c.stroke()})),c.restore()),c.canvas}var Ui=function(t,e,n,i,o){this.sourceProj_=t,this.targetProj_=e;var r={},s=Sn(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){var e=t[0]+"/"+t[1];return r[e]||(r[e]=s(t)),r[e]},this.maxSourceExtent_=i,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!i&&!!this.sourceProj_.getExtent()&&zt(i)==zt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?zt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?zt(this.targetProj_.getExtent()):null;var a=Wt(n),h=$t(n),u=qt(n),l=Bt(n),c=this.transformInv_(a),p=this.transformInv_(h),f=this.transformInv_(u),d=this.transformInv_(l);if(this.addQuad_(a,h,u,l,c,p,f,d,10),this.wrapsXInSource_){var g=1/0;this.triangles_.forEach((function(t,e,n){g=Math.min(g,t.source[0][0],t.source[1][0],t.source[2][0])})),this.triangles_.forEach(function(t){if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-g>this.sourceWorldWidth_/2){var e=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];e[0][0]-g>this.sourceWorldWidth_/2&&(e[0][0]-=this.sourceWorldWidth_),e[1][0]-g>this.sourceWorldWidth_/2&&(e[1][0]-=this.sourceWorldWidth_),e[2][0]-g>this.sourceWorldWidth_/2&&(e[2][0]-=this.sourceWorldWidth_);var n=Math.min(e[0][0],e[1][0],e[2][0]);Math.max(e[0][0],e[1][0],e[2][0])-n<this.sourceWorldWidth_/2&&(t.source=e)}}.bind(this))}r={}};Ui.prototype.addTriangle_=function(t,e,n,i,o,r){this.triangles_.push({source:[i,o,r],target:[t,e,n]})},Ui.prototype.addQuad_=function(t,e,n,i,o,r,s,a,h){var u=Pt([o,r,s,a]),l=this.sourceWorldWidth_?zt(u)/this.sourceWorldWidth_:null,c=this.sourceWorldWidth_,p=this.sourceProj_.canWrapX()&&l>.5&&l<1,f=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_)f=zt(Pt([t,e,n,i]))/this.targetWorldWidth_>.25||f;!p&&this.sourceProj_.isGlobal()&&l&&(f=l>.25||f)}if(f||!this.maxSourceExtent_||Xt(u,this.maxSourceExtent_)){if(!(f||isFinite(o[0])&&isFinite(o[1])&&isFinite(r[0])&&isFinite(r[1])&&isFinite(s[0])&&isFinite(s[1])&&isFinite(a[0])&&isFinite(a[1]))){if(!(h>0))return;f=!0}if(h>0){if(!f){var d,g=[(t[0]+n[0])/2,(t[1]+n[1])/2],y=this.transformInv_(g);if(p)d=($e(o[0],c)+$e(s[0],c))/2-$e(y[0],c);else d=(o[0]+s[0])/2-y[0];var v=(o[1]+s[1])/2-y[1];f=d*d+v*v>this.errorThresholdSquared_}if(f){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){var m=[(e[0]+n[0])/2,(e[1]+n[1])/2],_=this.transformInv_(m),w=[(i[0]+t[0])/2,(i[1]+t[1])/2],b=this.transformInv_(w);this.addQuad_(t,e,m,w,o,r,_,b,h-1),this.addQuad_(w,m,n,i,b,_,s,a,h-1)}else{var x=[(t[0]+e[0])/2,(t[1]+e[1])/2],C=this.transformInv_(x),P=[(n[0]+i[0])/2,(n[1]+i[1])/2],E=this.transformInv_(P);this.addQuad_(t,x,P,i,o,C,E,a,h-1),this.addQuad_(x,e,n,P,C,r,s,E,h-1)}return}}if(p){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}this.addTriangle_(t,n,i,o,s,a),this.addTriangle_(t,e,n,o,r,s)}},Ui.prototype.calculateSourceExtent=function(){var t=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach((function(e,n,i){var o=e.source;Lt(t,o[0]),Lt(t,o[1]),Lt(t,o[2])})),t},Ui.prototype.getTriangles=function(){return this.triangles_};var Ni=Ui,Vi=function(t){function e(e,n,i,o,r,s){var a=e.getExtent(),h=n.getExtent(),u=h?Vt(i,h):i,l=Gi(e,n,Ut(u),o),c=new Ni(e,n,u,a,.5*l),p=s(c.calculateSourceExtent(),l,r),f=Ti;p&&(f=Ai);var d=p?p.getPixelRatio():1;t.call(this,i,o,d,f),this.targetProj_=n,this.maxSourceExtent_=a,this.triangulation_=c,this.targetResolution_=o,this.targetExtent_=i,this.sourceImage_=p,this.sourcePixelRatio_=d,this.canvas_=null,this.sourceListenerKey_=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){this.state==Oi&&this.unlistenSource_(),t.prototype.disposeInternal.call(this)},e.prototype.getImage=function(){return this.canvas_},e.prototype.getProjection=function(){return this.targetProj_},e.prototype.reproject_=function(){var t=this.sourceImage_.getState();if(t==Ti){var e=zt(this.targetExtent_)/this.targetResolution_,n=Nt(this.targetExtent_)/this.targetResolution_;this.canvas_=qi(e,n,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0)}this.state=t,this.changed()},e.prototype.load=function(){if(this.state==Ai){this.state=Oi,this.changed();var t=this.sourceImage_.getState();t==Ti||t==Li?this.reproject_():(this.sourceListenerKey_=ge(this.sourceImage_,Re,(function(t){var e=this.sourceImage_.getState();e!=Ti&&e!=Li||(this.unlistenSource_(),this.reproject_())}),this),this.sourceImage_.load())}},e.prototype.unlistenSource_=function(){me(this.sourceListenerKey_),this.sourceListenerKey_=null},e}(ji),Wi="undefined",$i="ready";function zi(t){return t?Array.isArray(t)?function(e){return t}:"function"==typeof t?t:function(e){return[t]}:null}var Xi=function(t){function e(e){t.call(this),this.projection_=wn(e.projection),this.attributions_=zi(e.attributions),this.attributionsCollapsible_=void 0===e.attributionsCollapsible||e.attributionsCollapsible,this.loading=!1,this.state_=void 0!==e.state?e.state:$i,this.wrapX_=void 0!==e.wrapX&&e.wrapX}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getAttributions=function(){return this.attributions_},e.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},e.prototype.getProjection=function(){return this.projection_},e.prototype.getResolutions=function(){return ft()},e.prototype.getState=function(){return this.state_},e.prototype.getWrapX=function(){return this.wrapX_},e.prototype.refresh=function(){this.changed()},e.prototype.setAttributions=function(t){this.attributions_=zi(t),this.changed()},e.prototype.setState=function(t){this.state_=t,this.changed()},e}(Ge),Ki="imageloadstart",Yi="imageloadend",Hi="imageloaderror",Zi=function(t){function e(e,n){t.call(this,e),this.image=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ee);var Ji=function(t){function e(e){t.call(this,{attributions:e.attributions,projection:e.projection,state:e.state}),this.resolutions_=void 0!==e.resolutions?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getResolutions=function(){return this.resolutions_},e.prototype.findNearestResolution=function(t){if(this.resolutions_){var e=Nn(this.resolutions_,t,0);t=this.resolutions_[e]}return t},e.prototype.getImage=function(t,e,n,i){var o=this.getProjection();if(o&&i&&!Pn(o,i)){if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Pn(this.reprojectedImage_.getProjection(),i)&&this.reprojectedImage_.getResolution()==e&&Tt(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Vi(o,i,t,e,n,function(t,e,n){return this.getImageInternal(t,e,n,o)}.bind(this)),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}return o&&(i=o),this.getImageInternal(t,e,n,i)},e.prototype.getImageInternal=function(t,e,n,i){return ft()},e.prototype.handleImageChange=function(t){var e=t.target;switch(e.getState()){case Oi:this.loading=!0,this.dispatchEvent(new Zi(Ki,e));break;case Ti:this.loading=!1,this.dispatchEvent(new Zi(Yi,e));break;case Li:this.loading=!1,this.dispatchEvent(new Zi(Hi,e))}},e}(Xi),Qi=function(t){function e(e,n,i,o,r){var s=void 0!==r?Ai:Ti;void 0===n&&(n=Nt(e)/o.height),t.call(this,e,n,i,s),this.loader_=void 0!==r?r:null,this.canvas_=o,this.error_=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getError=function(){return this.error_},e.prototype.handleLoad_=function(t){t?(this.error_=t,this.state=Li):this.state=Ti,this.changed()},e.prototype.load=function(){this.state==Ai&&(this.state=Oi,this.changed(),this.loader_(this.handleLoad_.bind(this)))},e.prototype.getImage=function(){return this.canvas_},e}(ji),to=function(t){function e(e){t.call(this,{attributions:e.attributions,projection:e.projection,resolutions:e.resolutions,state:e.state}),this.canvas_=new Qi(e.canvasExtent,void 0,1,e.canvas),this.canvasSize_=e.canvasSize?e.canvasSize:null,ge(this.canvas_,Re,this.handleImageChange,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getImageInternal=function(t,e,n,i){return Xt(t,this.canvas_.getExtent())?this.canvas_:null},e}(Ji),eo="IMAGE",no="VECTOR",io="opacity",oo="visible",ro="extent",so="zIndex",ao="maxResolution",ho="minResolution",uo="source",lo="precompose";var co=function(t){function e(e){var n=ae({},e);delete n.source,t.call(this,n),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,e.map&&this.setMap(e.map),ge(this,De(uo),this.handleSourcePropertyChange_,this);var i=e.source?e.source:null;this.setSource(i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayersArray=function(t){var e=t||[];return e.push(this),e},e.prototype.getLayerStatesArray=function(t){var e=t||[];return e.push(this.getLayerState()),e},e.prototype.getSource=function(){return this.get(uo)||null},e.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():Wi},e.prototype.handleSourceChange_=function(){this.changed()},e.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(me(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=ge(t,Re,this.handleSourceChange_,this)),this.changed()},e.prototype.setMap=function(t){this.mapPrecomposeKey_&&(me(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(me(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=ge(t,lo,(function(t){var e=t,n=this.getLayerState();n.managed=!1,void 0===this.getZIndex()&&(n.zIndex=1/0),e.frameState.layerStatesArray.push(n),e.frameState.layerStates[gt(this)]=n}),this),this.mapRenderKey_=ge(this,Re,t.render,t),this.changed())},e.prototype.setSource=function(t){this.set(uo,t)},e}(function(t){function e(e){t.call(this);var n=ae({},e);n[io]=void 0!==e.opacity?e.opacity:1,n[oo]=void 0===e.visible||e.visible,n[so]=e.zIndex,n[ao]=void 0!==e.maxResolution?e.maxResolution:1/0,n[ho]=void 0!==e.minResolution?e.minResolution:0,this.setProperties(n),this.state_=null,this.type}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getType=function(){return this.type},e.prototype.getLayerState=function(){var t=this.state_||{layer:this,managed:!0};return t.opacity=qe(this.getOpacity(),0,1),t.sourceState=this.getSourceState(),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=this.getZIndex()||0,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),this.state_=t,t},e.prototype.getLayersArray=function(t){return ft()},e.prototype.getLayerStatesArray=function(t){return ft()},e.prototype.getExtent=function(){return this.get(ro)},e.prototype.getMaxResolution=function(){return this.get(ao)},e.prototype.getMinResolution=function(){return this.get(ho)},e.prototype.getOpacity=function(){return this.get(io)},e.prototype.getSourceState=function(){return ft()},e.prototype.getVisible=function(){return this.get(oo)},e.prototype.getZIndex=function(){return this.get(so)},e.prototype.setExtent=function(t){this.set(ro,t)},e.prototype.setMaxResolution=function(t){this.set(ao,t)},e.prototype.setMinResolution=function(t){this.set(ho,t)},e.prototype.setOpacity=function(t){this.set(io,t)},e.prototype.setVisible=function(t){this.set(oo,t)},e.prototype.setZIndex=function(t){this.set(so,t)},e}(Ge)),po=function(t){function e(e){var n=e||{};t.call(this,n),this.type=eo}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(co);po.prototype.getSource;var fo=po;function go(t){return t}function yo(t,e){return void 0!==t?0:void 0}function vo(t,e){return void 0!==t?t+e:void 0}var mo=0,_o=1,wo="center",bo="resolution",xo="rotation";function Co(t,e){var n,i,o=t[0],r=t[1],s=e[0],a=e[1],h=s[0],u=s[1],l=a[0],c=a[1],p=l-h,f=c-u,d=0===p&&0===f?0:(p*(o-h)+f*(r-u))/(p*p+f*f||0);return d<=0?(n=h,i=u):d>=1?(n=l,i=c):(n=h+d*p,i=u+d*f),[n,i]}function Po(t,e){for(var n=!0,i=t.length-1;i>=0;--i)if(t[i]!=e[i]){n=!1;break}return n}function Eo(t,e){var n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i}function So(t,e){return Math.sqrt(Eo(t,e))}function Ro(t){return 3*t*t-2*t*t*t}function Mo(t,e){setTimeout((function(){t(e)}),0)}function ko(t){return!(t.sourceCenter&&t.targetCenter&&!Po(t.sourceCenter,t.targetCenter))&&(t.sourceResolution===t.targetResolution&&t.sourceRotation===t.targetRotation)}var Io=function(t){function e(e){t.call(this);var n=ae({},e);this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.updateAnimations_=this.updateAnimations_.bind(this),this.projection_=Cn(n.projection,"EPSG:3857"),this.applyOptions_(n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.applyOptions_=function(t){var e={};e[wo]=void 0!==t.center?t.center:null;var n=function(t){var e,n,i,o=void 0!==t.minZoom?t.minZoom:0,r=void 0!==t.maxZoom?t.maxZoom:28,s=void 0!==t.zoomFactor?t.zoomFactor:2;if(void 0!==t.resolutions){var a=t.resolutions;n=a[o],i=void 0!==a[r]?a[r]:a[a.length-1],e=function(t){return function(e,n,i){if(void 0!==e){var o=Nn(t,e,i);o=qe(o+n,0,t.length-1);var r=Math.floor(o);if(o!=r&&r<t.length-1){var s=t[r]/t[r+1];return t[r]/Math.pow(s,o-r)}return t[r]}}}(a)}else{var h=Cn(t.projection,"EPSG:3857"),u=h.getExtent(),l=(u?Math.max(zt(u),Nt(u)):360*Ye[He.DEGREES]/h.getMetersPerUnit())/256/Math.pow(2,0),c=l/Math.pow(2,28);void 0!==(n=t.maxResolution)?o=0:n=l/Math.pow(s,o),void 0===(i=t.minResolution)&&(i=void 0!==t.maxZoom?void 0!==t.maxResolution?n/Math.pow(s,r):l/Math.pow(s,r):c),r=o+Math.floor(Math.log(n/i)/Math.log(s)),i=n/Math.pow(s,r-o),e=function(t,e,n){return function(i,o,r){if(void 0!==i){var s=-r/2+.5,a=Math.floor(Math.log(e/i)/Math.log(t)+s),h=Math.max(a+o,0);return void 0!==n&&(h=Math.min(h,n)),e/Math.pow(t,h)}}}(s,n,r-o)}return{constraint:e,maxResolution:n,minResolution:i,minZoom:o,zoomFactor:s}}(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.minZoom_=n.minZoom;var i=function(t){return void 0!==t.extent?(e=t.extent,function(t){return t?[qe(t[0],e[0],e[2]),qe(t[1],e[1],e[3])]:void 0}):go;var e}(t),o=n.constraint,r=function(t){if(void 0===t.enableRotation||t.enableRotation){var e=t.constrainRotation;return void 0===e||!0===e?(r=o||We(5),function(t,e){return void 0!==t?Math.abs(t+e)<=r?0:t+e:void 0}):!1===e?vo:"number"==typeof e?(n=e,i=2*Math.PI/n,function(t,e){return void 0!==t?t=Math.floor((t+e)/i+.5)*i:void 0}):vo}return yo;var n,i;var o,r}(t);this.constraints_={center:i,resolution:o,rotation:r},void 0!==t.resolution?e[bo]=t.resolution:void 0!==t.zoom&&(e[bo]=this.constrainResolution(this.maxResolution_,t.zoom-this.minZoom_),this.resolutions_&&(e[bo]=qe(Number(this.getResolution()||e[bo]),this.minResolution_,this.maxResolution_))),e[xo]=void 0!==t.rotation?t.rotation:0,this.setProperties(e),this.options_=t},e.prototype.getUpdatedOptions_=function(t){var e=ae({},this.options_);return void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenter(),e.rotation=this.getRotation(),ae({},e,t)},e.prototype.animate=function(t){var e,n=arguments,i=arguments.length;if(i>1&&"function"==typeof arguments[i-1]&&(e=arguments[i-1],--i),!this.isDef()){var o=arguments[i-1];return o.center&&this.setCenter(o.center),void 0!==o.zoom&&this.setZoom(o.zoom),void 0!==o.rotation&&this.setRotation(o.rotation),void(e&&Mo(e,!0))}for(var r=Date.now(),s=this.getCenter().slice(),a=this.getResolution(),h=this.getRotation(),u=[],l=0;l<i;++l){var c=n[l],p={start:r,complete:!1,anchor:c.anchor,duration:void 0!==c.duration?c.duration:1e3,easing:c.easing||Ro};if(c.center&&(p.sourceCenter=s,p.targetCenter=c.center,s=p.targetCenter),void 0!==c.zoom?(p.sourceResolution=a,p.targetResolution=this.constrainResolution(this.maxResolution_,c.zoom-this.minZoom_,0),a=p.targetResolution):c.resolution&&(p.sourceResolution=a,p.targetResolution=c.resolution,a=p.targetResolution),void 0!==c.rotation){p.sourceRotation=h;var f=$e(c.rotation-h+Math.PI,2*Math.PI)-Math.PI;p.targetRotation=h+f,h=p.targetRotation}p.callback=e,ko(p)?p.complete=!0:r+=p.duration,u.push(p)}this.animations_.push(u),this.setHint(mo,1),this.updateAnimations_()},e.prototype.getAnimating=function(){return this.hints_[mo]>0},e.prototype.getInteracting=function(){return this.hints_[_o]>0},e.prototype.cancelAnimations=function(){this.setHint(mo,-this.hints_[mo]);for(var t=0,e=this.animations_.length;t<e;++t){var n=this.animations_[t];n[0].callback&&Mo(n[0].callback,!1)}this.animations_.length=0},e.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){for(var t=Date.now(),e=!1,n=this.animations_.length-1;n>=0;--n){for(var i=this.animations_[n],o=!0,r=0,s=i.length;r<s;++r){var a=i[r];if(!a.complete){var h=t-a.start,u=a.duration>0?h/a.duration:1;u>=1?(a.complete=!0,u=1):o=!1;var l=a.easing(u);if(a.sourceCenter){var c=a.sourceCenter[0],p=a.sourceCenter[1],f=c+l*(a.targetCenter[0]-c),d=p+l*(a.targetCenter[1]-p);this.set(wo,[f,d])}if(a.sourceResolution&&a.targetResolution){var g=1===l?a.targetResolution:a.sourceResolution+l*(a.targetResolution-a.sourceResolution);a.anchor&&this.set(wo,this.calculateCenterZoom(g,a.anchor)),this.set(bo,g)}if(void 0!==a.sourceRotation&&void 0!==a.targetRotation){var y=1===l?$e(a.targetRotation+Math.PI,2*Math.PI)-Math.PI:a.sourceRotation+l*(a.targetRotation-a.sourceRotation);a.anchor&&this.set(wo,this.calculateCenterRotate(y,a.anchor)),this.set(xo,y)}if(e=!0,!a.complete)break}}if(o){this.animations_[n]=null,this.setHint(mo,-1);var v=i[0].callback;v&&Mo(v,!0)}}this.animations_=this.animations_.filter(Boolean),e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_))}},e.prototype.calculateCenterRotate=function(t,e){var n,i,o,r,s,a,h,u=this.getCenter();return void 0!==u&&(n=[u[0]-e[0],u[1]-e[1]],i=n,o=t-this.getRotation(),r=Math.cos(o),s=Math.sin(o),a=i[0]*r-i[1]*s,h=i[1]*r+i[0]*s,i[0]=a,i[1]=h,function(t,e){t[0]+=e[0],t[1]+=e[1]}(n,e)),n},e.prototype.calculateCenterZoom=function(t,e){var n,i=this.getCenter(),o=this.getResolution();void 0!==i&&void 0!==o&&(n=[e[0]-t*(e[0]-i[0])/o,e[1]-t*(e[1]-i[1])/o]);return n},e.prototype.getSizeFromViewport_=function(){var t=[100,100],e='.ol-viewport[data-view="'+gt(this)+'"]',n=document.querySelector(e);if(n){var i=getComputedStyle(n);t[0]=parseInt(i.width,10),t[1]=parseInt(i.height,10)}return t},e.prototype.constrainCenter=function(t){return this.constraints_.center(t)},e.prototype.constrainResolution=function(t,e,n){var i=e||0,o=n||0;return this.constraints_.resolution(t,i,o)},e.prototype.constrainRotation=function(t,e){var n=e||0;return this.constraints_.rotation(t,n)},e.prototype.getCenter=function(){return this.get(wo)},e.prototype.getConstraints=function(){return this.constraints_},e.prototype.getHints=function(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()},e.prototype.calculateExtent=function(t){var e=t||this.getSizeFromViewport_(),n=this.getCenter();vt(n,1);var i=this.getResolution();vt(void 0!==i,2);var o=this.getRotation();return vt(void 0!==o,3),function(t,e,n,i,o){var r=e*i[0]/2,s=e*i[1]/2,a=Math.cos(n),h=Math.sin(n),u=r*a,l=r*h,c=s*a,p=s*h,f=t[0],d=t[1],g=f-u+p,y=f-u-p,v=f+u-p,m=f+u+p,_=d-l-c,w=d-l+c,b=d+l+c,x=d+l-c;return It(Math.min(g,y,v,m),Math.min(_,w,b,x),Math.max(g,y,v,m),Math.max(_,w,b,x),o)}(n,i,o,e)},e.prototype.getMaxResolution=function(){return this.maxResolution_},e.prototype.getMinResolution=function(){return this.minResolution_},e.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},e.prototype.setMaxZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))},e.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},e.prototype.setMinZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))},e.prototype.getProjection=function(){return this.projection_},e.prototype.getResolution=function(){return this.get(bo)},e.prototype.getResolutions=function(){return this.resolutions_},e.prototype.getResolutionForExtent=function(t,e){var n=e||this.getSizeFromViewport_(),i=zt(t)/n[0],o=Nt(t)/n[1];return Math.max(i,o)},e.prototype.getResolutionForValueFunction=function(t){var e=t||2,n=this.maxResolution_,i=this.minResolution_,o=Math.log(n/i)/Math.log(e);return function(t){return n/Math.pow(e,t*o)}},e.prototype.getRotation=function(){return this.get(xo)},e.prototype.getValueForResolutionFunction=function(t){var e=t||2,n=this.maxResolution_,i=this.minResolution_,o=Math.log(n/i)/Math.log(e);return function(t){return Math.log(n/t)/Math.log(e)/o}},e.prototype.getState=function(t){var e=this.getCenter(),n=this.getProjection(),i=this.getResolution(),o=i/t,r=this.getRotation();return{center:[Math.round(e[0]/o)*o,Math.round(e[1]/o)*o],projection:void 0!==n?n:null,resolution:i,rotation:r,zoom:this.getZoom()}},e.prototype.getZoom=function(){var t,e=this.getResolution();return void 0!==e&&(t=this.getZoomForResolution(e)),t},e.prototype.getZoomForResolution=function(t){var e,n,i=this.minZoom_||0;if(this.resolutions_){var o=Nn(this.resolutions_,t,1);i=o,e=this.resolutions_[o],n=o==this.resolutions_.length-1?2:e/this.resolutions_[o+1]}else e=this.maxResolution_,n=this.zoomFactor_;return i+Math.log(e/t)/Math.log(n)},e.prototype.getResolutionForZoom=function(t){return this.constrainResolution(this.maxResolution_,t-this.minZoom_,0)},e.prototype.fit=function(t,e){var n,i=e||{},o=i.size;o||(o=this.getSizeFromViewport_()),vt(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,24),Array.isArray(t)?(vt(!Kt(t),25),n=bi(t)):t.getType()===ie?(n=bi(t=t.getExtent())).rotate(this.getRotation(),Ut(t)):n=t;var r,s=void 0!==i.padding?i.padding:[0,0,0,0],a=void 0===i.constrainResolution||i.constrainResolution,h=void 0!==i.nearest&&i.nearest;r=void 0!==i.minResolution?i.minResolution:void 0!==i.maxZoom?this.constrainResolution(this.maxResolution_,i.maxZoom-this.minZoom_,0):0;for(var u=n.getFlatCoordinates(),l=this.getRotation(),c=Math.cos(-l),p=Math.sin(-l),f=1/0,d=1/0,g=-1/0,y=-1/0,v=n.getStride(),m=0,_=u.length;m<_;m+=v){var w=u[m]*c-u[m+1]*p,b=u[m]*p+u[m+1]*c;f=Math.min(f,w),d=Math.min(d,b),g=Math.max(g,w),y=Math.max(y,b)}var x=this.getResolutionForExtent([f,d,g,y],[o[0]-s[1]-s[3],o[1]-s[0]-s[2]]);if(x=isNaN(x)?r:Math.max(x,r),a){var C=this.constrainResolution(x,0,0);!h&&C<x&&(C=this.constrainResolution(C,-1,0)),x=C}p=-p;var P=(f+g)/2,E=(d+y)/2,S=[(P+=(s[1]-s[3])/2*x)*c-(E+=(s[0]-s[2])/2*x)*p,E*c+P*p],R=i.callback?i.callback:Ce;void 0!==i.duration?this.animate({resolution:x,center:S,duration:i.duration,easing:i.easing},R):(this.setResolution(x),this.setCenter(S),Mo(R,!0))},e.prototype.centerOn=function(t,e,n){var i=this.getRotation(),o=Math.cos(-i),r=Math.sin(-i),s=t[0]*o-t[1]*r,a=t[1]*o+t[0]*r,h=this.getResolution(),u=(s+=(e[0]/2-n[0])*h)*o-(a+=(n[1]-e[1]/2)*h)*(r=-r),l=a*o+s*r;this.setCenter([u,l])},e.prototype.isDef=function(){return!!this.getCenter()&&void 0!==this.getResolution()},e.prototype.rotate=function(t,e){if(void 0!==e){var n=this.calculateCenterRotate(t,e);this.setCenter(n)}this.setRotation(t)},e.prototype.setCenter=function(t){this.set(wo,t),this.getAnimating()&&this.cancelAnimations()},e.prototype.setHint=function(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]},e.prototype.setResolution=function(t){this.set(bo,t),this.getAnimating()&&this.cancelAnimations()},e.prototype.setRotation=function(t){this.set(xo,t),this.getAnimating()&&this.cancelAnimations()},e.prototype.setZoom=function(t){this.setResolution(this.getResolutionForZoom(t))},e}(Ge),Fo={data:function(){return{playing:!1,animationFrameId:null,refreshRate:30,renderCurrentTime:-1,refreshLastTime:Date.now(),extent:[0,0,0,0],minResolution:.25}},methods:{initVideoLayer:function(t){var e=t[0];this.videoCanvas.width=this.video.videoWidth,this.videoCanvas.height=this.video.videoHeight,this.extent=[0,0,this.videoCanvas.width,this.videoCanvas.height];var n=new Je({code:"biigle-image",units:"pixels",extent:this.extent});this.videoLayer=new fo({name:"image",source:new to({canvas:this.videoCanvas,projection:n,canvasExtent:this.extent,canvasSize:[this.extent[0],this.extent[1]]})}),e.addLayer(this.videoLayer),e.setView(new Io({center:[0,0],projection:n,minResolution:this.minResolution,extent:this.extent})),e.getView().fit(this.extent)},renderVideo:function(t){if(t||this.renderCurrentTime!==this.video.currentTime){this.renderCurrentTime=this.video.currentTime,this.videoCanvasCtx.drawImage(this.video,0,0,this.video.videoWidth,this.video.videoHeight),this.videoLayer.changed();var e=Date.now();(t||e-this.refreshLastTime>=this.refreshRate)&&(this.$emit("refresh",this.video.currentTime),this.refreshLastTime=e)}},startRenderLoop:function(){this.renderVideo(),this.animationFrameId=window.requestAnimationFrame(this.startRenderLoop)},stopRenderLoop:function(){window.cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null,this.renderVideo(!0)},setPlaying:function(){this.playing=!0},setPaused:function(){this.playing=!1},togglePlaying:function(){this.playing?this.pause():this.play()},play:function(){this.video.play()},pause:function(){this.video.pause(),this.renderVideo(!0)},emitMapReady:function(){this.$emit("map-ready",this.map)}},watch:{playing:function(t){t&&!this.animationFrameId?this.startRenderLoop():t||this.stopRenderLoop()}},created:function(){var t=this;this.videoCanvas=document.createElement("canvas"),this.videoCanvasCtx=this.videoCanvas.getContext("2d"),this.video.addEventListener("play",this.setPlaying),this.video.addEventListener("pause",this.setPaused),this.video.addEventListener("seeked",this.renderVideo),this.video.addEventListener("loadeddata",this.renderVideo);var e=new Vue.Promise((function(e,n){t.$once("map-created",e)})),n=new Vue.Promise((function(e,n){t.video.addEventListener("loadedmetadata",e)}));Vue.Promise.all([e,n]).then(this.initVideoLayer).then(this.emitMapReady),a.on(" ",this.togglePlaying)}},Ao="singleclick",Oo=Ie,To=Fe,Lo="pointerdrag",jo="pointermove",Do="pointerdown",Go="pointerup",Bo=function(t){function e(e,n,i,o,r){t.call(this,e,n,i.originalEvent,o,r),this.pointerEvent=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(function(t){function e(e,n,i,o,r){t.call(this,e,n,r),this.originalEvent=i,this.pixel=n.getEventPixel(i),this.coordinate=n.getCoordinateFromPixel(this.pixel),this.dragging=void 0!==o&&o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.preventDefault=function(){t.prototype.preventDefault.call(this),this.originalEvent.preventDefault()},e.prototype.stopPropagation=function(){t.prototype.stopPropagation.call(this),this.originalEvent.stopPropagation()},e}(function(t){function e(e,n,i){t.call(this,e),this.map=n,this.frameState=void 0!==i?i:null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ee))),qo="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",Uo=(qo.indexOf("firefox"),-1!==qo.indexOf("safari")&&qo.indexOf("chrom"),-1!==qo.indexOf("webkit")&&qo.indexOf("edge"),qo.indexOf("macintosh"),window.devicePixelRatio,function(){var t=!1;try{t=!!document.createElement("canvas").getContext("2d").setLineDash}catch(t){}return t}()),No=(navigator,window,window,navigator.msPointerEnabled,be),Vo=xe,Wo=function(t){return t.type==Ao},$o=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},zo=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Xo=function(t){var e=t.pointerEvent;return vt(void 0!==e,56),e.isPrimary&&0===e.button},Ko=function(t){function e(e,n,i){if(t.call(this),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,n);else if(void 0!==n&&i)this.setFlatCoordinates(n,e),this.ends_=i;else{for(var o=this.getLayout(),r=e,s=[],a=[],h=0,u=r.length;h<u;++h){var l=r[h];0===h&&(o=l.getLayout()),Vn(s,l.getFlatCoordinates()),a.push(s.length)}this.setFlatCoordinates(o,s),this.ends_=a}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.appendLineString=function(t){this.flatCoordinates?Vn(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},e.prototype.closestPointXY=function(t,e,n,i){return i<Et(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Kn(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Hn(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,n,i))},e.prototype.getCoordinateAtM=function(t,e,n){if(this.layout!=Fn&&this.layout!=An||0===this.flatCoordinates.length)return null;var i=void 0!==e&&e,o=void 0!==n&&n;return function(t,e,n,i,o,r,s){if(s)return Ri(t,e,n[n.length-1],i,o,r);var a;if(o<t[i-1])return r?((a=t.slice(0,i))[i-1]=o,a):null;if(t[t.length-1]<o)return r?((a=t.slice(t.length-i))[i-1]=o,a):null;for(var h=0,u=n.length;h<u;++h){var l=n[h];if(e!=l){if(o<t[e+i-1])return null;if(o<=t[l-1])return Ri(t,e,l,i,o,!1);e=l}}return null}(this.flatCoordinates,0,this.ends_,this.stride,t,i,o)},e.prototype.getCoordinates=function(){return Jn(this.flatCoordinates,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getLineString=function(t){return t<0||this.ends_.length<=t?null:new ki(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLineStrings=function(){for(var t=this.flatCoordinates,e=this.ends_,n=this.layout,i=[],o=0,r=0,s=e.length;r<s;++r){var a=e[r],h=new ki(t.slice(o,a),n);i.push(h),o=a}return i},e.prototype.getFlatMidpoints=function(){for(var t=[],e=this.flatCoordinates,n=0,i=this.ends_,o=this.stride,r=0,s=i.length;r<s;++r){var a=i[r];Vn(t,Si(e,n,a,o,.5)),n=a}return t},e.prototype.getSimplifiedGeometryInternal=function(t){var n=[],i=[];return n.length=ti(this.flatCoordinates,0,this.ends_,this.stride,t,n,0,i),new e(n,kn,i)},e.prototype.getType=function(){return te},e.prototype.intersectsExtent=function(t){return function(t,e,n,i,o){for(var r=0,s=n.length;r<s;++r){if(pi(t,e,n[r],i,o))return!0;e=n[r]}return!1}(this.flatCoordinates,0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var n=Dn(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===n.length?0:n[n.length-1],this.changed()},e}(Tn),Yo=function(t){function e(e,n){t.call(this),n&&!Array.isArray(e[0])?this.setFlatCoordinates(n,e):this.setCoordinates(e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.appendPoint=function(t){this.flatCoordinates?Vn(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,n,i){if(i<Et(this.getExtent(),t,e))return i;for(var o=this.flatCoordinates,r=this.stride,s=0,a=o.length;s<a;s+=r){var h=Ve(t,e,o[s],o[s+1]);if(h<i){i=h;for(var u=0;u<r;++u)n[u]=o[s+u];n.length=r}}return i},e.prototype.getCoordinates=function(){return Zn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getPoint=function(t){var e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new si(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)},e.prototype.getPoints=function(){for(var t=this.flatCoordinates,e=this.layout,n=this.stride,i=[],o=0,r=t.length;o<r;o+=n){var s=new si(t.slice(o,o+n),e);i.push(s)}return i},e.prototype.getType=function(){return Qt},e.prototype.intersectsExtent=function(t){for(var e=this.flatCoordinates,n=this.stride,i=0,o=e.length;i<o;i+=n){if(Rt(t,e[i],e[i+1]))return!0}return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=jn(this.flatCoordinates,0,t,this.stride),this.changed()},e}(Tn);var Ho=function(t){function e(e,n,i){if(t.call(this),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(e[0])){for(var o=this.getLayout(),r=e,s=[],a=[],h=0,u=r.length;h<u;++h){var l=r[h];0===h&&(o=l.getLayout());for(var c=s.length,p=l.getEnds(),f=0,d=p.length;f<d;++f)p[f]+=c;Vn(s,l.getFlatCoordinates()),a.push(p)}n=o,e=s,i=a}void 0!==n&&i?(this.setFlatCoordinates(n,e),this.endss_=i):this.setCoordinates(e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.appendPolygon=function(t){var e;if(this.flatCoordinates){var n=this.flatCoordinates.length;Vn(this.flatCoordinates,t.getFlatCoordinates());for(var i=0,o=(e=t.getEnds().slice()).length;i<o;++i)e[i]+=n}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()},e.prototype.clone=function(){for(var t=this.endss_.length,n=new Array(t),i=0;i<t;++i)n[i]=this.endss_[i].slice();return new e(this.flatCoordinates.slice(),this.layout,n)},e.prototype.closestPointXY=function(t,e,n,i){return i<Et(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(t,e,n,i,o){for(var r=0,s=n.length;r<s;++r){var a=n[r];o=Kn(t,e,a,i,o),e=a[a.length-1]}return o}(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(t,e,n,i,o,r,s,a,h,u,l){for(var c=l||[NaN,NaN],p=0,f=n.length;p<f;++p){var d=n[p];u=Hn(t,e,d,i,o,r,s,a,h,u,c),e=d[d.length-1]}return u}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,n,i))},e.prototype.containsXY=function(t,e){return function(t,e,n,i,o,r){if(0===n.length)return!1;for(var s=0,a=n.length;s<a;++s){var h=n[s];if(ui(t,e,h,i,o,r))return!0;e=h[h.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)},e.prototype.getArea=function(){return function(t,e,n,i){for(var o=0,r=0,s=n.length;r<s;++r){var a=n[r];o+=$n(t,e,a,i),e=a[a.length-1]}return o}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?mi(e=this.getOrientedFlatCoordinates().slice(),0,this.endss_,this.stride,t):e=this.flatCoordinates,function(t,e,n,i,o){for(var r=void 0!==o?o:[],s=0,a=0,h=n.length;a<h;++a){var u=n[a];r[s++]=Jn(t,e,u,i,r[s]),e=u[u.length-1]}return r.length=s,r}(e,0,this.endss_,this.stride)},e.prototype.getEndss=function(){return this.endss_},e.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=function(t,e,n,i){for(var o=[],r=[1/0,1/0,-1/0,-1/0],s=0,a=n.length;s<a;++s){var h=n[s];r=Ot(t,e,h[0],i),o.push((r[0]+r[2])/2,(r[1]+r[3])/2),e=h[h.length-1]}return o}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=function(t,e,n,i,o){for(var r=[],s=0,a=n.length;s<a;++s){var h=n[s];r=li(t,e,h,i,o,2*s,r),e=h[h.length-1]}return r}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},e.prototype.getInteriorPoints=function(){return new Yo(this.getFlatInteriorPoints().slice(),Fn)},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;!function(t,e,n,i,o){for(var r=0,s=n.length;r<s;++r)if(!yi(t,e,n[r],i,o))return!1;return!0}(t,0,this.endss_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=mi(this.orientedFlatCoordinates_,0,this.endss_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var n=[],i=[];return n.length=function(t,e,n,i,o,r,s,a){for(var h=0,u=n.length;h<u;++h){var l=n[h],c=[];s=ii(t,e,l,i,o,r,s,c),a.push(c),e=l[l.length-1]}return s}(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),n,0,i),new e(n,kn,i)},e.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;var e;if(0===t)e=0;else{var n=this.endss_[t-1];e=n[n.length-1]}var i=this.endss_[t].slice(),o=i[i.length-1];if(0!==e)for(var r=0,s=i.length;r<s;++r)i[r]-=e;return new wi(this.flatCoordinates.slice(e,o),this.layout,i)},e.prototype.getPolygons=function(){for(var t=this.layout,e=this.flatCoordinates,n=this.endss_,i=[],o=0,r=0,s=n.length;r<s;++r){var a=n[r].slice(),h=a[a.length-1];if(0!==o)for(var u=0,l=a.length;u<l;++u)a[u]-=o;var c=new wi(e.slice(o,h),t,a);i.push(c),o=h}return i},e.prototype.getType=function(){return ee},e.prototype.intersectsExtent=function(t){return function(t,e,n,i,o){for(var r=0,s=n.length;r<s;++r){var a=n[r];if(fi(t,e,a,i,o))return!0;e=a[a.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);var n=function(t,e,n,i,o){for(var r=o||[],s=0,a=0,h=n.length;a<h;++a){var u=Dn(t,e,n[a],i,r[s]);r[s++]=u,e=u[u.length-1]}return r.length=s,r}(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===n.length)this.flatCoordinates.length=0;else{var i=n[n.length-1];this.flatCoordinates.length=0===i.length?0:i[i.length-1]}this.changed()},e}(Tn),Zo=function(t,e){this.dispatcher=t,this.mapping_=e};Zo.prototype.getEvents=function(){return Object.keys(this.mapping_)},Zo.prototype.getHandlerForEvent=function(t){return this.mapping_[t]};var Jo="active";var Qo=function(t){function e(e){t.call(this),e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getActive=function(){return this.get(Jo)},e.prototype.getMap=function(){return this.map_},e.prototype.handleEvent=function(t){return!0},e.prototype.setActive=function(t){this.set(Jo,t)},e.prototype.setMap=function(t){this.map_=t},e}(Ge);var tr=function(t){function e(e){var n=e||{};t.call(this,n),n.handleDownEvent&&(this.handleDownEvent=n.handleDownEvent),n.handleDragEvent&&(this.handleDragEvent=n.handleDragEvent),n.handleMoveEvent&&(this.handleMoveEvent=n.handleMoveEvent),n.handleUpEvent&&(this.handleUpEvent=n.handleUpEvent),n.stopDown&&(this.stopDown=n.stopDown),this.handlingDownUpSequence=!1,this.trackedPointers_={},this.targetPointers=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleDownEvent=function(t){return!1},e.prototype.handleDragEvent=function(t){},e.prototype.handleEvent=function(t){if(!t.pointerEvent)return!0;var e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==Lo)this.handleDragEvent(t);else if(t.type==Go){var n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==Do){var i=this.handleDownEvent(t);i&&t.preventDefault(),this.handlingDownUpSequence=i,e=this.stopDown(i)}else t.type==jo&&this.handleMoveEvent(t);return!e},e.prototype.handleMoveEvent=function(t){},e.prototype.handleUpEvent=function(t){return!1},e.prototype.stopDown=function(t){return t},e.prototype.updateTrackedPointers_=function(t){if(function(t){var e=t.type;return e===Do||e===Lo||e===Go}(t)){var e=t.pointerEvent,n=e.pointerId.toString();t.type==Go?delete this.trackedPointers_[n]:(t.type==Do||n in this.trackedPointers_)&&(this.trackedPointers_[n]=e),this.targetPointers=ue(this.trackedPointers_)}},e}(Qo),er="vector",nr=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,ir=/^([a-z]*)$/i;function or(t){return"string"==typeof t?t:sr(t)}!function(){var t={},e=0}();function rr(t){return t[0]=qe(t[0]+.5|0,0,255),t[1]=qe(t[1]+.5|0,0,255),t[2]=qe(t[2]+.5|0,0,255),t[3]=qe(t[3],0,1),t}function sr(t){var e=t[0];e!=(0|e)&&(e=e+.5|0);var n=t[1];n!=(0|n)&&(n=n+.5|0);var i=t[2];return i!=(0|i)&&(i=i+.5|0),"rgba("+e+","+n+","+i+","+(void 0===t[3]?1:t[3])+")"}function ar(t){return Array.isArray(t)?sr(t):t}var hr=function(){var t,e={};return function(n){if(t||(t=document.createElement("div").style),!(n in e)){t.font=n;var i=t.fontFamily;if(t.font="",!i)return null;e[n]=i.split(/,\s?/)}return e[n]}}(),ur=[0,0,0,1],lr=[0,0,0,1],cr=new(function(t){function e(e){t.call(this),this.highWaterMark=void 0!==e?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.canExpireCache=function(){return this.getCount()>this.highWaterMark},e.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null,this.dispatchEvent(Me)},e.prototype.containsKey=function(t){return this.entries_.hasOwnProperty(t)},e.prototype.forEach=function(t,e){for(var n=this.oldest_;n;)t.call(e,n.value_,n.key_,this),n=n.newer},e.prototype.get=function(t){var e=this.entries_[t];return vt(void 0!==e,15),e===this.newest_||(e===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(e.newer.older=e.older,e.older.newer=e.newer),e.newer=null,e.older=this.newest_,this.newest_.newer=e,this.newest_=e),e.value_},e.prototype.remove=function(t){var e=this.entries_[t];return vt(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_},e.prototype.getCount=function(){return this.count_},e.prototype.getKeys=function(){var t,e=new Array(this.count_),n=0;for(t=this.newest_;t;t=t.older)e[n++]=t.key_;return e},e.prototype.getValues=function(){var t,e=new Array(this.count_),n=0;for(t=this.newest_;t;t=t.older)e[n++]=t.value_;return e},e.prototype.peekLast=function(){return this.oldest_.value_},e.prototype.peekLastKey=function(){return this.oldest_.key_},e.prototype.peekFirstKey=function(){return this.newest_.key_},e.prototype.pop=function(){var t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_},e.prototype.replace=function(t,e){this.get(t),this.entries_[t].value_=e},e.prototype.set=function(t,e){vt(!(t in this.entries_),16);var n={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_},e.prototype.setSize=function(t){this.highWaterMark=t},e.prototype.prune=function(){for(;this.canExpireCache();)this.pop()},e}(Se)),pr={},fr=null,dr={};!function(){var t,e,n=pr,i=["monospace","serif"],o=i.length,r="wmytzilWMYTZIL@#/&?$%10";function s(t){for(var n=gr(),s=100;s<=700;s+=300){for(var a=s+" ",h=!0,u=0;u<o;++u){var l=i[u];if(n.font=a+"32px "+l,e=n.measureText(r).width,t!=l){n.font=a+"32px "+t+","+l;var c=n.measureText(r).width;h=h&&c!=e}}if(h)return!0}return!1}function a(){var e=!0;for(var i in n)n[i]<60&&(s(i)?(n[i]=60,he(dr),fr=null,cr.clear()):(++n[i],e=!1));e&&(clearInterval(t),t=void 0)}}();function gr(){return fr||(fr=Di(1,1)),fr}var yr,vr;vr=dr;var mr=function(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale};mr.prototype.clone=function(){return new mr({opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},mr.prototype.getOpacity=function(){return this.opacity_},mr.prototype.getRotateWithView=function(){return this.rotateWithView_},mr.prototype.getRotation=function(){return this.rotation_},mr.prototype.getScale=function(){return this.scale_},mr.prototype.getSnapToPixel=function(){return!1},mr.prototype.getAnchor=function(){return ft()},mr.prototype.getImage=function(t){return ft()},mr.prototype.getHitDetectionImage=function(t){return ft()},mr.prototype.getImageState=function(){return ft()},mr.prototype.getImageSize=function(){return ft()},mr.prototype.getHitDetectionImageSize=function(){return ft()},mr.prototype.getOrigin=function(){return ft()},mr.prototype.getSize=function(){return ft()},mr.prototype.setOpacity=function(t){this.opacity_=t},mr.prototype.setRotateWithView=function(t){this.rotateWithView_=t},mr.prototype.setRotation=function(t){this.rotation_=t},mr.prototype.setScale=function(t){this.scale_=t},mr.prototype.setSnapToPixel=function(t){},mr.prototype.listenImageChange=function(t,e){return ft()},mr.prototype.load=function(){ft()},mr.prototype.unlistenImageChange=function(t,e){ft()};var _r=function(t){function e(e){var n=e||{};t.call(this,{points:1/0,fill:n.fill,radius:n.radius,stroke:n.stroke,atlasManager:n.atlasManager})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){var t=new e({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),atlasManager:this.atlasManager_});return t.setOpacity(this.getOpacity()),t.setScale(this.getScale()),t},e.prototype.setRadius=function(t){this.radius_=t,this.render_(this.atlasManager_)},e}(function(t){function e(e){var n=void 0!==e.rotateWithView&&e.rotateWithView;t.call(this,{opacity:1,rotateWithView:n,rotation:void 0!==e.rotation?e.rotation:0,scale:1}),this.checksums_=null,this.canvas_=null,this.hitDetectionCanvas_=null,this.fill_=void 0!==e.fill?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius_=void 0!==e.radius?e.radius:e.radius1,this.radius2_=e.radius2,this.angle_=void 0!==e.angle?e.angle:0,this.stroke_=void 0!==e.stroke?e.stroke:null,this.anchor_=null,this.size_=null,this.imageSize_=null,this.hitDetectionImageSize_=null,this.atlasManager_=e.atlasManager,this.render_(this.atlasManager_)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){var t=new e({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),atlasManager:this.atlasManager_});return t.setOpacity(this.getOpacity()),t.setScale(this.getScale()),t},e.prototype.getAnchor=function(){return this.anchor_},e.prototype.getAngle=function(){return this.angle_},e.prototype.getFill=function(){return this.fill_},e.prototype.getHitDetectionImage=function(t){return this.hitDetectionCanvas_},e.prototype.getImage=function(t){return this.canvas_},e.prototype.getImageSize=function(){return this.imageSize_},e.prototype.getHitDetectionImageSize=function(){return this.hitDetectionImageSize_},e.prototype.getImageState=function(){return Ti},e.prototype.getOrigin=function(){return this.origin_},e.prototype.getPoints=function(){return this.points_},e.prototype.getRadius=function(){return this.radius_},e.prototype.getRadius2=function(){return this.radius2_},e.prototype.getSize=function(){return this.size_},e.prototype.getStroke=function(){return this.stroke_},e.prototype.listenImageChange=function(t,e){},e.prototype.load=function(){},e.prototype.unlistenImageChange=function(t,e){},e.prototype.render_=function(t){var e,n,i="",o="",r=0,s=null,a=0,h=0;this.stroke_&&(null===(n=this.stroke_.getColor())&&(n=lr),n=ar(n),void 0===(h=this.stroke_.getWidth())&&(h=1),s=this.stroke_.getLineDash(),a=this.stroke_.getLineDashOffset(),Uo||(s=null,a=0),void 0===(o=this.stroke_.getLineJoin())&&(o="round"),void 0===(i=this.stroke_.getLineCap())&&(i="round"),void 0===(r=this.stroke_.getMiterLimit())&&(r=10));var u=2*(this.radius_+h)+1,l={strokeStyle:n,strokeWidth:h,size:u,lineCap:i,lineDash:s,lineDashOffset:a,lineJoin:o,miterLimit:r};if(void 0===t){var c=Di(u,u);this.canvas_=c.canvas,e=u=this.canvas_.width,this.draw_(l,c,0,0),this.createHitDetectionCanvas_(l)}else{u=Math.round(u);var p,f=!this.fill_;f&&(p=this.drawHitDetectionCanvas_.bind(this,l));var d=this.getChecksum(),g=t.add(d,u,u,this.draw_.bind(this,l),p);this.canvas_=g.image,this.origin_=[g.offsetX,g.offsetY],e=g.image.width,f?(this.hitDetectionCanvas_=g.hitImage,this.hitDetectionImageSize_=[g.hitImage.width,g.hitImage.height]):(this.hitDetectionCanvas_=this.canvas_,this.hitDetectionImageSize_=[e,e])}this.anchor_=[u/2,u/2],this.size_=[u,u],this.imageSize_=[e,e]},e.prototype.draw_=function(t,e,n,i){var o,r,s;e.setTransform(1,0,0,1,0,0),e.translate(n,i),e.beginPath();var a=this.points_;if(a===1/0)e.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{var h=void 0!==this.radius2_?this.radius2_:this.radius_;for(h!==this.radius_&&(a*=2),o=0;o<=a;o++)r=2*o*Math.PI/a-Math.PI/2+this.angle_,s=o%2==0?this.radius_:h,e.lineTo(t.size/2+s*Math.cos(r),t.size/2+s*Math.sin(r))}if(this.fill_){var u=this.fill_.getColor();null===u&&(u=ur),e.fillStyle=ar(u),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke()),e.closePath()},e.prototype.createHitDetectionCanvas_=function(t){if(this.hitDetectionImageSize_=[t.size,t.size],this.fill_)this.hitDetectionCanvas_=this.canvas_;else{var e=Di(t.size,t.size);this.hitDetectionCanvas_=e.canvas,this.drawHitDetectionCanvas_(t,e,0,0)}},e.prototype.drawHitDetectionCanvas_=function(t,e,n,i){e.setTransform(1,0,0,1,0,0),e.translate(n,i),e.beginPath();var o=this.points_;if(o===1/0)e.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{var r,s,a,h=void 0!==this.radius2_?this.radius2_:this.radius_;for(h!==this.radius_&&(o*=2),r=0;r<=o;r++)a=2*r*Math.PI/o-Math.PI/2+this.angle_,s=r%2==0?this.radius_:h,e.lineTo(t.size/2+s*Math.cos(a),t.size/2+s*Math.sin(a))}e.fillStyle=or(ur),e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.stroke()),e.closePath()},e.prototype.getChecksum=function(){var t=this.stroke_?this.stroke_.getChecksum():"-",e=this.fill_?this.fill_.getChecksum():"-";if(!this.checksums_||t!=this.checksums_[1]||e!=this.checksums_[2]||this.radius_!=this.checksums_[3]||this.radius2_!=this.checksums_[4]||this.angle_!=this.checksums_[5]||this.points_!=this.checksums_[6]){var n="r"+t+e+(void 0!==this.radius_?this.radius_.toString():"-")+(void 0!==this.radius2_?this.radius2_.toString():"-")+(void 0!==this.angle_?this.angle_.toString():"-")+(void 0!==this.points_?this.points_.toString():"-");this.checksums_=[n,t,e,this.radius_,this.radius2_,this.angle_,this.points_]}return this.checksums_[0]},e}(mr)),wr=function(t){var e=t||{};this.color_=void 0!==e.color?e.color:null,this.checksum_=void 0};wr.prototype.clone=function(){var t=this.getColor();return new wr({color:Array.isArray(t)?t.slice():t||void 0})},wr.prototype.getColor=function(){return this.color_},wr.prototype.setColor=function(t){this.color_=t,this.checksum_=void 0},wr.prototype.getChecksum=function(){if(void 0===this.checksum_){var t=this.color_;t?Array.isArray(t)||"string"==typeof t?this.checksum_="f"+or(t):this.checksum_=gt(this.color_):this.checksum_="f-"}return this.checksum_};var br=wr,xr=function(t){var e=t||{};this.color_=void 0!==e.color?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=void 0!==e.lineDash?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width,this.checksum_=void 0};xr.prototype.clone=function(){var t=this.getColor();return new xr({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},xr.prototype.getColor=function(){return this.color_},xr.prototype.getLineCap=function(){return this.lineCap_},xr.prototype.getLineDash=function(){return this.lineDash_},xr.prototype.getLineDashOffset=function(){return this.lineDashOffset_},xr.prototype.getLineJoin=function(){return this.lineJoin_},xr.prototype.getMiterLimit=function(){return this.miterLimit_},xr.prototype.getWidth=function(){return this.width_},xr.prototype.setColor=function(t){this.color_=t,this.checksum_=void 0},xr.prototype.setLineCap=function(t){this.lineCap_=t,this.checksum_=void 0},xr.prototype.setLineDash=function(t){this.lineDash_=t,this.checksum_=void 0},xr.prototype.setLineDashOffset=function(t){this.lineDashOffset_=t,this.checksum_=void 0},xr.prototype.setLineJoin=function(t){this.lineJoin_=t,this.checksum_=void 0},xr.prototype.setMiterLimit=function(t){this.miterLimit_=t,this.checksum_=void 0},xr.prototype.setWidth=function(t){this.width_=t,this.checksum_=void 0},xr.prototype.getChecksum=function(){return void 0===this.checksum_&&(this.checksum_="s",this.color_?"string"==typeof this.color_?this.checksum_+=this.color_:this.checksum_+=gt(this.color_):this.checksum_+="-",this.checksum_+=","+(void 0!==this.lineCap_?this.lineCap_.toString():"-")+","+(this.lineDash_?this.lineDash_.toString():"-")+","+(void 0!==this.lineDashOffset_?this.lineDashOffset_:"-")+","+(void 0!==this.lineJoin_?this.lineJoin_:"-")+","+(void 0!==this.miterLimit_?this.miterLimit_.toString():"-")+","+(void 0!==this.width_?this.width_.toString():"-")),this.checksum_};var Cr=xr,Pr=function(t){var e=t||{};this.geometry_=null,this.geometryFunction_=Mr,void 0!==e.geometry&&this.setGeometry(e.geometry),this.fill_=void 0!==e.fill?e.fill:null,this.image_=void 0!==e.image?e.image:null,this.renderer_=void 0!==e.renderer?e.renderer:null,this.stroke_=void 0!==e.stroke?e.stroke:null,this.text_=void 0!==e.text?e.text:null,this.zIndex_=e.zIndex};Pr.prototype.clone=function(){var t=this.getGeometry();return t&&"object"==typeof t&&(t=t.clone()),new Pr({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},Pr.prototype.getRenderer=function(){return this.renderer_},Pr.prototype.setRenderer=function(t){this.renderer_=t},Pr.prototype.getGeometry=function(){return this.geometry_},Pr.prototype.getGeometryFunction=function(){return this.geometryFunction_},Pr.prototype.getFill=function(){return this.fill_},Pr.prototype.setFill=function(t){this.fill_=t},Pr.prototype.getImage=function(){return this.image_},Pr.prototype.setImage=function(t){this.image_=t},Pr.prototype.getStroke=function(){return this.stroke_},Pr.prototype.setStroke=function(t){this.stroke_=t},Pr.prototype.getText=function(){return this.text_},Pr.prototype.setText=function(t){this.text_=t},Pr.prototype.getZIndex=function(){return this.zIndex_},Pr.prototype.setGeometry=function(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Mr,this.geometry_=t},Pr.prototype.setZIndex=function(t){this.zIndex_=t};var Er=null;function Sr(t,e){if(!Er){var n=new br({color:"rgba(255,255,255,0.4)"}),i=new Cr({color:"#3399CC",width:1.25});Er=[new Pr({image:new _r({fill:n,stroke:i,radius:5}),fill:n,stroke:i})]}return Er}function Rr(){var t={},e=[255,255,255,1],n=[0,153,255,1];return t[Jt]=[new Pr({fill:new br({color:[255,255,255,.5]})})],t[ee]=t[Jt],t[Ht]=[new Pr({stroke:new Cr({color:e,width:5})}),new Pr({stroke:new Cr({color:n,width:3})})],t[te]=t[Ht],t[ie]=t[Jt].concat(t[Ht]),t[Yt]=[new Pr({image:new _r({radius:6,fill:new br({color:n}),stroke:new Cr({color:e,width:1.5})}),zIndex:1/0})],t[Qt]=t[Yt],t[ne]=t[Jt].concat(t[Ht],t[Yt]),t}function Mr(t){return t.getGeometry()}var kr="renderOrder",Ir=function(t){function e(e){var n=e||{},i=ae({},n);delete i.style,delete i.renderBuffer,delete i.updateWhileAnimating,delete i.updateWhileInteracting,t.call(this,i),this.declutter_=void 0!==n.declutter&&n.declutter,this.renderBuffer_=void 0!==n.renderBuffer?n.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(n.style),this.updateWhileAnimating_=void 0!==n.updateWhileAnimating&&n.updateWhileAnimating,this.updateWhileInteracting_=void 0!==n.updateWhileInteracting&&n.updateWhileInteracting,this.renderMode_=n.renderMode||er,this.type=no}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDeclutter=function(){return this.declutter_},e.prototype.setDeclutter=function(t){this.declutter_=t},e.prototype.getRenderBuffer=function(){return this.renderBuffer_},e.prototype.getRenderOrder=function(){return this.get(kr)},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},e.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},e.prototype.setRenderOrder=function(t){this.set(kr,t)},e.prototype.setStyle=function(t){this.style_=void 0!==t?t:Sr,this.styleFunction_=null===t?void 0:function(t){var e;if("function"==typeof t)e=t;else{var n;if(Array.isArray(t))n=t;else vt("function"==typeof t.getZIndex,41),n=[t];e=function(){return n}}return e}(this.style_),this.changed()},e.prototype.getRenderMode=function(){return this.renderMode_},e}(co);Ir.prototype.getSource;var Fr=Ir,Ar="add",Or="remove",Tr="length",Lr=function(t){function e(e,n){t.call(this,e),this.element=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ee),jr=function(t){function e(e,n){t.call(this);var i=n||{};if(this.unique_=!!i.unique,this.array_=e||[],this.unique_)for(var o=0,r=this.array_.length;o<r;++o)this.assertUnique_(this.array_[o],o);this.updateLength_()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},e.prototype.extend=function(t){for(var e=0,n=t.length;e<n;++e)this.push(t[e]);return this},e.prototype.forEach=function(t){for(var e=this.array_,n=0,i=e.length;n<i;++n)t(e[n],n,e)},e.prototype.getArray=function(){return this.array_},e.prototype.item=function(t){return this.array_[t]},e.prototype.getLength=function(){return this.get(Tr)},e.prototype.insertAt=function(t,e){this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Lr(Ar,e))},e.prototype.pop=function(){return this.removeAt(this.getLength()-1)},e.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var e=this.getLength();return this.insertAt(e,t),this.getLength()},e.prototype.remove=function(t){for(var e=this.array_,n=0,i=e.length;n<i;++n)if(e[n]===t)return this.removeAt(n)},e.prototype.removeAt=function(t){var e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Lr(Or,e)),e},e.prototype.setAt=function(t,e){var n=this.getLength();if(t<n){this.unique_&&this.assertUnique_(e,t);var i=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Lr(Or,i)),this.dispatchEvent(new Lr(Ar,e))}else{for(var o=n;o<t;++o)this.insertAt(o,void 0);this.insertAt(t,e)}},e.prototype.updateLength_=function(){this.set(Tr,this.array_.length)},e.prototype.assertUnique_=function(t,e){for(var n=0,i=this.array_.length;n<i;++n)if(this.array_[n]===t&&n!==e)throw new yt(58)},e}(Ge),Dr="arraybuffer",Gr="json",Br="text",qr="xml";function Ur(t,e){return function(t,e,n,i){return function(o,r,s){var a=new XMLHttpRequest;a.open("GET","function"==typeof t?t(o,r,s):t,!0),e.getType()==Dr&&(a.responseType="arraybuffer"),a.onload=function(t){if(!a.status||a.status>=200&&a.status<300){var o,r=e.getType();r==Gr||r==Br?o=a.responseText:r==qr?(o=a.responseXML)||(o=(new DOMParser).parseFromString(a.responseText,"application/xml")):r==Dr&&(o=a.response),o?n.call(this,e.readFeatures(o,{featureProjection:s}),e.readProjection(o),e.getLastExtent()):i.call(this)}else i.call(this)}.bind(this),a.onerror=function(){i.call(this)}.bind(this),a.send()}}(t,e,(function(t,e){"function"==typeof this.addFeatures&&this.addFeatures(t)}),Ce)}function Nr(t,e){return[[-1/0,-1/0,1/0,1/0]]}var Vr="addfeature",Wr="changefeature",$r="clear",zr="removefeature",Xr=n("A1R+"),Kr=n.n(Xr),Yr=function(t){this.rbush_=Kr()(t,void 0),this.items_={}};Yr.prototype.insert=function(t,e){var n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(n),this.items_[gt(e)]=n},Yr.prototype.load=function(t,e){for(var n=new Array(e.length),i=0,o=e.length;i<o;i++){var r=t[i],s=e[i],a={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],value:s};n[i]=a,this.items_[gt(s)]=a}this.rbush_.load(n)},Yr.prototype.remove=function(t){var e=gt(t),n=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(n)},Yr.prototype.update=function(t,e){var n=this.items_[gt(e)];Tt([n.minX,n.minY,n.maxX,n.maxY],t)||(this.remove(e),this.insert(t,e))},Yr.prototype.getAll=function(){return this.rbush_.all().map((function(t){return t.value}))},Yr.prototype.getInExtent=function(t){var e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map((function(t){return t.value}))},Yr.prototype.forEach=function(t,e){return this.forEach_(this.getAll(),t,e)},Yr.prototype.forEachInExtent=function(t,e,n){return this.forEach_(this.getInExtent(t),e,n)},Yr.prototype.forEach_=function(t,e,n){for(var i,o=0,r=t.length;o<r;o++)if(i=e.call(n,t[o]))return i;return i},Yr.prototype.isEmpty=function(){return le(this.items_)},Yr.prototype.clear=function(){this.rbush_.clear(),this.items_={}},Yr.prototype.getExtent=function(t){var e=this.rbush_.toJSON();return It(e.minX,e.minY,e.maxX,e.maxY,t)},Yr.prototype.concat=function(t){for(var e in this.rbush_.load(t.rbush_.all()),t.items_)this.items_[e]=t.items_[e]};var Hr=Yr,Zr=function(t){function e(e,n){t.call(this,e),this.feature=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ee),Jr=function(t){function e(e){var n=e||{};t.call(this,{attributions:n.attributions,projection:void 0,state:$i,wrapX:void 0===n.wrapX||n.wrapX}),this.loader_=Ce,this.format_=n.format,this.overlaps_=null==n.overlaps||n.overlaps,this.url_=n.url,void 0!==n.loader?this.loader_=n.loader:void 0!==this.url_&&(vt(this.format_,7),this.loader_=Ur(this.url_,this.format_)),this.strategy_=void 0!==n.strategy?n.strategy:Nr;var i,o,r=void 0===n.useSpatialIndex||n.useSpatialIndex;this.featuresRtree_=r?new Hr:null,this.loadedExtentsRtree_=new Hr,this.nullGeometryFeatures_={},this.idIndex_={},this.undefIdIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(n.features)?o=n.features:n.features&&(o=(i=n.features).getArray()),r||void 0!==i||(i=new jr(o)),void 0!==o&&this.addFeaturesInternal(o),void 0!==i&&this.bindFeaturesCollection_(i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature=function(t){this.addFeatureInternal(t),this.changed()},e.prototype.addFeatureInternal=function(t){var e=gt(t);if(this.addToIndex_(e,t)){this.setupChangeEvents_(e,t);var n=t.getGeometry();if(n){var i=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(i,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Zr(Vr,t))}},e.prototype.setupChangeEvents_=function(t,e){this.featureChangeKeys_[t]=[ge(e,Re,this.handleFeatureChange_,this),ge(e,se,this.handleFeatureChange_,this)]},e.prototype.addToIndex_=function(t,e){var n=!0,i=e.getId();return void 0!==i?i.toString()in this.idIndex_?n=!1:this.idIndex_[i.toString()]=e:(vt(!(t in this.undefIdIndex_),30),this.undefIdIndex_[t]=e),n},e.prototype.addFeatures=function(t){this.addFeaturesInternal(t),this.changed()},e.prototype.addFeaturesInternal=function(t){for(var e=[],n=[],i=[],o=0,r=t.length;o<r;o++){var s=t[o],a=gt(s);this.addToIndex_(a,s)&&n.push(s)}for(var h=0,u=n.length;h<u;h++){var l=n[h],c=gt(l);this.setupChangeEvents_(c,l);var p=l.getGeometry();if(p){var f=p.getExtent();e.push(f),i.push(l)}else this.nullGeometryFeatures_[c]=l}this.featuresRtree_&&this.featuresRtree_.load(e,i);for(var d=0,g=n.length;d<g;d++)this.dispatchEvent(new Zr(Vr,n[d]))},e.prototype.bindFeaturesCollection_=function(t){var e=!1;ge(this,Vr,(function(n){e||(e=!0,t.push(n.feature),e=!1)})),ge(this,zr,(function(n){e||(e=!0,t.remove(n.feature),e=!1)})),ge(t,Ar,(function(t){e||(e=!0,this.addFeature(t.element),e=!1)}),this),ge(t,Or,(function(t){e||(e=!0,this.removeFeature(t.element),e=!1)}),this),this.featuresCollection_=t},e.prototype.clear=function(t){if(t){for(var e in this.featureChangeKeys_){this.featureChangeKeys_[e].forEach(me)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.undefIdIndex_={})}else if(this.featuresRtree_)for(var n in this.featuresRtree_.forEach(this.removeFeatureInternal,this),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n]);this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.loadedExtentsRtree_.clear(),this.nullGeometryFeatures_={};var i=new Zr($r);this.dispatchEvent(i),this.changed()},e.prototype.forEachFeature=function(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},e.prototype.forEachFeatureAtCoordinateDirect=function(t,e){var n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,(function(n){return n.getGeometry().intersectsCoordinate(t)?e(n):void 0}))},e.prototype.forEachFeatureInExtent=function(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},e.prototype.forEachFeatureIntersectingExtent=function(t,e){return this.forEachFeatureInExtent(t,(function(n){if(n.getGeometry().intersectsExtent(t)){var i=e(n);if(i)return i}}))},e.prototype.getFeaturesCollection=function(){return this.featuresCollection_},e.prototype.getFeatures=function(){var t;return this.featuresCollection_?t=this.featuresCollection_.getArray():this.featuresRtree_&&(t=this.featuresRtree_.getAll(),le(this.nullGeometryFeatures_)||Vn(t,ue(this.nullGeometryFeatures_))),t},e.prototype.getFeaturesAtCoordinate=function(t){var e=[];return this.forEachFeatureAtCoordinateDirect(t,(function(t){e.push(t)})),e},e.prototype.getFeaturesInExtent=function(t){return this.featuresRtree_.getInExtent(t)},e.prototype.getClosestFeatureToCoordinate=function(t,e){var n=t[0],i=t[1],o=null,r=[NaN,NaN],s=1/0,a=[-1/0,-1/0,1/0,1/0],h=e||be;return this.featuresRtree_.forEachInExtent(a,(function(t){if(h(t)){var e=t.getGeometry(),u=s;if((s=e.closestPointXY(n,i,r,s))<u){o=t;var l=Math.sqrt(s);a[0]=n-l,a[1]=i-l,a[2]=n+l,a[3]=i+l}}})),o},e.prototype.getExtent=function(t){return this.featuresRtree_.getExtent(t)},e.prototype.getFeatureById=function(t){var e=this.idIndex_[t.toString()];return void 0!==e?e:null},e.prototype.getFormat=function(){return this.format_},e.prototype.getOverlaps=function(){return this.overlaps_},e.prototype.getUrl=function(){return this.url_},e.prototype.handleFeatureChange_=function(t){var e=t.target,n=gt(e),i=e.getGeometry();if(i){var o=i.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)}else n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[n]=e);var r=e.getId();if(void 0!==r){var s=r.toString();n in this.undefIdIndex_?(delete this.undefIdIndex_[n],this.idIndex_[s]=e):this.idIndex_[s]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[s]=e)}else n in this.undefIdIndex_||(this.removeFromIdIndex_(e),this.undefIdIndex_[n]=e);this.changed(),this.dispatchEvent(new Zr(Wr,e))},e.prototype.hasFeature=function(t){var e=t.getId();return void 0!==e?e in this.idIndex_:gt(t)in this.undefIdIndex_},e.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&le(this.nullGeometryFeatures_)},e.prototype.loadFeatures=function(t,e,n){var i=this,o=this.loadedExtentsRtree_,r=this.strategy_(t,e);this.loading=!1;for(var s=function(t,s){var a=r[t];o.forEachInExtent(a,(function(t){return St(t.extent,a)}))||(i.loader_.call(i,a,e,n),o.insert(a,{extent:a.slice()}),i.loading=i.loader_!==Ce)},a=0,h=r.length;a<h;++a)s(a)},e.prototype.removeLoadedExtent=function(t){var e,n=this.loadedExtentsRtree_;n.forEachInExtent(t,(function(n){if(Tt(n.extent,t))return e=n,!0})),e&&n.remove(e)},e.prototype.removeFeature=function(t){var e=gt(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t),this.changed()},e.prototype.removeFeatureInternal=function(t){var e=gt(t);this.featureChangeKeys_[e].forEach(me),delete this.featureChangeKeys_[e];var n=t.getId();void 0!==n?delete this.idIndex_[n.toString()]:delete this.undefIdIndex_[e],this.dispatchEvent(new Zr(zr,t))},e.prototype.removeFromIdIndex_=function(t){var e=!1;for(var n in this.idIndex_)if(this.idIndex_[n]===t){delete this.idIndex_[n],e=!0;break}return e},e.prototype.setLoader=function(t){this.loader_=t},e}(Xi),Qr="Point",ts="LineString",es="Polygon",ns="Circle",is="Ellipse",os="drawstart",rs="drawend",ss=function(t){function e(e,n){t.call(this,e),this.feature=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ee);var as=function(t){function e(e){var n=e;n.stopDown||(n.stopDown=xe),t.call(this,n),this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=function(t){var e;t===Yt||t===Qt?e=Qr:t===Ht||t===te||t===oe?e=ts:t===Jt||t===ee?e=es:t===ie?e=ns:t===re&&(e=is);return e}(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_===es?3:2,this.maxPoints_=e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:be;var i,o=e.geometryFunction;if(!o)if(this.type_===ie)o=function(t,e){var n=e||new Bn([NaN,NaN]),i=Eo(t[0],t[1]);return n.setCenterAndRadius(t[0],Math.sqrt(i)),n};else if(this.type_===oe)this.minPoints_=3,this.maxPoints_=3,o=function(t,e){if(t.length>2){var n=t[0],i=t[1],o=t[2],r=[i[0]-n[0],i[1]-n[1]];if(0===r[1])t=[[n,n,n,n]];else{var s=[-1*r[1],r[0]],a=r[0]/r[1],h=(o[0]+a*(i[1]-o[1])-i[0])/(s[0]-s[1]*a),u=[h*s[0],h*s[1]];t=[[[n[0]-u[0],n[1]-u[1]],[i[0]-u[0],i[1]-u[1]],[i[0]+u[0],i[1]+u[1]],[n[0]+u[0],n[1]+u[1]]]]}}else t=[t];var l=e;return l?l.setCoordinates(t):l=new Ii(t),l};else if(this.type_===re)this.minPoints_=3,this.maxPoints_=3,o=function(t,e){if(t.length>2){var n=t[0],i=t[1],o=t[2],r=[i[0]-n[0],i[1]-n[1]],s=[n[0]+.5*r[0],n[1]+.5*r[1]];if(0===r[1])t=[[n,n,n,n]];else{var a=[-1*r[1],r[0]],h=r[0]/r[1],u=(o[0]+h*(i[1]-o[1])-i[0])/(a[0]-a[1]*h),l=[u*a[0],u*a[1]];t=[[[n[0],n[1]],[s[0]-l[0],s[1]-l[1]],[i[0],i[1]],[s[0]+l[0],s[1]+l[1]]]]}}else t=[t];var c=e;return c?c.setCoordinates(t):c=new Pi(t),c};else{var r,s=this.mode_;s===Qr?r=si:s===ts?r=ki:s===es&&(r=wi),o=function(t,e){var n=e;return n?s===es?t[0].length?n.setCoordinates([t[0].concat([t[0][0]])]):n.setCoordinates([]):n.setCoordinates(t):n=new r(t),n}}this.geometryFunction_=o,this.dragVertexDelay_=void 0!==e.dragVertexDelay?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new Fr({source:new Jr({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:(i=Rr(),function(t,e){return i[t.getGeometry().getType()]}),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:$o,this.freehandCondition_,e.freehand?this.freehandCondition_=No:this.freehandCondition_=e.freehandCondition?e.freehandCondition:zo,ge(this,De(Jo),this.updateState_,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setMap=function(e){t.prototype.setMap.call(this,e),this.updateState_()},e.prototype.getOverlay=function(){return this.overlay_},e.prototype.handleEvent=function(e){e.originalEvent.type===ke&&e.preventDefault(),this.freehand_=this.mode_!==Qr&&this.freehandCondition_(e);var n=e.type===jo,i=!0;!this.freehand_&&this.lastDragTime_&&e.type===Lo&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,n=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0));return this.freehand_&&e.type===Lo&&null!==this.sketchFeature_?(this.addToDrawing_(e),i=!1):this.freehand_&&e.type===Do?i=!1:n?(i=e.type===jo)&&this.freehand_?i=this.handlePointerMove_(e):("mouse"==e.pointerEvent.pointerType||e.type===Lo&&void 0===this.downTimeout_)&&this.handlePointerMove_(e):e.type===To&&(i=!1),t.prototype.handleEvent.call(this,e)&&i},e.prototype.handleDownEvent=function(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t),!0):!!this.condition_(t)&&(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new Bo(jo,t.map,t.pointerEvent,!1,t.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=t.pixel,!0)},e.prototype.handleUpEvent=function(t){var e=!0;this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t);var n=this.mode_===ns;return this.shouldHandle_?(this.finishCoordinate_?this.freehand_||n?this.finishDrawing():this.atFinish_(t)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t):(this.startDrawing_(t),this.mode_===Qr&&this.finishDrawing()),e=!1):this.freehand_&&(this.finishCoordinate_=null,this.abortDrawing_()),!e&&this.stopClick_&&t.stopPropagation(),e},e.prototype.handlePointerMove_=function(t){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var e=this.downPx_,n=t.pixel,i=e[0]-n[0],o=e[1]-n[1],r=i*i+o*o;if(this.shouldHandle_=this.freehand_?r>this.squaredClickTolerance_:r<=this.squaredClickTolerance_,!this.shouldHandle_)return!0}return this.finishCoordinate_?this.modifyDrawing_(t):this.createOrUpdateSketchPoint_(t),!0},e.prototype.atFinish_=function(t){var e=!1;if(this.sketchFeature_){var n=!1,i=[this.finishCoordinate_];if(this.mode_===ts)n=this.sketchCoords_.length>this.minPoints_;else if(this.mode_===es){var o=this.sketchCoords_;n=o[0].length>this.minPoints_,i=[o[0][0],o[0][o[0].length-2]]}if(n)for(var r=t.map,s=0,a=i.length;s<a;s++){var h=i[s],u=r.getPixelFromCoordinate(h),l=t.pixel,c=l[0]-u[0],p=l[1]-u[1],f=this.freehand_?1:this.snapTolerance_;if(e=Math.sqrt(c*c+p*p)<=f){this.finishCoordinate_=h;break}}}return e},e.prototype.createOrUpdateSketchPoint_=function(t){var e=t.coordinate.slice();this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new Ei(new si(e)),this.updateSketchFeatures_())},e.prototype.startDrawing_=function(t){var e=t.coordinate;this.finishCoordinate_=e,this.mode_===Qr?this.sketchCoords_=e.slice():this.mode_===es?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Ei(new ki(this.sketchLineCoords_)));var n=this.geometryFunction_(this.sketchCoords_);this.sketchFeature_=new Ei,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(n),this.updateSketchFeatures_(),this.dispatchEvent(new ss(os,this.sketchFeature_))},e.prototype.modifyDrawing_=function(t){var e,n,i,o=t.coordinate,r=this.sketchFeature_.getGeometry();(this.mode_===Qr?n=this.sketchCoords_:this.mode_===es?(n=(e=this.sketchCoords_[0])[e.length-1],this.atFinish_(t)&&(o=this.finishCoordinate_.slice())):n=(e=this.sketchCoords_)[e.length-1],n[0]=o[0],n[1]=o[1],this.geometryFunction_(this.sketchCoords_,r),this.sketchPoint_)&&this.sketchPoint_.getGeometry().setCoordinates(o);if(this.mode_===is)if(this.sketchLine_||(this.sketchLine_=new Ei(new ki([0,0]))),i=this.sketchLine_.getGeometry(),this.sketchCoords_.length<3)i.setCoordinates(this.sketchCoords_);else{var s=[((e=r.getCoordinates()[0])[0][0]+e[2][0])/2,(e[0][1]+e[2][1])/2];i.setCoordinates([e[0],s,e[3]])}else if(r.getType()==Jt&&this.mode_!==es){this.sketchLine_||(this.sketchLine_=new Ei);var a=r.getLinearRing(0);(i=this.sketchLine_.getGeometry())?(i.setFlatCoordinates(a.getLayout(),a.getFlatCoordinates()),i.changed()):(i=new ki(a.getFlatCoordinates(),a.getLayout()),this.sketchLine_.setGeometry(i))}else this.sketchLineCoords_&&(i=this.sketchLine_.getGeometry()).setCoordinates(this.sketchLineCoords_);this.updateSketchFeatures_()},e.prototype.addToDrawing_=function(t){var e,n,i=t.coordinate,o=this.sketchFeature_.getGeometry();this.mode_===ts||this.mode_===is?(this.finishCoordinate_=i.slice(),(n=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?n.pop():e=!0),n.push(i.slice()),this.geometryFunction_(n,o)):this.mode_===es&&((n=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?n.pop():e=!0),n.push(i.slice()),e&&(this.finishCoordinate_=n[0]),this.geometryFunction_(this.sketchCoords_,o)),this.updateSketchFeatures_(),e&&this.finishDrawing()},e.prototype.removeLastPoint=function(){if(this.sketchFeature_){var t,e=this.sketchFeature_.getGeometry();this.mode_===ts?((t=this.sketchCoords_).splice(-2,1),this.geometryFunction_(t,e),t.length>=2&&(this.finishCoordinate_=t[t.length-2].slice())):this.mode_===es&&((t=this.sketchCoords_[0]).splice(-2,1),this.sketchLine_.getGeometry().setCoordinates(t),this.geometryFunction_(this.sketchCoords_,e)),0===t.length&&(this.finishCoordinate_=null),this.updateSketchFeatures_()}},e.prototype.finishDrawing=function(){var t=this.abortDrawing_();if(t){var e=this.sketchCoords_,n=t.getGeometry();this.mode_===ts?(e.pop(),this.geometryFunction_(e,n)):this.mode_===es&&(e[0].pop(),this.geometryFunction_(e,n),e=n.getCoordinates()),this.type_===Qt?t.setGeometry(new Yo([e])):this.type_===te?t.setGeometry(new Ko([e])):this.type_===ee&&t.setGeometry(new Ho([e])),this.dispatchEvent(new ss(rs,t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t)}},e.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var t=this.sketchFeature_;return t&&(this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0)),t},e.prototype.extend=function(t){var e=t.getGeometry();this.sketchFeature_=t,this.sketchCoords_=e.getCoordinates();var n=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=n.slice(),this.sketchCoords_.push(n.slice()),this.updateSketchFeatures_(),this.dispatchEvent(new ss(os,this.sketchFeature_))},e.prototype.updateSketchFeatures_=function(){var t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);var e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)},e.prototype.updateState_=function(){var t=this.getMap(),e=this.getActive();t&&e||this.abortDrawing_(),this.overlay_.setMap(e?t:null)},e}(tr),hs={data:function(){return{pendingAnnotation:{},autoplayDrawTimeout:null}},computed:{hasSelectedLabel:function(){return!!this.selectedLabel},hasNoSelectedLabel:function(){return!this.selectedLabel},isDrawing:function(){return this.interactionMode.startsWith("draw")},isDrawingPoint:function(){return"drawPoint"===this.interactionMode},isDrawingRectangle:function(){return"drawRectangle"===this.interactionMode},isDrawingCircle:function(){return"drawCircle"===this.interactionMode},isDrawingLineString:function(){return"drawLineString"===this.interactionMode},isDrawingPolygon:function(){return"drawPolygon"===this.interactionMode},hasPendingAnnotation:function(){return this.pendingAnnotation.shape&&this.pendingAnnotation.frames.length>0&&this.pendingAnnotation.points.length>0},cantFinishDrawAnnotation:function(){return!this.hasPendingAnnotation},cantFinishTrackAnnotation:function(){return!this.pendingAnnotation.frames||1!==this.pendingAnnotation.frames.length}},methods:{requireSelectedLabel:function(){this.$emit("requires-selected-label"),this.resetInteractionMode()},initPendingAnnotationLayer:function(t){this.pendingAnnotationSource=new Jr,this.pendingAnnotationLayer=new Fr({opacity:.5,source:this.pendingAnnotationSource,updateWhileAnimating:!0,updateWhileInteracting:!0,style:f.editing}),t.addLayer(this.pendingAnnotationLayer)},draw:function(t){this["isDrawing"+t]?this.resetInteractionMode():this.hasNoSelectedLabel?this.requireSelectedLabel():this.canAdd&&(this.interactionMode="draw"+t)},drawPoint:function(){this.draw("Point")},drawRectangle:function(){this.draw("Rectangle")},drawCircle:function(){this.draw("Circle")},drawLineString:function(){this.draw("LineString")},drawPolygon:function(){this.draw("Polygon")},maybeUpdateDrawInteractionMode:function(t){if(this.resetPendingAnnotation(),this.drawInteraction&&(this.map.removeInteraction(this.drawInteraction),this.drawInteraction=void 0),this.isDrawing&&this.hasSelectedLabel){var e=t.slice(4);this.pause(),this.drawInteraction=new as({source:this.pendingAnnotationSource,type:e,style:f.editing}),this.drawInteraction.on("drawend",this.extendPendingAnnotation),this.map.addInteraction(this.drawInteraction),this.pendingAnnotation.shape=e}},finishDrawAnnotation:function(){(this.isDrawing||this.isUsingPolygonBrush)&&(this.hasPendingAnnotation&&this.$emit("create-annotation",this.pendingAnnotation),this.resetInteractionMode())},finishTrackAnnotation:function(){this.isDrawing&&(this.hasPendingAnnotation&&this.$emit("track-annotation",this.pendingAnnotation),this.resetInteractionMode())},resetPendingAnnotation:function(){this.pendingAnnotationSource.clear(),this.pendingAnnotation={shape:"",frames:[],points:[]}},extendPendingAnnotation:function(t){var e=this.pendingAnnotation.frames[this.pendingAnnotation.frames.length-1];void 0===e||e<this.video.currentTime?(this.pendingAnnotation.frames.push(this.video.currentTime),this.pendingAnnotation.points.push(this.getPointsFromGeometry(t.feature.getGeometry())),!this.video.ended&&this.autoplayDraw>0&&(this.play(),window.clearTimeout(this.autoplayDrawTimeout),this.autoplayDrawTimeout=window.setTimeout(this.pause,1e3*this.autoplayDraw))):this.pendingAnnotationSource.once("addfeature",(function(t){this.removeFeature(t.feature)}))}},created:function(){this.$once("map-ready",this.initPendingAnnotationLayer),this.canAdd&&(this.$watch("interactionMode",this.maybeUpdateDrawInteractionMode),a.on("a",this.drawPoint,0,this.listenerSet),a.on("s",this.drawRectangle,0,this.listenerSet),a.on("d",this.drawCircle,0,this.listenerSet),a.on("f",this.drawLineString,0,this.listenerSet),a.on("g",this.drawPolygon,0,this.listenerSet),a.on("Enter",this.finishDrawAnnotation,0,this.listenerSet))}},us="modifystart",ls="modifyend",cs=function(t){function e(e,n,i){t.call(this,e),this.features=n,this.mapBrowserEvent=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ee);function ps(t,e){return t.index-e.index}function fs(t,e){var n,i,o=e.geometry;if(o.getType()===ie){var r=o;if(1===e.index){var s=Eo(r.getCenter(),t),a=Math.sqrt(s)-r.getRadius();return a*a}}return n=t,i=e.segment,Eo(n,Co(n,i))}function ds(t,e){var n=e.geometry;return n.getType()===ie&&1===e.index||n.getType()===re||n.getType()===oe?n.getClosestPoint(t):Co(t,e.segment)}var gs=function(t){function e(e){var n,i;if(t.call(this,e),this.condition_=e.condition?e.condition:Xo,this.defaultDeleteCondition_=function(t){return function(t){var e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey}(t)&&Wo(t)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:No,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.modified_=!1,this.rBush_=new Hr,this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Fr({source:new Jr({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:(n=Rr(),function(t,e){return n[Yt]}),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,Rectangle:this.writePolygonGeometry_,Ellipse:this.writePolygonGeometry_,Circle:this.writeCircleGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_},this.source_=null,e.source?(this.source_=e.source,i=new jr(this.source_.getFeatures()),ge(this.source_,Vr,this.handleSourceAdd_,this),ge(this.source_,zr,this.handleSourceRemove_,this)):i=e.features,!i)throw new Error("The modify interaction requires features or a source");this.features_=i,this.features_.forEach(this.addFeature_.bind(this)),ge(this.features_,Ar,this.handleFeatureAdd_,this),ge(this.features_,Or,this.handleFeatureRemove_,this),this.lastPointerEvent_=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature_=function(t){var e=t.getGeometry();e&&e.getType()in this.SEGMENT_WRITERS_&&this.SEGMENT_WRITERS_[e.getType()].call(this,t,e);var n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,n),ge(t,Re,this.handleFeatureChange_,this)},e.prototype.willModifyFeatures_=function(t){this.modified_||(this.modified_=!0,this.dispatchEvent(new cs(us,this.features_,t)))},e.prototype.removeFeature_=function(t){this.removeFeatureSegmentData_(t),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),ve(t,Re,this.handleFeatureChange_,this)},e.prototype.removeFeatureSegmentData_=function(t){var e=this.rBush_,n=[];e.forEach((function(e){t===e.feature&&n.push(e)}));for(var i=n.length-1;i>=0;--i)e.remove(n[i])},e.prototype.setActive=function(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.prototype.setActive.call(this,e)},e.prototype.setMap=function(e){this.overlay_.setMap(e),t.prototype.setMap.call(this,e)},e.prototype.getOverlay=function(){return this.overlay_},e.prototype.handleSourceAdd_=function(t){t.feature&&this.features_.push(t.feature)},e.prototype.handleSourceRemove_=function(t){t.feature&&this.features_.remove(t.feature)},e.prototype.handleFeatureAdd_=function(t){this.addFeature_(t.element)},e.prototype.handleFeatureChange_=function(t){if(!this.changingFeature_){var e=t.target;this.removeFeature_(e),this.addFeature_(e)}},e.prototype.handleFeatureRemove_=function(t){var e=t.element;this.removeFeature_(e)},e.prototype.writePointGeometry_=function(t,e){var n=e.getCoordinates(),i={feature:t,geometry:e,segment:[n,n]};this.rBush_.insert(e.getExtent(),i)},e.prototype.writeMultiPointGeometry_=function(t,e){for(var n=e.getCoordinates(),i=0,o=n.length;i<o;++i){var r=n[i],s={feature:t,geometry:e,depth:[i],index:i,segment:[r,r]};this.rBush_.insert(e.getExtent(),s)}},e.prototype.writeLineStringGeometry_=function(t,e){for(var n=e.getCoordinates(),i=0,o=n.length-1;i<o;++i){var r=n.slice(i,i+2),s={feature:t,geometry:e,index:i,segment:r};this.rBush_.insert(Pt(r),s)}},e.prototype.writeMultiLineStringGeometry_=function(t,e){for(var n=e.getCoordinates(),i=0,o=n.length;i<o;++i)for(var r=n[i],s=0,a=r.length-1;s<a;++s){var h=r.slice(s,s+2),u={feature:t,geometry:e,depth:[i],index:s,segment:h};this.rBush_.insert(Pt(h),u)}},e.prototype.writePolygonGeometry_=function(t,e){for(var n=e.getCoordinates(),i=0,o=n.length;i<o;++i)for(var r=n[i],s=0,a=r.length-1;s<a;++s){var h=r.slice(s,s+2),u={feature:t,geometry:e,depth:[i],index:s,segment:h};this.rBush_.insert(Pt(h),u)}},e.prototype.writeMultiPolygonGeometry_=function(t,e){for(var n=e.getCoordinates(),i=0,o=n.length;i<o;++i)for(var r=n[i],s=0,a=r.length;s<a;++s)for(var h=r[s],u=0,l=h.length-1;u<l;++u){var c=h.slice(u,u+2),p={feature:t,geometry:e,depth:[s,i],index:u,segment:c};this.rBush_.insert(Pt(c),p)}},e.prototype.writeCircleGeometry_=function(t,e){var n=e.getCenter(),i={feature:t,geometry:e,index:0,segment:[n,n]},o={feature:t,geometry:e,index:1,segment:[n,n]},r=[i,o];i.featureSegments=o.featureSegments=r,this.rBush_.insert(At(n),i),this.rBush_.insert(e.getExtent(),o)},e.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var n=e.getGeometriesArray(),i=0;i<n.length;++i)this.SEGMENT_WRITERS_[n[i].getType()].call(this,t,n[i])},e.prototype.createOrUpdateVertexFeature_=function(t){var e=this.vertexFeature_;e?e.getGeometry().setCoordinates(t):(e=new Ei(new si(t)),this.vertexFeature_=e,this.overlay_.getSource().addFeature(e));return e},e.prototype.handleEvent=function(e){return!e.pointerEvent||(this.lastPointerEvent_=e,e.map.getView().getInteracting()||e.type!=jo||this.handlingDownUpSequence||this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(n=!(e.type!=Ao||!this.ignoreNextSingleClick_)||this.removePoint()),e.type==Ao&&(this.ignoreNextSingleClick_=!1),t.prototype.handleEvent.call(this,e)&&!n);var n},e.prototype.handleDragEvent=function(t){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(t);for(var e=t.coordinate,n=0,i=this.dragSegments_.length;n<i;++n){for(var o=this.dragSegments_[n],r=o[0],s=r.depth,a=r.geometry,h=void 0,u=r.segment,l=o[1];e.length<a.getStride();)e.push(u[l][e.length]);switch(a.getType()){case Yt:h=e,u[0]=u[1]=e;break;case Qt:(h=a.getCoordinates())[r.index]=e,u[0]=u[1]=e;break;case Ht:(h=a.getCoordinates())[r.index+l]=e,u[l]=e;break;case te:case Jt:(h=a.getCoordinates())[s[0]][r.index+l]=e,u[l]=e;break;case ee:(h=a.getCoordinates())[s[1]][s[0]][r.index+l]=e,u[l]=e;break;case oe:var c=(v=(h=a.getCoordinates())[s[0]])[(r.index+l+2)%4],p=[e[0]-c[0],e[1]-c[1]],f=[(m=v[(r.index+l+1)%4])[0]-c[0],m[1]-c[1]],d=Math.sqrt(f[0]*f[0]+f[1]*f[1]);f[0]=f[0]/d,f[1]=f[1]/d;var g=p[0]*f[0]+p[1]*f[1];v[(r.index+l+1)%4]=[c[0]+g*f[0],c[1]+g*f[1]];var y=[(_=v[(r.index+l+3)%4])[0]-c[0],_[1]-c[1]];d=Math.sqrt(y[0]*y[0]+y[1]*y[1]),y[0]=y[0]/d,y[1]=y[1]/d,g=p[0]*y[0]+p[1]*y[1],v[(r.index+l+3)%4]=[c[0]+g*y[0],c[1]+g*y[1]],v[r.index+l]=e;break;case re:var v,m=(v=(h=a.getCoordinates())[s[0]])[(r.index+l+1)%4],_=(c=v[(r.index+l+2)%4],v[(r.index+l+3)%4]),w=Math.sqrt(Math.pow(m[0]-_[0],2)+Math.pow(m[1]-_[1],2))/2,b=[e[0]-c[0],e[1]-c[1]],x=[-1*b[1],b[0]];d=Math.sqrt(x[0]*x[0]+x[1]*x[1]);x[0]=x[0]/d,x[1]=x[1]/d;var C=[c[0]+b[0]/2,c[1]+b[1]/2];v[(r.index+l+1)%4]=[C[0]+x[0]*w,C[1]+x[1]*w],v[(r.index+l+3)%4]=[C[0]-x[0]*w,C[1]-x[1]*w],v[r.index+l]=e;break;case ie:u[0]=u[1]=e,0===r.index?(this.changingFeature_=!0,a.setCenter(e),this.changingFeature_=!1):(this.changingFeature_=!0,a.setRadius(So(a.getCenter(),e)),this.changingFeature_=!1)}h&&this.setGeometryCoordinates_(a,h)}this.createOrUpdateVertexFeature_(e)},e.prototype.handleDownEvent=function(t){if(!this.condition_(t))return!1;this.handlePointerAtPixel_(t.pixel,t.map);var e=t.map.getCoordinateFromPixel(t.pixel);this.dragSegments_.length=0,this.modified_=!1;var n=this.vertexFeature_;if(n){var i=[],o=n.getGeometry().getCoordinates(),r=Pt([o]),s=this.rBush_.getInExtent(r),a={};s.sort(ps);for(var h=0,u=s.length;h<u;++h){var l=s[h],c=l.segment,p=gt(l.feature),f=l.depth;if(f&&(p+="-"+f.join("-")),a[p]||(a[p]=new Array(2)),l.geometry.getType()===ie&&1===l.index)Po(ds(e,l),o)&&!a[p][0]&&(this.dragSegments_.push([l,0]),a[p][0]=l);else if(Po(c[0],o)&&!a[p][0])this.dragSegments_.push([l,0]),a[p][0]=l;else if(Po(c[1],o)&&!a[p][1]){if((l.geometry.getType()===Ht||l.geometry.getType()===te)&&a[p][0]&&0===a[p][0].index)continue;this.dragSegments_.push([l,1]),a[p][1]=l}else this.insertVertexCondition_(t)&&gt(c)in this.vertexSegments_&&!a[p][0]&&!a[p][1]&&i.push([l,o])}i.length&&this.willModifyFeatures_(t);for(var d=i.length-1;d>=0;--d)this.insertVertex_.apply(this,i[d])}return!!this.vertexFeature_},e.prototype.handleUpEvent=function(t){for(var e=this.dragSegments_.length-1;e>=0;--e){var n=this.dragSegments_[e][0],i=n.geometry;if(i.getType()===oe||i.getType()===re)this.features_.remove(n.feature),this.features_.push(n.feature);else if(i.getType()===ie){var o=i.getCenter(),r=n.featureSegments[0],s=n.featureSegments[1];r.segment[0]=r.segment[1]=o,s.segment[0]=s.segment[1]=o,this.rBush_.update(At(o),r),this.rBush_.update(i.getExtent(),s)}else this.rBush_.update(Pt(n.segment),n)}return this.modified_&&(this.dispatchEvent(new cs(ls,this.features_,t)),this.modified_=!1),!1},e.prototype.handlePointerMove_=function(t){this.lastPixel_=t.pixel,this.handlePointerAtPixel_(t.pixel,t.map)},e.prototype.handlePointerAtPixel_=function(t,e){var n,i,o,r=e.getCoordinateFromPixel(t),s=(n=At(r),i=e.getView().getResolution()*this.pixelTolerance_,o?(o[0]=n[0]-i,o[1]=n[1]-i,o[2]=n[2]+i,o[3]=n[3]+i,o):[n[0]-i,n[1]-i,n[2]+i,n[3]+i]),a=this.rBush_.getInExtent(s);if(a.length>0){a.sort((function(t,e){return fs(r,t)-fs(r,e)}));var h=a[0],u=h.segment,l=ds(r,h),c=e.getPixelFromCoordinate(l),p=So(t,c);if(p<=this.pixelTolerance_){var f={};if(h.geometry.getType()===ie&&1===h.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(l);else{var d=e.getPixelFromCoordinate(u[0]),g=e.getPixelFromCoordinate(u[1]),y=Eo(c,d),v=Eo(c,g);p=Math.sqrt(Math.min(y,v)),this.snappedToVertex_=p<=this.pixelTolerance_,this.snappedToVertex_&&(l=y>v?u[1]:u[0]),this.createOrUpdateVertexFeature_(l);for(var m=1,_=a.length;m<_;++m){var w=a[m].segment;if(!(Po(u[0],w[0])&&Po(u[1],w[1])||Po(u[0],w[1])&&Po(u[1],w[0])))break;f[gt(w)]=!0}}return f[gt(u)]=!0,void(this.vertexSegments_=f)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},e.prototype.insertVertex_=function(t,e){for(var n,i=t.segment,o=t.feature,r=t.geometry,s=t.depth,a=t.index;e.length<r.getStride();)e.push(0);switch(r.getType()){case te:case Jt:(n=r.getCoordinates())[s[0]].splice(a+1,0,e);break;case ee:(n=r.getCoordinates())[s[1]][s[0]].splice(a+1,0,e);break;case Ht:(n=r.getCoordinates()).splice(a+1,0,e);break;default:return}this.setGeometryCoordinates_(r,n);var h=this.rBush_;h.remove(t),this.updateSegmentIndices_(r,a,s,1);var u={segment:[i[0],e],feature:o,geometry:r,depth:s,index:a};h.insert(Pt(u.segment),u),this.dragSegments_.push([u,1]);var l={segment:[e,i[1]],feature:o,geometry:r,depth:s,index:a+1};h.insert(Pt(l.segment),l),this.dragSegments_.push([l,0]),this.ignoreNextSingleClick_=!0},e.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=Lo){var t=this.lastPointerEvent_;return this.willModifyFeatures_(t),this.removeVertex_(),this.dispatchEvent(new cs(ls,this.features_,t)),this.modified_=!1,!0}return!1},e.prototype.removeVertex_=function(){var t,e,n,i,o,r,s,a,h,u,l,c=this.dragSegments_,p={},f=!1;for(o=c.length-1;o>=0;--o)l=gt((u=(n=c[o])[0]).feature),u.depth&&(l+="-"+u.depth.join("-")),l in p||(p[l]={}),0===n[1]?(p[l].right=u,p[l].index=u.index):1==n[1]&&(p[l].left=u,p[l].index=u.index+1);for(l in p){switch(h=p[l].right,s=p[l].left,(a=(r=p[l].index)-1)<0&&(a=0),t=e=(i=(u=void 0!==s?s:h).geometry).getCoordinates(),f=!1,i.getType()){case te:e[u.depth[0]].length>2&&(e[u.depth[0]].splice(r,1),f=!0);break;case Ht:e.length>2&&(e.splice(r,1),f=!0);break;case ee:t=t[u.depth[1]];case Jt:(t=t[u.depth[0]]).length>4&&(r==t.length-1&&(r=0),t.splice(r,1),f=!0,0===r&&(t.pop(),t.push(t[0]),a=t.length-1))}if(f){this.setGeometryCoordinates_(i,e);var d=[];if(void 0!==s&&(this.rBush_.remove(s),d.push(s.segment[0])),void 0!==h&&(this.rBush_.remove(h),d.push(h.segment[1])),void 0!==s&&void 0!==h){var g={depth:u.depth,feature:u.feature,geometry:u.geometry,index:a,segment:d};this.rBush_.insert(Pt(g.segment),g)}this.updateSegmentIndices_(i,r,u.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),c.length=0}}return f},e.prototype.setGeometryCoordinates_=function(t,e){this.changingFeature_=!0,t.setCoordinates(e),this.changingFeature_=!1},e.prototype.updateSegmentIndices_=function(t,e,n,i){this.rBush_.forEachInExtent(t.getExtent(),(function(o){o.geometry===t&&(void 0===n||void 0===o.depth||function(t,e){var n=t.length;if(n!==e.length)return!1;for(var i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}(o.depth,n))&&o.index>e&&(o.index+=i)}))},e}(tr),ys={data:function(){return{isTranslating:!1}},computed:{cannotSplitAnnotation:function(){return 1!==this.selectedAnnotations.length||-1===["Point","Circle","Rectangle"].indexOf(this.selectedAnnotations[0].shape)},cannotLinkAnnotations:function(){return 2!==this.selectedAnnotations.length||this.selectedAnnotations[0].shape_id!==this.selectedAnnotations[1].shape_id},isAttaching:function(){return"attachLabel"===this.interactionMode}},methods:{initModifyInteraction:function(t){this.featureRevisionMap={},this.modifyInteraction=new gs({features:this.selectInteraction.getFeatures(),deleteCondition:function(t){return zo(t)&&Wo(t)}}),this.modifyInteraction.on("modifystart",this.handleModifyStart),this.modifyInteraction.on("modifyend",this.handleModifyEnd),t.addInteraction(this.modifyInteraction)},handleModifyStart:function(t){var e=this;t.features.getArray().forEach((function(t){e.featureRevisionMap[t.getId()]=t.getRevision()}))},handleModifyEnd:function(t){var e=this,n=t.features.getArray().filter((function(t){return e.featureRevisionMap[t.getId()]!==t.getRevision()})).map((function(t){return{annotation:t.get("annotation"),points:e.getPointsFromGeometry(t.getGeometry()),time:e.video.currentTime}}));n.length>0&&this.$emit("modify",n)},maybeUpdateModifyInteractionMode:function(t){this.modifyInteraction&&this.modifyInteraction.setActive(t)},emitDelete:function(){var t=this;this.canDelete&&this.hasSelectedAnnotations&&this.$emit("delete",this.selectedAnnotations.map((function(e){return{annotation:e,time:t.video.currentTime}})))},toggleTranslating:function(){this.resetInteractionMode(),this.isTranslating=!this.isTranslating},initTranslateInteraction:function(t){this.translateInteraction=new g({features:this.selectedFeatures,map:t}),this.translateInteraction.setActive(!1),this.translateInteraction.on("translatestart",this.handleModifyStart),this.translateInteraction.on("translateend",this.handleModifyEnd),this.map.addInteraction(this.translateInteraction)},maybeUpdateIsTranslating:function(t){this.translateInteraction&&!t&&(this.isTranslating=!1)},resetTranslating:function(){this.isTranslating=!1},emitSplitAnnotation:function(){this.$emit("split-annotation",this.selectedAnnotations[0],this.video.currentTime)},emitLinkAnnotations:function(){this.$emit("link-annotations",this.selectedAnnotations)},toggleAttaching:function(){this.isAttaching?this.resetInteractionMode():this.interactionMode="attachLabel"},initAttachInteraction:function(t){this.attachInteraction=new o({features:this.annotationFeatures,map:t}),this.attachInteraction.setActive(!1),this.attachInteraction.on("attach",this.handleAttachLabel),this.map.addInteraction(this.attachInteraction)},handleAttachLabel:function(t){this.$emit("attach-label",t.feature.get("annotation"),this.selectedLabel)},maybeResetAttaching:function(t){this.isAttaching&&t&&this.resetInteractionMode()}},watch:{isTranslating:function(t){this.translateInteraction&&(this.translateInteraction.setActive(t),t?this.modifyInteraction.setActive(!1):this.isDefaultInteractionMode&&this.modifyInteraction.setActive(!0))},isAttaching:function(t){this.attachInteraction&&this.attachInteraction.setActive(t)}},created:function(){this.canModify&&(this.$once("map-created",(function(){this.$once("map-ready",this.initModifyInteraction),this.$once("map-ready",this.initTranslateInteraction),this.$once("map-ready",this.initAttachInteraction)})),this.$watch("isDefaultInteractionMode",this.maybeUpdateModifyInteractionMode),this.$watch("isDefaultInteractionMode",this.maybeUpdateIsTranslating),this.$watch("hasNoSelectedLabel",this.maybeResetAttaching),a.on("m",this.toggleTranslating,0,this.listenerSet),a.on("Escape",this.resetTranslating,0,this.listenerSet),a.on("l",this.toggleAttaching,0,this.listenerSet)),this.canDelete&&a.on("Delete",this.emitDelete)}},vs={components:{labelTooltip:h},data:function(){return{hoveredFeaturesHash:""}},computed:{showTooltip:function(){return this.isDefaultInteractionMode&&this.showLabelTooltip}},methods:{annotationLayerFilter:function(t){return"annotations"===t.get("name")},updateHoveredAnnotations:function(t){var e=this.map.getFeaturesAtPixel(t.pixel,{layerFilter:this.annotationLayerFilter})||[],n=e.map((function(t){return t.getId()})).join("-");this.hoveredFeaturesHash!==n&&(this.hoveredFeaturesHash=n,this.$emit("hoverFeatures",e))},resetHoveredAnnotations:function(){this.hoveredFeaturesHash="",this.$emit("hoverFeatures",[])},updateTooltipEventListeners:function(){this.showTooltip?this.map.on("pointermove",this.updateHoveredAnnotations):(this.map.un("pointermove",this.updateHoveredAnnotations),this.resetHoveredAnnotations())}},watch:{showTooltip:function(){this.updateTooltipEventListeners()}},created:function(){this.$once("map-created",this.updateTooltipEventListeners)}},ms={components:{mousePositionIndicator:c},data:function(){return{mousePositionImageCoordinates:[0,0]}},methods:{updateMousePositionImageCoordinates:function(){this.mousePositionImageCoordinates=this.invertPointsYAxis(this.mousePosition.slice()).map(Math.round)}},watch:{mousePosition:function(t){d(this.updateMousePositionImageCoordinates,100,"videos.update-mouse-position-ic")}}},_s=n("/rf6"),ws=n("XPUu"),bs=n.n(ws),xs=n("OpTr"),Cs=n.n(xs),Ps=n("Qnnh"),Es=n.n(Ps);function Ss(t,e){t.geometry.coordinates=oi(t.geometry.coordinates),e.geometry.coordinates=oi(e.geometry.coordinates);var n=Es()(t,e);return"MultiPolygon"===n.geometry.type?n.geometry.coordinates[0]:n.geometry.coordinates}var Rs=n("qNH4"),Ms=n.n(Rs);var ks=function(t){var e=t.pointerEvent;return e&&"pen"===e.pointerType};function Is(t,e){var n=t.originalEvent.deltaY;t.type==Ae?0===(n=-t.originalEvent.wheelDeltaY)&&(n=-t.originalEvent.wheelDeltaX):0===n&&(n=t.originalEvent.deltaX);var i=5;return e<=25&&(i=1),n>0?e+i:n<0?Math.max(e-i,5):e}function Fs(t,e){return 0!=t.pointerEvent.pressure?(e=Is(t,e),Math.max(e*t.pointerEvent.pressure,5)*t.map.getView().getResolution()):e}function As(){var t=Rr();return t[Jt]=t[Jt].concat(t[Ht]),function(e,n){return t[e.getGeometry().getType()]}}var Os=function(t){function e(e){e.freehandCondition=e.freehandCondition?e.freehandCondition:ks,t.call(this,e),this.overlay_=new Fr({source:this.overlay_.getSource(),style:e.style?e.style:As(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.sketchPointRadius_=void 0!==e.brushRadius?e.brushRadius:100,this.condition_=void 0!==e.condition?e.condition:No,this.resizeCondition_=void 0!==e.resizeCondition?e.resizeCondition:zo,this.isDrawing_=!1,this.sketchCircle_=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setMap=function(e){if(t.prototype.setMap.call(this,e),e){var n=e.getView();n&&this.watchViewForChangedResolution(n),e.on("change:view",function(t){this.watchViewForChangedResolution(t.target.getView())}.bind(this))}},e.prototype.watchViewForChangedResolution=function(t){t.on("change:resolution",this.updateRelativeSketchPointRadius_.bind(this))},e.prototype.handleEvent=function(e){var n=e.type,i=!0;return this.resizeCondition_(e)&&(n===Oe||Ae)&&(this.updateAbsoluteSketchPointRadius_(e),i=!1),e.type===Lo&&this.handlingDownUpSequence&&(i=!1),t.prototype.handleEvent.call(this,e)&&i},e.prototype.handleDownEvent=function(t){return!(this.handlingDownUpSequence||!this.condition_(t))&&(this.startDrawing_(t),!0)},e.prototype.handleUpEvent=function(t){return!(!this.handlingDownUpSequence||!this.isDrawing_)&&(this.finishDrawing(),!0)},e.prototype.createOrUpdateSketchPoint_=function(t){var e=t.coordinate.slice();if(this.sketchPoint_){this.sketchPoint_.getGeometry().setCenter(e)}else{var n=t.map.getView().getResolution()*this.sketchPointRadius_;this.sketchPoint_=new Ei(new Bn(e,n)),this.updateSketchFeatures_()}},e.prototype.updateRelativeSketchPointRadius_=function(t){this.sketchPoint_&&this.sketchPoint_.getGeometry().setRadius(this.sketchPointRadius_*t.target.getResolution())},e.prototype.updateAbsoluteSketchPointRadius_=function(t){this.sketchPoint_&&(this.sketchPointRadius_=Is(t,this.sketchPointRadius_),this.sketchPoint_.getGeometry().setRadius(this.sketchPointRadius_*t.map.getView().getResolution()))},e.prototype.createOrUpdateSketchCircle_=function(t){var e=t.coordinate.slice();this.sketchCircle_?(this.sketchCircle_.setCenter(e),this.sketchCircle_.setRadius(this.sketchPoint_.getGeometry().getRadius())):this.sketchCircle_=new Bn(e,this.sketchPoint_.getGeometry().getRadius()),"pen"===t.originalEvent.pointerType&&this.sketchCircle_.setRadius(Fs(t,this.sketchPointRadius_))},e.prototype.startDrawing_=function(t){this.isDrawing_=!0,this.createOrUpdateSketchPoint_(t),this.createOrUpdateSketchCircle_(t);var e=t.coordinate;this.finishCoordinate_=e,this.sketchFeature_=new Ei(xi(this.sketchCircle_)),this.updateSketchFeatures_(),this.dispatchEvent(new ss(os,this.sketchFeature_))},e.prototype.handlePointerMove_=function(t){if(this.createOrUpdateSketchPoint_(t),this.createOrUpdateSketchCircle_(t),this.isDrawing_&&this.sketchFeature_){var e=xi(this.sketchCircle_),n=Object(_s.polygon)(e.getCoordinates()),i=this.sketchFeature_.getGeometry(),o=Object(_s.polygon)(i.getCoordinates());(Cs()(n,o)||bs()(n,o))&&i.setCoordinates(Ss(n,o))}},e.prototype.finishDrawing=function(){this.isDrawing_=!1;var t=this.abortDrawing_();t&&(this.dispatchEvent(new ss(rs,t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t))},e.prototype.getBrushRadius=function(){return this.sketchPointRadius_},e.prototype.abortDrawing_=function(){return this.sketchCircle_=null,t.prototype.abortDrawing_.call(this)},e}(as),Ts="modifyremove";var Ls=function(t){function e(e){var n;t.call(this,e),this.overlay_.setStyle(e.style?e.style:(n=Rr(),function(t,e){return n[ie]})),this.sketchPoint_=null,this.sketchPointRadius_=void 0!==e.brushRadius?e.brushRadius:100,this.addCondition_=void 0!==e.addCondition?e.addCondition:No,this.subtractCondition_=void 0!==e.subtractCondition?e.subtractCondition:No,this.resizeCondition_=void 0!==e.resizeCondition?e.resizeCondition:zo,this.allowRemove_=void 0===e.allowRemove||e.allowRemove,this.isAdding_=!1,this.isSubtracting_=!1,this.sketchCircle_=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setMap=function(e){if(t.prototype.setMap.call(this,e),e){var n=e.getView();n&&this.watchViewForChangedResolution(n),e.on("change:view",function(t){this.watchViewForChangedResolution(t.target.getView())}.bind(this))}},e.prototype.watchViewForChangedResolution=function(t){t.on("change:resolution",this.updateRelativeSketchPointRadius_.bind(this))},e.prototype.createOrUpdateSketchPoint_=function(t){var e=t.coordinate.slice();if(this.sketchPoint_){this.sketchPoint_.getGeometry().setCenter(e)}else{var n=t.map.getView().getResolution()*this.sketchPointRadius_;this.sketchPoint_=new Ei(new Bn(e,n)),this.overlay_.getSource().addFeature(this.sketchPoint_)}},e.prototype.createOrUpdateSketchCircle_=function(t){var e=t.coordinate.slice();this.sketchCircle_?(this.sketchCircle_.setCenter(e),this.sketchCircle_.setRadius(this.sketchPoint_.getGeometry().getRadius())):this.sketchCircle_=new Bn(e,this.sketchPoint_.getGeometry().getRadius()),"pen"===t.originalEvent.pointerType&&this.sketchCircle_.setRadius(Fs(t,this.sketchPointRadius_))},e.prototype.updateRelativeSketchPointRadius_=function(t){this.sketchPoint_&&this.sketchPoint_.getGeometry().setRadius(this.sketchPointRadius_*t.target.getResolution())},e.prototype.updateAbsoluteSketchPointRadius_=function(t){this.sketchPoint_&&(this.sketchPointRadius_=Is(t,this.sketchPointRadius_),this.sketchPoint_.getGeometry().setRadius(this.sketchPointRadius_*t.map.getView().getResolution()))},e.prototype.handleEvent=function(e){var n=e.type,i=!0;return this.resizeCondition_(e)&&(n===Oe||Ae)&&(this.updateAbsoluteSketchPointRadius_(e),i=!1),t.prototype.handleEvent.call(this,e)&&i},e.prototype.handlePointerMove_=function(t){this.createOrUpdateSketchPoint_(t),this.createOrUpdateSketchCircle_(t)},e.prototype.handleDownEvent=function(t){if(!this.handlingDownUpSequence){if(this.createOrUpdateSketchPoint_(t),this.createOrUpdateSketchCircle_(t),this.subtractCondition_(t))return this.startSubtracting_(t),!0;if(this.addCondition_(t))return this.startAdding_(t),!0}return!1},e.prototype.handleUpEvent=function(t){return!(!this.handlingDownUpSequence||!this.isSubtracting_&&!this.isAdding_)&&(this.finishModifying_(t),!0)},e.prototype.startSubtracting_=function(t){this.isSubtracting_=!0,this.willModifyFeatures_(t),this.subtractCurrentFeatures_(t)},e.prototype.startAdding_=function(t){this.isAdding_=!0,this.willModifyFeatures_(t),this.addCurrentFeatures_(t)},e.prototype.handleDragEvent=function(t){this.createOrUpdateSketchPoint_(t),this.createOrUpdateSketchCircle_(t),this.isSubtracting_?this.subtractCurrentFeatures_(t):this.isAdding_&&this.addCurrentFeatures_(t)},e.prototype.subtractCurrentFeatures_=function(t){var e=xi(this.sketchCircle_),n=Object(_s.polygon)(e.getCoordinates()),i=e.getArea();this.features_.getArray().forEach((function(e){var o=e.getGeometry();try{var r=Object(_s.polygon)(o.getCoordinates())}catch(t){return}if(Cs()(n,r)){var s=function(t,e){t.geometry.coordinates=oi(t.geometry.coordinates),e.geometry.coordinates=oi(e.geometry.coordinates);var n=Ms()(t,e);if("MultiPolygon"===n.geometry.type){for(var i,o=0,r=0;r<n.geometry.coordinates.length;r++){var s=new wi(n.geometry.coordinates[r]).getArea();s>o&&(o=s,i=n.geometry.coordinates[r])}return i}return n.geometry.coordinates}(r,n);if(!this.allowRemove_&&i>new wi(s).getArea())return;o.setCoordinates(s)}else bs()(n,r)&&this.allowRemove_&&(this.features_.remove(e),this.source_&&this.source_.removeFeature(e),this.dispatchEvent(new cs(Ts,new jr([e]),t)))}),this)},e.prototype.addCurrentFeatures_=function(t){var e=xi(this.sketchCircle_),n=Object(_s.polygon)(e.getCoordinates());this.features_.getArray().forEach((function(t){var i=t.getGeometry();try{var o=Object(_s.polygon)(i.getCoordinates())}catch(t){return}Cs()(n,o)?i.setCoordinates(Ss(n,o)):bs()(n,o)&&i.setCoordinates(e.getCoordinates())}),this)},e.prototype.finishModifying_=function(t){this.isSubtracting_=!1,this.isAdding_=!1,this.dispatchEvent(new cs(ls,this.features_,t))},e.prototype.getBrushRadius=function(){return this.sketchPointRadius_},e}(gs),js="select",Ds=function(t){function e(e,n,i,o){t.call(this,e),this.selected=n,this.deselected=i,this.mapBrowserEvent=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ee);function Gs(t){if(!this.condition_(t))return!0;var e=this.addCondition_(t),n=this.removeCondition_(t),i=this.toggleCondition_(t),o=!e&&!n&&!i,r=t.map,s=this.getFeatures(),a=[],h=[];if(o){he(this.featureLayerAssociation_),r.forEachFeatureAtPixel(t.pixel,function(t,e){if(this.filter_(t,e))return h.push(t),this.addFeatureLayerAssociation_(t,e),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var u=s.getLength()-1;u>=0;--u){var l=s.item(u),c=h.indexOf(l);c>-1?h.splice(c,1):(s.remove(l),a.push(l))}0!==h.length&&s.extend(h)}else{r.forEachFeatureAtPixel(t.pixel,function(t,o){if(this.filter_(t,o))return!e&&!i||Un(s.getArray(),t)?(n||i)&&Un(s.getArray(),t)&&(a.push(t),this.removeFeatureLayerAssociation_(t)):(h.push(t),this.addFeatureLayerAssociation_(t,o)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var p=a.length-1;p>=0;--p)s.remove(a[p]);s.extend(h)}return(h.length>0||a.length>0)&&this.dispatchEvent(new Ds(js,h,a,t)),function(t){return"pointermove"==t.type}(t)}function Bs(){var t=Rr();return Vn(t[Jt],t[Ht]),Vn(t[ne],t[Ht]),function(e,n){return e.getGeometry()?t[e.getGeometry().getType()]:null}}var qs=function(t){function e(e){t.call(this,{handleEvent:Gs});var n=e||{};this.condition_=n.condition?n.condition:Wo,this.addCondition_=n.addCondition?n.addCondition:Vo,this.removeCondition_=n.removeCondition?n.removeCondition:Vo,this.toggleCondition_=n.toggleCondition?n.toggleCondition:zo,this.multi_=!!n.multi&&n.multi,this.filter_=n.filter?n.filter:be,this.hitTolerance_=n.hitTolerance?n.hitTolerance:0;var i,o=new Fr({source:new Jr({useSpatialIndex:!1,features:n.features,wrapX:n.wrapX}),style:n.style?n.style:Bs(),updateWhileAnimating:!0,updateWhileInteracting:!0});if(this.featureOverlay_=o,n.layers)if("function"==typeof n.layers)i=n.layers;else{var r=n.layers;i=function(t){return Un(r,t)}}else i=be;this.layerFilter_=i,this.featureLayerAssociation_={};var s=this.getFeatures();ge(s,Ar,this.addFeature_,this),ge(s,Or,this.removeFeature_,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeatureLayerAssociation_=function(t,e){this.featureLayerAssociation_[gt(t)]=e},e.prototype.getFeatures=function(){return this.featureOverlay_.getSource().getFeaturesCollection()},e.prototype.getHitTolerance=function(){return this.hitTolerance_},e.prototype.getLayer=function(t){return this.featureLayerAssociation_[gt(t)]},e.prototype.getOverlay=function(){return this.featureOverlay_},e.prototype.setHitTolerance=function(t){this.hitTolerance_=t},e.prototype.setMap=function(e){var n=this.getMap(),i=this.getFeatures();n&&i.forEach(n.unskipFeature.bind(n)),t.prototype.setMap.call(this,e),this.featureOverlay_.setMap(e),e&&i.forEach(e.skipFeature.bind(e))},e.prototype.addFeature_=function(t){var e=this.getMap();e&&e.skipFeature(t.element)},e.prototype.removeFeature_=function(t){var e=this.getMap();e&&e.unskipFeature(t.element)},e.prototype.removeFeatureLayerAssociation_=function(t){delete this.featureLayerAssociation_[gt(t)]},e}(Qo),Us={mixins:[u],components:{videoScreen:{mixins:[Fo,Fi,hs,ys,vs,ms,{data:function(){return{polygonBrushRadius:50}},computed:{isUsingPolygonBrush:function(){return"polygonBrush"===this.interactionMode},isUsingPolygonEraser:function(){return"polygonEraser"===this.interactionMode},isUsingPolygonFill:function(){return"polygonFill"===this.interactionMode}},methods:{togglePolygonBrush:function(){this.isUsingPolygonBrush?this.resetInteractionMode():this.hasSelectedLabel?this.canAdd&&(this.interactionMode="polygonBrush"):this.requireSelectedLabel()},togglePolygonEraser:function(){this.isUsingPolygonEraser?this.resetInteractionMode():this.canModify&&(this.interactionMode="polygonEraser")},togglePolygonFill:function(){this.isUsingPolygonFill?this.resetInteractionMode():this.canModify&&(this.interactionMode="polygonFill")},togglePolygonBrushInteraction:function(t){t?this.hasSelectedLabel&&(this.polygonBrushInteraction=new Os({source:this.pendingAnnotationSource,style:f.editing,brushRadius:this.polygonBrushRadius}),this.polygonBrushInteraction.on("drawend",this.extendPendingAnnotation),this.pendingAnnotation.shape="Polygon",this.map.addInteraction(this.polygonBrushInteraction)):(this.polygonBrushRadius=this.polygonBrushInteraction.getBrushRadius(),this.map.removeInteraction(this.polygonBrushInteraction))},togglePolygonEraserInteraction:function(t){t?(this.polygonEraserInteraction=new Ls({features:this.selectInteraction.getFeatures(),style:f.editing,brushRadius:this.polygonBrushRadius,allowRemove:!1,addCondition:Vo,subtractCondition:$o}),this.polygonEraserInteraction.on("modifystart",this.handleModifyStart),this.polygonEraserInteraction.on("modifyend",this.handleModifyEnd),this.map.addInteraction(this.polygonEraserInteraction),this.map.addInteraction(this.shiftClickSelectInteraction)):(this.polygonBrushRadius=this.polygonEraserInteraction.getBrushRadius(),this.map.removeInteraction(this.polygonEraserInteraction),this.polygonEraserInteraction=null,this.map.removeInteraction(this.shiftClickSelectInteraction))},togglePolygonFillInteraction:function(t){t?(this.polygonFillInteraction=new Ls({features:this.selectInteraction.getFeatures(),style:f.editing,brushRadius:this.polygonBrushRadius,allowRemove:!1,addCondition:$o,subtractCondition:Vo}),this.polygonFillInteraction.on("modifystart",this.handleModifyStart),this.polygonFillInteraction.on("modifyend",this.handleModifyEnd),this.map.addInteraction(this.polygonFillInteraction),this.map.addInteraction(this.shiftClickSelectInteraction)):(this.polygonBrushRadius=this.polygonFillInteraction.getBrushRadius(),this.map.removeInteraction(this.polygonFillInteraction),this.polygonFillInteraction=null,this.map.removeInteraction(this.shiftClickSelectInteraction))},initShiftSelectInteraction:function(t){this.shiftClickSelectInteraction=qs({condition:function(t){return t.type==Oo&&zo(t)},style:f.highlight,layers:[this.annotationLayer],features:this.selectInteraction.getFeatures(),multi:!0}),this.shiftClickSelectInteraction.on("select",this.handleFeatureSelect)}},created:function(){this.canAdd&&(this.$watch("isUsingPolygonBrush",this.togglePolygonBrushInteraction),a.on("e",this.togglePolygonBrush,0,this.listenerSet)),this.canModify&&(this.$once("map-created",(function(){this.$once("map-ready",this.initShiftSelectInteraction)})),this.$watch("isUsingPolygonEraser",this.togglePolygonEraserInteraction),a.on("r",this.togglePolygonEraser,0,this.listenerSet),this.$watch("isUsingPolygonFill",this.togglePolygonFillInteraction),a.on("t",this.togglePolygonFill,0,this.listenerSet))}}],template:'<div class="video-screen" :style="styleObject"><minimap v-if="showMinimap" :extent="extent"></minimap><label-tooltip watch="hoverFeatures" :show="showLabelTooltip" :position="mousePosition"></label-tooltip><div class="controls"><div class="btn-group"><control-button v-if="playing" icon="fa-pause" title="Pause " @click="pause"></control-button><control-button v-else icon="fa-play" title="Play " @click="play"></control-button></div><div v-if="canAdd" class="btn-group"><control-button icon="icon-point" title="Start a point annotation " :hover="false" :open="isDrawingPoint" :active="isDrawingPoint" @click="drawPoint"><control-button icon="fa-check" title="Finish the point annotation " :disabled="cantFinishDrawAnnotation" @click="finishDrawAnnotation"></control-button><control-button icon="fa-project-diagram" title="Finish and track the point annotation" v-on:click="finishTrackAnnotation" :disabled="cantFinishTrackAnnotation"></control-button></control-button><control-button icon="icon-rectangle" title="Start a rectangle annotation " :hover="false" :open="isDrawingRectangle" :active="isDrawingRectangle" @click="drawRectangle"><control-button icon="fa-check" title="Finish the rectangle annotation " :disabled="cantFinishDrawAnnotation" @click="finishDrawAnnotation"></control-button></control-button><control-button icon="icon-circle" title="Start a circle annotation " :hover="false" :open="isDrawingCircle" :active="isDrawingCircle" @click="drawCircle"><control-button icon="fa-check" title="Finish the circle annotation " :disabled="cantFinishDrawAnnotation" @click="finishDrawAnnotation"></control-button><control-button icon="fa-project-diagram" title="Finish and track the circle annotation" v-on:click="finishTrackAnnotation" :disabled="cantFinishTrackAnnotation"></control-button></control-button><control-button icon="icon-linestring" title="Start a line annotation " :hover="false" :open="isDrawingLineString" :active="isDrawingLineString" @click="drawLineString"><control-button icon="fa-check" title="Finish the line annotation " :disabled="cantFinishDrawAnnotation" @click="finishDrawAnnotation"></control-button></control-button><control-button icon="icon-polygon" title="Start a polygon annotation " :open="isDrawingPolygon" :active="isDrawingPolygon" @click="drawPolygon"><control-button v-if="isDrawingPolygon || isUsingPolygonBrush" icon="fa-check" title="Finish the polygon annotation " :disabled="cantFinishDrawAnnotation" @click="finishDrawAnnotation"></control-button><control-button icon="fa-paint-brush" title="Draw a polygon using the brush tool " :active="isUsingPolygonBrush" @click="togglePolygonBrush"></control-button><control-button icon="fa-eraser" title="Modify selected polygons using the eraser tool " :active="isUsingPolygonEraser" @click="togglePolygonEraser"></control-button><control-button icon="fa-fill-drip" title="Modify selected polygons using the fill tool " :active="isUsingPolygonFill" @click="togglePolygonFill"></control-button></control-button></div><div v-if="showModifyBar" class="btn-group"><control-button v-if="canModify" icon="fa-tag" title="Attach the currently selected label to existing annotations " :active="isAttaching" :disabled="hasNoSelectedLabel" @click="toggleAttaching"></control-button><control-button v-if="canModify" icon="fa-arrows-alt" title="Move selected annotations " :active="isTranslating" @click="toggleTranslating"></control-button><control-button v-if="canModify" icon="fa-link" title="Link selected annotations" :disabled="cannotLinkAnnotations" @click="emitLinkAnnotations"></control-button><control-button v-if="canModify" icon="fa-unlink" title="Split selected annotation" :disabled="cannotSplitAnnotation" @click="emitSplitAnnotation"></control-button><control-button v-if="canDelete" icon="fa-trash" title="Delete selected annotations/keyframes " :disabled="hasNoSelectedAnnotations" @click="emitDelete"></control-button></div></div><div class="indicators indicators--left"><mouse-position-indicator v-if="showMousePosition" :position="mousePositionImageCoordinates"></mouse-position-indicator></div><div class="indicators indicators--right"><div class="indicator" v-if="selectedLabel" v-text="selectedLabel.name"></div></div></div>',components:{controlButton:biigle.$require("annotations.components.controlButton"),minimap:biigle.$require("annotations.components.minimap")},props:{annotations:{type:Array,default:function(){return[]}},annotationOpacity:{type:Number,default:1},autoplayDraw:{type:Number,default:0},canAdd:{type:Boolean,default:!1},canModify:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1},initialCenter:{type:Array,default:[0,0]},initialResolution:{type:Number,default:0},listenerSet:{type:String,default:"default"},selectedAnnotations:{type:Array,default:function(){return[]}},selectedLabel:{type:Object},showLabelTooltip:{type:Boolean,default:!1},showMinimap:{type:Boolean,default:!0},showMousePosition:{type:Boolean,default:!0},video:{type:HTMLVideoElement,required:!0},heightOffset:{type:Number,default:0}},data:function(){return{interactionMode:"default",mousePosition:[0,0]}},computed:{showModifyBar:function(){return this.canModify||this.canDelete},hasSelectedAnnotations:function(){return this.selectedAnnotations.length>0},hasNoSelectedAnnotations:function(){return!this.hasSelectedAnnotations},isDefaultInteractionMode:function(){return"default"===this.interactionMode},styleObject:function(){return 0!==this.heightOffset?"height: calc(65% + "+this.heightOffset+"px);":""}},methods:{createMap:function(){var t=new ol.Map({controls:[new ol.control.Zoom,new ol.control.ZoomToExtent({tipLabel:"Zoom to show whole video",label:""})],interactions:ol.interaction.defaults({altShiftDragRotate:!1,doubleClickZoom:!1,keyboard:!1,shiftDragZoom:!1,pinchRotate:!1,pinchZoom:!1})}),e=biigle.$require("annotations.ol.ZoomToNativeControl");return t.addControl(new e({label:""})),t},initLayersAndInteractions:function(t){var e=biigle.$require("annotations.stores.styles");this.annotationFeatures=new ol.Collection,this.annotationSource=new ol.source.Vector({features:this.annotationFeatures}),this.annotationLayer=new ol.layer.Vector({source:this.annotationSource,updateWhileAnimating:!0,updateWhileInteracting:!0,style:e.features,opacity:this.annotationOpacity,name:"annotations"}),this.selectInteraction=new ol.interaction.Select({condition:ol.events.condition.click,style:e.highlight,layers:[this.annotationLayer],multi:!0}),this.selectedFeatures=this.selectInteraction.getFeatures(),this.selectInteraction.on("select",this.handleFeatureSelect),t.addLayer(this.annotationLayer),t.addInteraction(this.selectInteraction)},emitCreateBookmark:function(){this.$emit("create-bookmark",this.video.currentTime)},resetInteractionMode:function(){this.interactionMode="default"},extractAnnotationFromFeature:function(t){return t.get("annotation")},handleFeatureSelect:function(t){this.$emit("select",t.selected.map(this.extractAnnotationFromFeature),t.deselected.map(this.extractAnnotationFromFeature),this.video.currentTime)},updateMousePosition:function(t){this.mousePosition=t.coordinate},emitTrack:function(){this.$emit("track")},emitMoveend:function(t){var e=t.target.getView();this.$emit("moveend",e.getCenter(),e.getResolution())},initInitialCenterAndResolution:function(t){var e=t.getView();0!==this.initialResolution&&e.setResolution(Math.min(e.getMaxResolution(),Math.max(e.getMinResolution(),this.initialResolution))),0===this.initialCenter[0]&&0===this.initialCenter[1]||!ol.extent.containsCoordinate(this.extent,this.initialCenter)||e.setCenter(this.initialCenter)},updateSize:function(){var t=this.map;this.$nextTick((function(){t.updateSize()}))}},watch:{selectedAnnotations:function(t){var e,n=this.annotationSource,i=this.selectedFeatures;n&&i&&(i.clear(),t.forEach((function(t){(e=n.getFeatureById(t.id))&&i.push(e)})))},isDefaultInteractionMode:function(t){this.selectInteraction.setActive(t)},annotationOpacity:function(t){this.annotationLayer&&this.annotationLayer.setOpacity(t)},heightOffset:function(){this.updateSize()}},created:function(){this.$once("map-ready",this.initLayersAndInteractions),this.$once("map-ready",this.initInitialCenterAndResolution),this.map=this.createMap(),this.$emit("map-created",this.map),this.map.on("pointermove",this.updateMousePosition),this.map.on("moveend",this.emitMoveend),biigle.$require("keyboard").on("Escape",this.resetInteractionMode,0,this.listenerSet)},mounted:function(){this.map.setTarget(this.$el)}},videoTimeline:biigle.$require("videos.components.videoTimeline"),sidebar:biigle.$require("core.components.sidebar"),sidebarTab:biigle.$require("core.components.sidebarTab"),labelTrees:biigle.$require("labelTrees.components.labelTrees"),settingsTab:biigle.$require("videos.components.settingsTab"),annotationsTab:biigle.$require("videos.components.viaAnnotationsTab")},data:{videoId:null,shapes:[],canEdit:biigle.$require("videos.isEditor"),video:document.createElement("video"),labelTrees:biigle.$require("videos.labelTrees"),selectedLabel:null,bookmarks:[],annotations:[],seeking:!1,settings:{annotationOpacity:1,showMinimap:!0,autoplayDraw:0,showLabelTooltip:!1,showMousePosition:!1,playbackRate:1},openTab:"",urlParams:{x:0,y:0,r:0,t:0},initialCurrentTime:0,initialMapCenter:[0,0],initialMapResolution:0,annotationFilters:[],activeAnnotationFilter:null,resizingTimeline:!1,timelineOffsetReference:0,timelineHeightReference:0,fixedTimelineOffset:0,currentTimelineOffset:0},computed:{shapes:function(){var t=this,e={};return Object.keys(this.shapes).forEach((function(n){e[t.shapes[n]]=parseInt(n)})),e},selectedAnnotations:function(){return this.filteredAnnotations.filter((function(t){return t.isSelected}))},settingsStore:function(){return biigle.$require("videos.stores.settings")},filteredAnnotations:function(){return this.activeAnnotationFilter?this.activeAnnotationFilter.filter(this.annotations):this.annotations},hasActiveAnnotationFilter:function(){return null!==this.activeAnnotationFilter},timelineHeightOffset:function(){return this.fixedTimelineOffset+this.currentTimelineOffset},screenHeightOffset:function(){return-1*this.timelineHeightOffset},classObject:function(){return this.resizingTimeline?"resizing-timeline":""}},methods:{prepareAnnotation:function(t){return new pt({data:t})},setAnnotations:function(t){this.annotations=t.body.map(this.prepareAnnotation)},addCreatedAnnotation:function(t){var e=this.prepareAnnotation(t.body);return e.$on("tracking-failed",this.removeAnnotation),this.annotations.push(e),e},seek:function(t){this.seeking||this.video.currentTime===t||(this.seeking=!0,this.video.currentTime=t)},selectAnnotation:function(t,e,n){n?this.selectAnnotations([t],[],e):this.selectAnnotations([t],this.selectedAnnotations,e)},selectAnnotations:function(t,e,n){e.forEach((function(t){t.selected=!1}));var i=this.selectedAnnotations.length>0;t.forEach((function(t){t.selected=n})),void 0!==n&&!1===i&&this.seek(n)},deselectAnnotation:function(t){t?t.selected=!1:this.selectedAnnotations.forEach((function(t){t.selected=!1}))},createBookmark:function(t){this.bookmarks.reduce((function(e,n){return e||n.time===t}),!1)||this.bookmarks.push({time:t})},createAnnotation:function(t){var e=Object.assign(t,{shape_id:this.shapes[t.shape],label_id:this.selectedLabel?this.selectedLabel.id:0});return delete e.shape,_.save({id:this.videoId},e).then(this.addCreatedAnnotation,s)},trackAnnotation:function(t){t.track=!0,this.createAnnotation(t).then(this.startPollTrackingAnnotation)},startPollTrackingAnnotation:function(t){t&&t.startPollTracking()},handleSelectedLabel:function(t){this.selectedLabel=t},handleDeselectedLabel:function(){this.selectedLabel=null},deleteAnnotationsOrKeyframes:function(t){confirm("Are you sure that you want to delete all selected annotations/keyframes?")&&t.forEach(this.deleteAnnotationOrKeyframe)},deleteAnnotationOrKeyframe:function(t){var e=t.annotation;e.isClip&&e.hasKeyframe(t.time)?e.deleteKeyframe(t.time).catch(s):e.delete().then(this.deletedAnnotation(e)).catch(s)},deletedAnnotation:function(t){return function(){this.removeAnnotation(t)}.bind(this)},handleVideoSeeked:function(){this.seeking=!1},modifyAnnotations:function(t){t.forEach(this.modifyAnnotation)},modifyAnnotation:function(t){t.annotation.modify(t.time,t.points).catch(s)},handleUpdatedSettings:function(t,e){this.settings[t]=e},handleOpenedTab:function(t){this.settingsStore.set("openTab",t)},handleClosedTab:function(){this.settingsStore.delete("openTab")},handleToggledTab:function(){this.$refs.videoScreen.updateSize()},removeAnnotation:function(t){var e=this.annotations.indexOf(t);-1!==e&&this.annotations.splice(e,1)},splitAnnotation:function(t,e){t.split(e).then(this.addCreatedAnnotation,s)},linkAnnotations:function(t){t[0].link(t[1]).then(this.deletedAnnotation(t[1])).catch(s)},updateMapUrlParams:function(t,e){this.urlParams.x=Math.round(t[0]),this.urlParams.y=Math.round(t[1]),this.urlParams.r=Math.round(100*e)},updateVideoUrlParams:function(){this.urlParams.t=Math.round(100*this.video.currentTime)},restoreUrlParams:function(){void 0!==y.get("r")&&(this.initialMapResolution=parseInt(y.get("r"),10)/100),void 0!==y.get("x")&&void 0!==y.get("y")&&(this.initialMapCenter=[parseInt(y.get("x"),10),parseInt(y.get("y"),10)]),void 0!==y.get("t")&&(this.initialCurrentTime=parseInt(y.get("t"),10)/100)},maybeInitCurrentTime:function(){if(0===this.initialCurrentTime)return Vue.Promise.resolve();var t=new Vue.Promise(function(t,e){this.video.addEventListener("seeked",t),this.video.addEventListener("error",e)}.bind(this));return this.seek(this.initialCurrentTime),t},detachAnnotationLabel:function(t,e){t.labels.length>1?t.detachAnnotationLabel(e).catch(s):confirm("Detaching the last label of an annotation deletes the whole annotation. Do you want to delete the annotation?")&&t.delete().then(this.deletedAnnotation(t)).catch(s)},attachAnnotationLabel:function(t,e){t.attachAnnotationLabel(e).catch(s)},initAnnotationFilters:function(){var t=biigle.$require("annotations.models.LabelAnnotationFilter"),e=biigle.$require("annotations.models.UserAnnotationFilter"),n=biigle.$require("annotations.models.ShapeAnnotationFilter");this.annotationFilters=[new t({data:{annotations:this.annotations}}),new e({data:{annotations:this.annotations}}),new n({data:{shapes:this.shapes}})]},setActiveAnnotationFilter:function(t){this.activeAnnotationFilter=t},resetAnnotationFilter:function(){this.activeAnnotationFilter&&this.activeAnnotationFilter.reset(),this.activeAnnotationFilter=null},handleRequiresSelectedLabel:function(){l.info("Please select a label first."),this.$refs.sidebar.$emit("open","labels")},startUpdateTimelineHeight:function(t){t.preventDefault(),this.resizingTimeline=!0,this.timelineOffsetReference=t.clientY,this.timelineHeightReference=this.$refs.videoTimeline.$el.offsetHeight},updateTimelineHeight:function(t){this.resizingTimeline&&(t.preventDefault(),this.currentTimelineOffset=this.timelineOffsetReference-t.clientY)},finishUpdateTimelineHeight:function(t){this.resizingTimeline&&(this.resizingTimeline=!1,this.fixedTimelineOffset=this.fixedTimelineOffset+this.$refs.videoTimeline.$el.offsetHeight-this.timelineHeightReference,this.currentTimelineOffset=0)}},watch:{"settings.playbackRate":function(t){this.video.playbackRate=t},urlParams:{deep:!0,handler:function(t){y.set(t)}}},created:function(){this.videoId=biigle.$require("videos.id"),this.shapes=biigle.$require("videos.shapes"),this.restoreUrlParams(),this.video.muted=!0,this.video.addEventListener("error",(function(t){t.target.error.code===MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED?l.danger("The video codec is not supported by your browser."):t.target.error.code!==MediaError.MEDIA_ERR_ABORTED&&l.danger("Error while loading video file.")})),this.video.addEventListener("seeked",this.handleVideoSeeked),this.video.addEventListener("pause",this.updateVideoUrlParams),this.video.addEventListener("seeked",this.updateVideoUrlParams),this.startLoading();var t=this,e=new Vue.Promise((function(e,n){t.video.addEventListener("canplay",e)})),n=_.query({id:this.videoId});n.then(this.setAnnotations,s).then(this.initAnnotationFilters),Vue.Promise.all([e,n]).then(this.maybeInitCurrentTime).then(this.finishLoading),this.settingsStore.has("openTab")&&(this.openTab=this.settingsStore.get("openTab"))},mounted:function(){this.video.src=biigle.$require("videos.src")}},Ns=Vue.resource("api/v1/videos{/id}",{},{save:{method:"POST",url:"api/v1/projects{/id}/videos"}}),Vs={mixins:[u,r],components:{previewThumbnail:p},data:{project:null,videos:[],filterString:"",fullHeight:0},computed:{filteredVideos:function(){if(this.hasFiltering){var t=this.filterString.toLowerCase();return this.videos.filter((function(e){return-1!==e.name.toLowerCase().indexOf(t)}))}return this.videos},hasFiltering:function(){return this.filterString.length>0},filterInputClass:function(){return this.hasFiltering?"panel-filter--active":""},hasVideos:function(){return this.videos.length>0},panelStyle:function(){return this.hasFiltering?{height:this.fullHeight+"px"}:{}},hasNoMatchingVideos:function(){return this.hasVideos&&0===this.filteredVideos.length}},methods:{deleteVideo:function(t,e){Ns.delete({id:t.id},{force:!!e}).then(this.videoDeleted(t),this.maybeForceDelete(t))},maybeForceDelete:function(t){var e=this;return function(n){422!==n.status?s(n):confirm("Deleting the video would delete annotations. Do you want to delete the video and the annotations?")&&e.deleteVideo(t,!0)}},videoDeleted:function(t){var e=this;return function(){var n=e.videos.indexOf(t);-1!==n&&e.videos.splice(n,1),e.$nextTick(e.updateFullHeight)}},clearFiltering:function(){this.filterString=""},updateFullHeight:function(){this.fullHeight=this.$el.offsetHeight}},created:function(){this.project=biigle.$require("projects.project"),this.videos=biigle.$require("projects.videos")},mounted:function(){this.updateFullHeight()}};biigle.$mount("create-video-form",v),biigle.$mount("projects-show-video-list",Vs),biigle.$mount("search-results",m),biigle.$mount("video-container",Us)},XPUu:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=i(n("QJ+7")),r=i(n("RZZ2")),s=i(n("lXTj")),a=n("AKIq");function h(t,e){var n,i=!1;for(n=0;n<t.coordinates.length;n++)if(y(t.coordinates[n],e.coordinates)){i=!0;break}return i}function u(t,e){for(var n=0,i=e.coordinates;n<i.length;n++){for(var o=i[n],r=!1,s=0,a=t.coordinates;s<a.length;s++){if(y(o,a[s])){r=!0;break}}if(!r)return!1}return!0}function l(t,e){for(var n=!1,i=0,o=e.coordinates;i<o.length;i++){var r=o[i];if(s.default(r,t,{ignoreEndVertices:!0})&&(n=!0),!s.default(r,t))return!1}return!!n}function c(t,e){for(var n=0,i=e.coordinates;n<i.length;n++){var o=i[n];if(!r.default(o,t,{ignoreBoundary:!0}))return!1}return!0}function p(t,e){for(var n=!1,i=0,o=e.coordinates;i<o.length;i++){var r=o[i];if(s.default({type:"Point",coordinates:r},t,{ignoreEndVertices:!0})&&(n=!0),!s.default({type:"Point",coordinates:r},t,{ignoreEndVertices:!1}))return!1}return n}function f(t,e){var n=!1,i=0;if(!g(o.default(t),o.default(e)))return!1;for(;i<e.coordinates.length-1;i++){var s=v(e.coordinates[i],e.coordinates[i+1]);if(r.default({type:"Point",coordinates:s},t,{ignoreBoundary:!0})){n=!0;break}}return n}function d(t,e){if("Feature"===t.type&&null===t.geometry)return!1;if("Feature"===e.type&&null===e.geometry)return!1;if(!g(o.default(t),o.default(e)))return!1;for(var n=0,i=a.getGeom(e).coordinates;n<i.length;n++)for(var s=0,h=i[n];s<h.length;s++){var u=h[s];if(!r.default(u,t))return!1}return!0}function g(t,e){return!(t[0]>e[0])&&(!(t[2]<e[2])&&(!(t[1]>e[1])&&!(t[3]<e[3])))}function y(t,e){return t[0]===e[0]&&t[1]===e[1]}function v(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}e.default=function(t,e){var n=a.getGeom(t),i=a.getGeom(e),o=a.getType(t),g=a.getType(e),v=a.getCoords(t),m=a.getCoords(e);switch(o){case"Point":switch(g){case"Point":return y(v,m);default:throw new Error("feature2 "+g+" geometry not supported")}case"MultiPoint":switch(g){case"Point":return h(n,i);case"MultiPoint":return u(n,i);default:throw new Error("feature2 "+g+" geometry not supported")}case"LineString":switch(g){case"Point":return s.default(i,n,{ignoreEndVertices:!0});case"LineString":return p(n,i);case"MultiPoint":return l(n,i);default:throw new Error("feature2 "+g+" geometry not supported")}case"Polygon":switch(g){case"Point":return r.default(i,n,{ignoreBoundary:!0});case"LineString":return f(n,i);case"Polygon":return d(n,i);case"MultiPoint":return c(n,i);default:throw new Error("feature2 "+g+" geometry not supported")}default:throw new Error("feature1 "+o+" geometry not supported")}},e.isPointInMultiPoint=h,e.isMultiPointInMultiPoint=u,e.isMultiPointOnLine=l,e.isMultiPointInPoly=c,e.isLineOnLine=p,e.isLineInPoly=f,e.isPolyInPoly=d,e.doBBoxOverlap=g,e.compareCoords=y,e.getMidpoint=v},YcpW:function(t,e,n){t.exports=function(){"use strict";function t(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function e(t,e){return t<e?-1:t>e?1:0}return function(n,i,o,r,s){!function e(n,i,o,r,s){for(;r>o;){if(r-o>600){var a=r-o+1,h=i-o+1,u=Math.log(a),l=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*l*(a-l)/a)*(h-a/2<0?-1:1),p=Math.max(o,Math.floor(i-h*l/a+c)),f=Math.min(r,Math.floor(i+(a-h)*l/a+c));e(n,i,p,f,s)}var d=n[i],g=o,y=r;for(t(n,o,i),s(n[r],d)>0&&t(n,o,r);g<y;){for(t(n,g,y),g++,y--;s(n[g],d)<0;)g++;for(;s(n[y],d)>0;)y--}0===s(n[o],d)?t(n,o,y):(y++,t(n,y,r)),y<=i&&(o=y+1),i<=y&&(r=y-1)}}(n,i,o||0,r||n.length-1,s||e)}}()},Yeox:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("/rf6"),o=n("AKIq");e.default=function(t,e,n,r){void 0===r&&(r={});var s=o.getCoord(t),a=i.degreesToRadians(s[0]),h=i.degreesToRadians(s[1]),u=i.degreesToRadians(n),l=i.lengthToRadians(e,r.units),c=Math.asin(Math.sin(h)*Math.cos(l)+Math.cos(h)*Math.sin(l)*Math.cos(u)),p=a+Math.atan2(Math.sin(u)*Math.sin(l)*Math.cos(h),Math.cos(l)-Math.sin(h)*Math.sin(c)),f=i.radiansToDegrees(p),d=i.radiansToDegrees(c);return i.point([f,d],r.properties)}},Zsd0:function(t,e,n){!function(t){"use strict";function e(t,e){return t>e?1:t<e?-1:0}var n=function(t,n){void 0===t&&(t=e),void 0===n&&(n=!1),this._compare=t,this._root=null,this._size=0,this._noDuplicates=!!n},i={size:{configurable:!0}};function o(t,e,n){null===e?(t.inOut=!1,t.otherInOut=!0):(t.isSubject===e.isSubject?(t.inOut=!e.inOut,t.otherInOut=e.otherInOut):(t.inOut=!e.otherInOut,t.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(t.prevInResult=!r(e,n)||e.isVertical()?e.prevInResult:e)),t.inResult=r(t,n)}function r(t,e){switch(t.type){case 0:switch(e){case 0:return!t.otherInOut;case 1:return t.otherInOut;case 2:return t.isSubject&&t.otherInOut||!t.isSubject&&!t.otherInOut;case 3:return!0}break;case 2:return 0===e||1===e;case 3:return 2===e;case 1:return!1}return!1}n.prototype.rotateLeft=function(t){var e=t.right;e&&(t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.left=t),t.parent=e},n.prototype.rotateRight=function(t){var e=t.left;e&&(t.left=e.right,e.right&&(e.right.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.right=t),t.parent=e},n.prototype._splay=function(t){for(;t.parent;){var e=t.parent;e.parent?e.left===t&&e.parent.left===e?(this.rotateRight(e.parent),this.rotateRight(e)):e.right===t&&e.parent.right===e?(this.rotateLeft(e.parent),this.rotateLeft(e)):e.left===t&&e.parent.right===e?(this.rotateRight(e),this.rotateLeft(e)):(this.rotateLeft(e),this.rotateRight(e)):e.left===t?this.rotateRight(e):this.rotateLeft(e)}},n.prototype.splay=function(t){for(var e,n,i,o,r;t.parent;)(n=(e=t.parent).parent)&&n.parent?((i=n.parent).left===n?i.left=t:i.right=t,t.parent=i):(t.parent=null,this._root=t),o=t.left,r=t.right,t===e.left?(n&&(n.left===e?(e.right?(n.left=e.right,n.left.parent=n):n.left=null,e.right=n,n.parent=e):(o?(n.right=o,o.parent=n):n.right=null,t.left=n,n.parent=t)),r?(e.left=r,r.parent=e):e.left=null,t.right=e,e.parent=t):(n&&(n.right===e?(e.left?(n.right=e.left,n.right.parent=n):n.right=null,e.left=n,n.parent=e):(r?(n.left=r,r.parent=n):n.left=null,t.right=n,n.parent=t)),o?(e.right=o,o.parent=e):e.right=null,t.left=e,e.parent=t)},n.prototype.replace=function(t,e){t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.parent=t.parent)},n.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},n.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},n.prototype.insert=function(t,e){var n=this._root,i=null,o=this._compare;if(this._noDuplicates)for(;n;){if(i=n,0===o(n.key,t))return;n=o(n.key,t)<0?n.right:n.left}else for(;n;)i=n,n=o(n.key,t)<0?n.right:n.left;return n={key:t,data:e,left:null,right:null,parent:i},i?o(i.key,n.key)<0?i.right=n:i.left=n:this._root=n,this.splay(n),this._size++,n},n.prototype.find=function(t){for(var e=this._root,n=this._compare;e;){var i=n(e.key,t);if(i<0)e=e.right;else{if(!(i>0))return e;e=e.left}}return null},n.prototype.contains=function(t){for(var e=this._root,n=this._compare;e;){var i=n(t,e.key);if(0===i)return!0;e=i<0?e.left:e.right}return!1},n.prototype.remove=function(t){var e=this.find(t);if(!e)return!1;if(this.splay(e),e.left)if(e.right){var n=this.minNode(e.right);n.parent!==e&&(this.replace(n,n.right),n.right=e.right,n.right.parent=n),this.replace(e,n),n.left=e.left,n.left.parent=n}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0},n.prototype.removeNode=function(t){if(!t)return!1;if(this.splay(t),t.left)if(t.right){var e=this.minNode(t.right);e.parent!==t&&(this.replace(e,e.right),e.right=t.right,e.right.parent=e),this.replace(t,e),e.left=t.left,e.left.parent=e}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0},n.prototype.erase=function(t){var e=this.find(t);if(e){this.splay(e);var n=e.left,i=e.right,o=null;n&&(n.parent=null,o=this.maxNode(n),this.splay(o),this._root=o),i&&(n?o.right=i:this._root=i,i.parent=o),this._size--}},n.prototype.pop=function(){var t=this._root,e=null;if(t){for(;t.left;)t=t.left;e={key:t.key,data:t.data},this.remove(t.key)}return e},n.prototype.next=function(t){var e=t;if(e)if(e.right)for(e=e.right;e&&e.left;)e=e.left;else for(e=t.parent;e&&e.right===t;)t=e,e=e.parent;return e},n.prototype.prev=function(t){var e=t;if(e)if(e.left)for(e=e.left;e&&e.right;)e=e.right;else for(e=t.parent;e&&e.left===t;)t=e,e=e.parent;return e},n.prototype.forEach=function(t){for(var e=this._root,n=[],i=!1,o=0;!i;)e?(n.push(e),e=e.left):n.length>0?(t(e=n.pop(),o++),e=e.right):i=!0;return this},n.prototype.range=function(t,e,n,i){for(var o=[],r=this._compare,s=this._root;0!==o.length||s;)if(s)o.push(s),s=s.left;else{if(r((s=o.pop()).key,e)>0)break;if(r(s.key,t)>=0&&n.call(i,s))return this;s=s.right}return this},n.prototype.keys=function(){for(var t=this._root,e=[],n=[],i=!1;!i;)t?(e.push(t),t=t.left):e.length>0?(t=e.pop(),n.push(t.key),t=t.right):i=!0;return n},n.prototype.values=function(){for(var t=this._root,e=[],n=[],i=!1;!i;)t?(e.push(t),t=t.left):e.length>0?(t=e.pop(),n.push(t.data),t=t.right):i=!0;return n},n.prototype.at=function(t){for(var e=this._root,n=[],i=!1,o=0;!i;)if(e)n.push(e),e=e.left;else if(n.length>0){if(e=n.pop(),o===t)return e;o++,e=e.right}else i=!0;return null},n.prototype.load=function(t,e,n){if(void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===n&&(n=!1),0!==this._size)throw new Error("bulk-load: tree is not empty");var i=t.length;return n&&function t(e,n,i,o,r){if(!(i>=o)){for(var s=e[i+o>>1],a=i-1,h=o+1;;){do{a++}while(r(e[a],s)<0);do{h--}while(r(e[h],s)>0);if(a>=h)break;var u=e[a];e[a]=e[h],e[h]=u,u=n[a],n[a]=n[h],n[h]=u}t(e,n,i,h,r),t(e,n,h+1,o,r)}}(t,e,0,i-1,this._compare),this._root=function t(e,n,i,o,r){var s=r-o;if(s>0){var a=o+Math.floor(s/2),h={key:n[a],data:i[a],parent:e};return h.left=t(h,n,i,o,a),h.right=t(h,n,i,a+1,r),h}return null}(null,t,e,0,i),this._size=i,this},n.prototype.min=function(){var t=this.minNode(this._root);return t?t.key:null},n.prototype.max=function(){var t=this.maxNode(this._root);return t?t.key:null},n.prototype.isEmpty=function(){return null===this._root},i.size.get=function(){return this._size},n.createTree=function(t,e,i,o,r){return new n(i,r).load(t,e,o)},Object.defineProperties(n.prototype,i);var s=function(t,e,n,i,o){this.left=e,this.point=t,this.otherEvent=n,this.isSubject=i,this.type=o||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.inResult=!1,this.resultInOut=!1,this.isExteriorRing=!0};function a(t,e){return t[0]===e[0]&&t[1]===e[1]}function h(t,e,n){return(t[0]-n[0])*(e[1]-n[1])-(e[0]-n[0])*(t[1]-n[1])}function u(t,e){var n=t.point,i=e.point;return n[0]>i[0]?1:n[0]<i[0]?-1:n[1]!==i[1]?n[1]>i[1]?1:-1:function(t,e,n,i){return t.left!==e.left?t.left?1:-1:0!==h(n,t.otherEvent.point,e.otherEvent.point)?t.isBelow(e.otherEvent.point)?-1:1:!t.isSubject&&e.isSubject?1:-1}(t,e,n)}function l(t,e,n){var i=new s(e,!1,t,t.isSubject),o=new s(e,!0,t.otherEvent,t.isSubject);return a(t.point,t.otherEvent.point)&&console.warn("what is that, a collapsed segment?",t),i.contourId=o.contourId=t.contourId,u(o,t.otherEvent)>0&&(t.otherEvent.left=!0,o.left=!1),t.otherEvent.otherEvent=o,t.otherEvent=i,n.push(o),n.push(i),n}function c(t,e){return t[0]*e[1]-t[1]*e[0]}function p(t,e){return t[0]*e[0]+t[1]*e[1]}function f(t,e,n){var i=function(t,e,n,i,o){var r=[e[0]-t[0],e[1]-t[1]],s=[i[0]-n[0],i[1]-n[1]];function a(t,e,n){return[t[0]+e*n[0],t[1]+e*n[1]]}var h=[n[0]-t[0],n[1]-t[1]],u=c(r,s),l=u*u,f=p(r,r);if(l>0){var d=c(h,s)/u;if(d<0||d>1)return null;var g=c(h,r)/u;return g<0||g>1?null:0===d||1===d?o?null:[a(t,d,r)]:0===g||1===g?o?null:[a(n,g,s)]:[a(t,d,r)]}if((l=(u=c(h,r))*u)>0)return null;var y=p(r,h)/f,v=y+p(r,s)/f,m=Math.min(y,v),_=Math.max(y,v);return m<=1&&_>=0?1===m?o?null:[a(t,m>0?m:0,r)]:0===_?o?null:[a(t,_<1?_:1,r)]:o&&0===m&&1===_?null:[a(t,m>0?m:0,r),a(t,_<1?_:1,r)]:null}(t.point,t.otherEvent.point,e.point,e.otherEvent.point),o=i?i.length:0;if(0===o)return 0;if(1===o&&(a(t.point,e.point)||a(t.otherEvent.point,e.otherEvent.point)))return 0;if(2===o&&t.isSubject===e.isSubject)return 0;if(1===o)return a(t.point,i[0])||a(t.otherEvent.point,i[0])||l(t,i[0],n),a(e.point,i[0])||a(e.otherEvent.point,i[0])||l(e,i[0],n),1;var r=[],s=!1,h=!1;return a(t.point,e.point)?s=!0:1===u(t,e)?r.push(e,t):r.push(t,e),a(t.otherEvent.point,e.otherEvent.point)?h=!0:1===u(t.otherEvent,e.otherEvent)?r.push(e.otherEvent,t.otherEvent):r.push(t.otherEvent,e.otherEvent),s&&h||s?(e.type=1,t.type=e.inOut===t.inOut?2:3,s&&!h&&l(r[1].otherEvent,r[0].point,n),2):h?(l(r[0],r[1].point,n),3):r[0]!==r[3].otherEvent?(l(r[0],r[1].point,n),l(r[1],r[2].point,n),3):(l(r[0],r[1].point,n),l(r[3].otherEvent,r[2].point,n),3)}function d(t,e){if(t===e)return 0;if(0!==h(t.point,t.otherEvent.point,e.point)||0!==h(t.point,t.otherEvent.point,e.otherEvent.point))return a(t.point,e.point)?t.isBelow(e.otherEvent.point)?-1:1:t.point[0]===e.point[0]?t.point[1]<e.point[1]?-1:1:1===u(t,e)?e.isAbove(t.point)?-1:1:t.isBelow(e.point)?-1:1;if(t.isSubject!==e.isSubject)return t.isSubject?-1:1;var n=t.point,i=e.point;return n[0]===i[0]&&n[1]===i[1]?(n=t.otherEvent.point,i=e.otherEvent.point,n[0]===i[0]&&n[1]===i[1]?0:t.contourId>e.contourId?1:-1):1===u(t,e)?1:-1}function g(t,e,n,i){var o=t+1,r=e.length;if(o>r-1)return t-1;for(var s=e[t].point,a=e[o].point;o<r&&a[0]===s[0]&&a[1]===s[1];){if(!n[o])return o;a=e[++o].point}for(o=t-1;n[o]&&o>=i;)o--;return o}function y(t,e){var n,i,o,r=function(t){var e,n,i,o,r=[];for(n=0,i=t.length;n<i;n++)((e=t[n]).left&&e.inResult||!e.left&&e.otherEvent.inResult)&&r.push(e);for(var s=!1;!s;)for(s=!0,n=0,i=r.length;n<i;n++)n+1<i&&1===u(r[n],r[n+1])&&(o=r[n],r[n]=r[n+1],r[n+1]=o,s=!1);for(n=0,i=r.length;n<i;n++)(e=r[n]).pos=n;for(n=0,i=r.length;n<i;n++)(e=r[n]).left||(o=e.pos,e.pos=e.otherEvent.pos,e.otherEvent.pos=o);return r}(t),s={},a=[];for(n=0,i=r.length;n<i;n++)if(!s[n]){var h=[[]];r[n].isExteriorRing?2===e&&!r[n].isSubject&&a.length>1?a[a.length-1].push(h[0]):a.push(h):2!==e||r[n].isSubject||0!==a.length?0===a.length?a.push([[h]]):a[a.length-1].push(h[0]):a.push(h);var l=a.length-1,c=n,p=r[n].point;for(h[0].push(p);c>=n;)o=r[c],s[c]=!0,o.left?(o.resultInOut=!1,o.contourId=l):(o.otherEvent.resultInOut=!0,o.otherEvent.contourId=l),s[c=o.pos]=!0,h[0].push(r[c].point),c=g(c,r,s,n);o=r[c=-1===c?n:c],s[c]=s[o.pos]=!0,o.otherEvent.resultInOut=!0,o.otherEvent.contourId=l}return a}s.prototype.isBelow=function(t){var e=this.point,n=this.otherEvent.point;return this.left?(e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1])>0:(n[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(n[1]-t[1])>0},s.prototype.isAbove=function(t){return!this.isBelow(t)},s.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},s.prototype.clone=function(){var t=new s(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.inResult=this.inResult,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t};var v=_,m=_;function _(t,e){if(!(this instanceof _))return new _(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||w,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)}function w(t,e){return t<e?-1:t>e?1:0}_.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,n=this.compare,i=e[t];t>0;){var o=t-1>>1,r=e[o];if(n(i,r)>=0)break;e[t]=r,t=o}e[t]=i},_down:function(t){for(var e=this.data,n=this.compare,i=this.length>>1,o=e[t];t<i;){var r=1+(t<<1),s=r+1,a=e[r];if(s<this.length&&n(e[s],a)<0&&(r=s,a=e[s]),n(a,o)>=0)break;e[t]=a,t=r}e[t]=o}},v.default=m;var b=Math.max,x=Math.min,C=0;function P(t,e,n,i,o,r){var a,h,l,c,p,f;for(a=0,h=t.length-1;a<h;a++)if(l=t[a],c=t[a+1],p=new s(l,!1,void 0,e),f=new s(c,!1,p,e),p.otherEvent=f,l[0]!==c[0]||l[1]!==c[1]){p.contourId=f.contourId=n,r||(p.isExteriorRing=!1,f.isExteriorRing=!1),u(p,f)>0?f.left=!0:p.left=!0;var d=l[0],g=l[1];o[0]=x(o[0],d),o[1]=x(o[1],g),o[2]=b(o[2],d),o[3]=b(o[3],g),i.push(p),i.push(f)}}var E=[];function S(t,e,i){"number"==typeof t[0][0][0]&&(t=[t]),"number"==typeof e[0][0][0]&&(e=[e]);var r=function(t,e,n){var i=null;return t.length*e.length==0&&(0===n?i=E:2===n?i=t:1!==n&&3!==n||(i=0===t.length?e:t)),i}(t,e,i);if(r)return r===E?null:r;var s=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],h=function(t,e,n,i,o){var r,s,a,h,l,c,p=new v(null,u);for(a=0,h=t.length;a<h;a++)for(l=0,c=(r=t[a]).length;l<c;l++)(s=0===l)&&C++,P(r[l],!0,C,p,n,s);for(a=0,h=e.length;a<h;a++)for(l=0,c=(r=e[a]).length;l<c;l++)s=0===l,2===o&&(s=!1),s&&C++,P(r[l],!1,C,p,i,s);return p}(t,e,s,a,i);return(r=function(t,e,n,i,o){var r=null;return(n[0]>i[2]||i[0]>n[2]||n[1]>i[3]||i[1]>n[3])&&(0===o?r=E:2===o?r=t:1!==o&&3!==o||(r=t.concat(e))),r}(t,e,s,a,i))?r===E?null:r:y(function(t,e,i,r,s,a){for(var h,u,l,c=new n(d),p=[],g=Math.min(r[2],s[2]);0!==t.length;){var y=t.pop();if(p.push(y),0===a&&y.point[0]>g||2===a&&y.point[0]>r[2])break;if(y.left){u=h=c.insert(y),h=h!==(l=c.minNode())?c.prev(h):null,u=c.next(u);var v=h?h.key:null;if(o(y,v,a),u&&2===f(y,u.key,t)&&(o(y,v,a),o(y,u.key,a)),h&&2===f(h.key,y,t)){var m=h;o(v,(m=m!==l?c.prev(m):null)?m.key:null,a),o(y,v,a)}}else y=y.otherEvent,u=h=c.find(y),h&&u&&(h=h!==l?c.prev(h):null,u=c.next(u),c.remove(y),u&&h&&f(h.key,u.key,t))}return p}(h,0,0,s,a,i),i)}var R={UNION:1,DIFFERENCE:2,INTERSECTION:0,XOR:3};t.union=function(t,e){return S(t,e,1)},t.diff=function(t,e){return S(t,e,2)},t.xor=function(t,e){return S(t,e,3)},t.intersection=function(t,e){return S(t,e,0)},t.operations=R,Object.defineProperty(t,"__esModule",{value:!0})}(e)},aI7X:function(t,e,n){"use strict";var i="Function.prototype.bind called on incompatible ",o=Array.prototype.slice,r=Object.prototype.toString;t.exports=function(t){var e=this;if("function"!=typeof e||"[object Function]"!==r.call(e))throw new TypeError(i+e);for(var n,s=o.call(arguments,1),a=function(){if(this instanceof n){var i=e.apply(this,s.concat(o.call(arguments)));return Object(i)===i?i:this}return e.apply(t,s.concat(o.call(arguments)))},h=Math.max(0,e.length-s.length),u=[],l=0;l<h;l++)u.push("$"+l);if(n=Function("binder","return function ("+u.join(",")+"){ return binder.apply(this,arguments); }")(a),e.prototype){var c=function(){};c.prototype=e.prototype,n.prototype=new c,c.prototype=null}return n}},aZEm:function(t,e,n){var i=n("A1R+"),o=n("/rf6"),r=n("cWyK"),s=n("QJ+7").default,a=r.featureEach,h=(r.coordEach,o.polygon,o.featureCollection);function u(t){var e=i(t);return e.insert=function(t){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:s(t),i.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach((function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:s(t),e.push(t)})):a(t,(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:s(t),e.push(t)})),i.prototype.load.call(this,e)},e.remove=function(t,e){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:s(t),i.prototype.remove.call(this,t,e)},e.clear=function(){return i.prototype.clear.call(this)},e.search=function(t){var e=i.prototype.search.call(this,this.toBBox(t));return h(e)},e.collides=function(t){return i.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=i.prototype.all.call(this);return h(t)},e.toJSON=function(){return i.prototype.toJSON.call(this)},e.fromJSON=function(t){return i.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=s(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=s(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}t.exports=u,t.exports.default=u},bbcx:function(t,e,n){"use strict";var i=n("82c2"),o=n("RLeF"),r=n("1u+m"),s=n("WDQk"),a=n("wVpn"),h=o(s(),Object);i(h,{getPolyfill:s,implementation:r,shim:a}),t.exports=h},cWyK:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("/rf6");function o(t,e,n){if(null!==t)for(var i,r,s,a,h,u,l,c,p=0,f=0,d=t.type,g="FeatureCollection"===d,y="Feature"===d,v=g?t.features.length:1,m=0;m<v;m++){h=(c=!!(l=g?t.features[m].geometry:y?t.geometry:t)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var _=0;_<h;_++){var w=0,b=0;if(null!==(a=c?l.geometries[_]:l)){u=a.coordinates;var x=a.type;switch(p=!n||"Polygon"!==x&&"MultiPolygon"!==x?0:1,x){case null:break;case"Point":if(!1===e(u,f,m,w,b))return!1;f++,w++;break;case"LineString":case"MultiPoint":for(i=0;i<u.length;i++){if(!1===e(u[i],f,m,w,b))return!1;f++,"MultiPoint"===x&&w++}"LineString"===x&&w++;break;case"Polygon":case"MultiLineString":for(i=0;i<u.length;i++){for(r=0;r<u[i].length-p;r++){if(!1===e(u[i][r],f,m,w,b))return!1;f++}"MultiLineString"===x&&w++,"Polygon"===x&&b++}"Polygon"===x&&w++;break;case"MultiPolygon":for(i=0;i<u.length;i++){for(b=0,r=0;r<u[i].length;r++){for(s=0;s<u[i][r].length-p;s++){if(!1===e(u[i][r][s],f,m,w,b))return!1;f++}b++}w++}break;case"GeometryCollection":for(i=0;i<a.geometries.length;i++)if(!1===o(a.geometries[i],e,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function r(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length&&!1!==e(t.features[n].properties,n);n++);break;case"Feature":e(t.properties,0)}}function s(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var n=0;n<t.features.length&&!1!==e(t.features[n],n);n++);}function a(t,e){var n,i,o,r,s,a,h,u,l,c,p=0,f="FeatureCollection"===t.type,d="Feature"===t.type,g=f?t.features.length:1;for(n=0;n<g;n++){for(a=f?t.features[n].geometry:d?t.geometry:t,u=f?t.features[n].properties:d?t.properties:{},l=f?t.features[n].bbox:d?t.bbox:void 0,c=f?t.features[n].id:d?t.id:void 0,s=(h=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,o=0;o<s;o++)if(null!==(r=h?a.geometries[o]:a))switch(r.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(r,p,u,l,c))return!1;break;case"GeometryCollection":for(i=0;i<r.geometries.length;i++)if(!1===e(r.geometries[i],p,u,l,c))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,u,l,c))return!1;p++}}function h(t,e){a(t,(function(t,n,o,r,s){var a,h=null===t?null:t.type;switch(h){case null:case"Point":case"LineString":case"Polygon":return!1!==e(i.feature(t,o,{bbox:r,id:s}),n,0)&&void 0}switch(h){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var u=0;u<t.coordinates.length;u++){var l={type:a,coordinates:t.coordinates[u]};if(!1===e(i.feature(l,o),n,u))return!1}}))}function u(t,e){h(t,(function(t,n,r){var s=0;if(t.geometry){var a=t.geometry.type;if("Point"!==a&&"MultiPoint"!==a){var h,u=0,l=0,c=0;return!1!==o(t,(function(o,a,p,f,d){if(void 0===h||n>u||f>l||d>c)return h=o,u=n,l=f,c=d,void(s=0);var g=i.lineString([h,o],t.properties);if(!1===e(g,n,r,d,s))return!1;s++,h=o}))&&void 0}}}))}function l(t,e){if(!t)throw new Error("geojson is required");h(t,(function(t,n,o){if(null!==t.geometry){var r=t.geometry.type,s=t.geometry.coordinates;switch(r){case"LineString":if(!1===e(t,n,o,0,0))return!1;break;case"Polygon":for(var a=0;a<s.length;a++)if(!1===e(i.lineString(s[a],t.properties),n,o,a))return!1}}}))}e.coordEach=o,e.coordReduce=function(t,e,n,i){var r=n;return o(t,(function(t,i,o,s,a){r=0===i&&void 0===n?t:e(r,t,i,o,s,a)}),i),r},e.propEach=r,e.propReduce=function(t,e,n){var i=n;return r(t,(function(t,o){i=0===o&&void 0===n?t:e(i,t,o)})),i},e.featureEach=s,e.featureReduce=function(t,e,n){var i=n;return s(t,(function(t,o){i=0===o&&void 0===n?t:e(i,t,o)})),i},e.coordAll=function(t){var e=[];return o(t,(function(t){e.push(t)})),e},e.geomEach=a,e.geomReduce=function(t,e,n){var i=n;return a(t,(function(t,o,r,s,a){i=0===o&&void 0===n?t:e(i,t,o,r,s,a)})),i},e.flattenEach=h,e.flattenReduce=function(t,e,n){var i=n;return h(t,(function(t,o,r){i=0===o&&0===r&&void 0===n?t:e(i,t,o,r)})),i},e.segmentEach=u,e.segmentReduce=function(t,e,n){var i=n,o=!1;return u(t,(function(t,r,s,a,h){i=!1===o&&void 0===n?t:e(i,t,r,s,a,h),o=!0})),i},e.lineEach=l,e.lineReduce=function(t,e,n){var i=n;return l(t,(function(t,o,r,s){i=0===o&&void 0===n?t:e(i,t,o,r,s)})),i},e.findSegment=function(t,e){if(e=e||{},!i.isObject(e))throw new Error("options is invalid");var n,o=e.featureIndex||0,r=e.multiFeatureIndex||0,s=e.geometryIndex||0,a=e.segmentIndex||0,h=e.properties;switch(t.type){case"FeatureCollection":o<0&&(o=t.features.length+o),h=h||t.features[o].properties,n=t.features[o].geometry;break;case"Feature":h=h||t.properties,n=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=t;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var u=n.coordinates;switch(n.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=u.length+a-1),i.lineString([u[a],u[a+1]],h,e);case"Polygon":return s<0&&(s=u.length+s),a<0&&(a=u[s].length+a-1),i.lineString([u[s][a],u[s][a+1]],h,e);case"MultiLineString":return r<0&&(r=u.length+r),a<0&&(a=u[r].length+a-1),i.lineString([u[r][a],u[r][a+1]],h,e);case"MultiPolygon":return r<0&&(r=u.length+r),s<0&&(s=u[r].length+s),a<0&&(a=u[r][s].length-a-1),i.lineString([u[r][s][a],u[r][s][a+1]],h,e)}throw new Error("geojson is invalid")},e.findPoint=function(t,e){if(e=e||{},!i.isObject(e))throw new Error("options is invalid");var n,o=e.featureIndex||0,r=e.multiFeatureIndex||0,s=e.geometryIndex||0,a=e.coordIndex||0,h=e.properties;switch(t.type){case"FeatureCollection":o<0&&(o=t.features.length+o),h=h||t.features[o].properties,n=t.features[o].geometry;break;case"Feature":h=h||t.properties,n=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=t;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var u=n.coordinates;switch(n.type){case"Point":return i.point(u,h,e);case"MultiPoint":return r<0&&(r=u.length+r),i.point(u[r],h,e);case"LineString":return a<0&&(a=u.length+a),i.point(u[a],h,e);case"Polygon":return s<0&&(s=u.length+s),a<0&&(a=u[s].length+a),i.point(u[s][a],h,e);case"MultiLineString":return r<0&&(r=u.length+r),a<0&&(a=u[r].length+a),i.point(u[r][a],h,e);case"MultiPolygon":return r<0&&(r=u.length+r),s<0&&(s=u[r].length+s),a<0&&(a=u[r][s].length-a),i.point(u[r][s][a],h,e)}throw new Error("geojson is invalid")}},eSxo:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("qhoL"),o=n("j3ZU"),r=n("Yeox"),s=n("sk2A"),a=n("cWyK"),h=n("/rf6"),u=n("AKIq");e.default=function(t,e,n){void 0===n&&(n={});var l=h.point([1/0,1/0],{dist:1/0}),c=0;return a.flattenEach(t,(function(t){for(var a=u.getCoords(t),p=0;p<a.length-1;p++){var f=h.point(a[p]);f.properties.dist=o.default(e,f,n);var d=h.point(a[p+1]);d.properties.dist=o.default(e,d,n);var g=o.default(f,d,n),y=Math.max(f.properties.dist,d.properties.dist),v=i.default(f,d),m=r.default(e,y,v+90,n),_=r.default(e,y,v-90,n),w=s.default(h.lineString([m.geometry.coordinates,_.geometry.coordinates]),h.lineString([f.geometry.coordinates,d.geometry.coordinates])),b=null;w.features.length>0&&((b=w.features[0]).properties.dist=o.default(e,b,n),b.properties.location=c+o.default(f,b,n)),f.properties.dist<l.properties.dist&&((l=f).properties.index=p,l.properties.location=c),d.properties.dist<l.properties.dist&&((l=d).properties.index=p+1,l.properties.location=c+g),b&&b.properties.dist<l.properties.dist&&((l=b).properties.index=p),c+=g}})),l}},f66B:function(t,e,n){var i=n("1seS"),o=n("45zb"),r=n("bbcx"),s=n("2Nju"),a=n("5xAX"),h=n("DmXP"),u=Date.prototype.getTime;function l(t,e,n){var f=n||{};return!!(f.strict?r(t,e):t===e)||(!t||!e||"object"!=typeof t&&"object"!=typeof e?f.strict?r(t,e):t==e:function(t,e,n){var r,f;if(typeof t!=typeof e)return!1;if(c(t)||c(e))return!1;if(t.prototype!==e.prototype)return!1;if(o(t)!==o(e))return!1;var d=s(t),g=s(e);if(d!==g)return!1;if(d||g)return t.source===e.source&&a(t)===a(e);if(h(t)&&h(e))return u.call(t)===u.call(e);var y=p(t),v=p(e);if(y!==v)return!1;if(y||v){if(t.length!==e.length)return!1;for(r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}if(typeof t!=typeof e)return!1;try{var m=i(t),_=i(e)}catch(t){return!1}if(m.length!==_.length)return!1;for(m.sort(),_.sort(),r=m.length-1;r>=0;r--)if(m[r]!=_[r])return!1;for(r=m.length-1;r>=0;r--)if(f=m[r],!l(t[f],e[f],n))return!1;return!0}(t,e,f))}function c(t){return null==t}function p(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length)&&("function"==typeof t.copy&&"function"==typeof t.slice&&!(t.length>0&&"number"!=typeof t[0]))}t.exports=l},j3ZU:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("AKIq"),o=n("/rf6");e.default=function(t,e,n){void 0===n&&(n={});var r=i.getCoord(t),s=i.getCoord(e),a=o.degreesToRadians(s[1]-r[1]),h=o.degreesToRadians(s[0]-r[0]),u=o.degreesToRadians(r[1]),l=o.degreesToRadians(s[1]),c=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(h/2),2)*Math.cos(u)*Math.cos(l);return o.radiansToLength(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),n.units)}},lXTj:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("AKIq");function o(t,e,n,i){var o=n[0],r=n[1],s=t[0],a=t[1],h=e[0],u=e[1],l=h-s,c=u-a;return 0==(n[0]-s)*c-(n[1]-a)*l&&(i?"start"===i?Math.abs(l)>=Math.abs(c)?l>0?s<o&&o<=h:h<=o&&o<s:c>0?a<r&&r<=u:u<=r&&r<a:"end"===i?Math.abs(l)>=Math.abs(c)?l>0?s<=o&&o<h:h<o&&o<=s:c>0?a<=r&&r<u:u<r&&r<=a:"both"===i&&(Math.abs(l)>=Math.abs(c)?l>0?s<o&&o<h:h<o&&o<s:c>0?a<r&&r<u:u<r&&r<a):Math.abs(l)>=Math.abs(c)?l>0?s<=o&&o<=h:h<=o&&o<=s:c>0?a<=r&&r<=u:u<=r&&r<=a)}e.default=function(t,e,n){void 0===n&&(n={});for(var r=i.getCoord(t),s=i.getCoords(e),a=0;a<s.length-1;a++){var h=!1;if(n.ignoreEndVertices&&(0===a&&(h="start"),a===s.length-2&&(h="end"),0===a&&a+1===s.length-1&&(h="both")),o(s[a],s[a+1],r,h))return!0}return!1}},qNH4:function(t,e,n){"use strict";function i(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var o=i(n("A/RR")),r=i(n("O3R+")),s=n("/rf6"),a=n("AKIq"),h=n("cWyK");function u(t){switch(t.type){case"Polygon":return r(t)>1?t:null;case"MultiPolygon":var e=[];if(h.flattenEach(t,(function(t){r(t)>1&&e.push(t.geometry.coordinates)})),e.length)return{type:"MultiPolygon",coordinates:e}}}t.exports=function(t,e){var n=a.getGeom(t),i=a.getGeom(e),r=t.properties||{};if(n=u(n),i=u(i),!n)return null;if(!i)return s.feature(n,r);var h=o.diff(n.coordinates,i.coordinates);return 0===h.length?null:1===h.length?s.polygon(h[0],r):s.multiPolygon(h,r)}},qhoL:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("/rf6"),o=n("AKIq");function r(t,e,n){if(void 0===n&&(n={}),!0===n.final)return function(t,e){var n=r(e,t);return n=(n+180)%360}(t,e);var s=o.getCoord(t),a=o.getCoord(e),h=i.degreesToRadians(s[0]),u=i.degreesToRadians(a[0]),l=i.degreesToRadians(s[1]),c=i.degreesToRadians(a[1]),p=Math.sin(u-h)*Math.cos(c),f=Math.cos(l)*Math.sin(c)-Math.sin(l)*Math.cos(c)*Math.cos(u-h);return i.radiansToDegrees(Math.atan2(p,f))}e.default=r},sYn3:function(t,e,n){"use strict";var i;if(!Object.keys){var o=Object.prototype.hasOwnProperty,r=Object.prototype.toString,s=n("1KsK"),a=Object.prototype.propertyIsEnumerable,h=!a.call({toString:null},"toString"),u=a.call((function(){}),"prototype"),l=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(t){var e=t.constructor;return e&&e.prototype===t},p={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!p["$"+t]&&o.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{c(window[t])}catch(t){return!0}}catch(t){return!0}return!1}();i=function(t){var e=null!==t&&"object"==typeof t,n="[object Function]"===r.call(t),i=s(t),a=e&&"[object String]"===r.call(t),p=[];if(!e&&!n&&!i)throw new TypeError("Object.keys called on a non-object");var d=u&&n;if(a&&t.length>0&&!o.call(t,0))for(var g=0;g<t.length;++g)p.push(String(g));if(i&&t.length>0)for(var y=0;y<t.length;++y)p.push(String(y));else for(var v in t)d&&"prototype"===v||!o.call(t,v)||p.push(String(v));if(h)for(var m=function(t){if("undefined"==typeof window||!f)return c(t);try{return c(t)}catch(t){return!1}}(t),_=0;_<l.length;++_)m&&"constructor"===l[_]||!o.call(t,l[_])||p.push(l[_]);return p}}t.exports=i},sk2A:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=n("/rf6"),r=n("AKIq"),s=i(n("+mSJ")),a=n("cWyK"),h=i(n("aZEm"));function u(t,e){var n=r.getCoords(t),i=r.getCoords(e);if(2!==n.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==i.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var s=n[0][0],a=n[0][1],h=n[1][0],u=n[1][1],l=i[0][0],c=i[0][1],p=i[1][0],f=i[1][1],d=(f-c)*(h-s)-(p-l)*(u-a),g=(p-l)*(a-c)-(f-c)*(s-l),y=(h-s)*(a-c)-(u-a)*(s-l);if(0===d)return null;var v=g/d,m=y/d;if(v>=0&&v<=1&&m>=0&&m<=1){var _=s+v*(h-s),w=a+v*(u-a);return o.point([_,w])}return null}e.default=function(t,e){var n={},i=[];if("LineString"===t.type&&(t=o.feature(t)),"LineString"===e.type&&(e=o.feature(e)),"Feature"===t.type&&"Feature"===e.type&&null!==t.geometry&&null!==e.geometry&&"LineString"===t.geometry.type&&"LineString"===e.geometry.type&&2===t.geometry.coordinates.length&&2===e.geometry.coordinates.length){var l=u(t,e);return l&&i.push(l),o.featureCollection(i)}var c=h.default();return c.load(s.default(e)),a.featureEach(s.default(t),(function(t){a.featureEach(c.search(t),(function(e){var o=u(t,e);if(o){var s=r.getCoords(o).join(",");n[s]||(n[s]=!0,i.push(o))}}))})),o.featureCollection(i)}},wVpn:function(t,e,n){"use strict";var i=n("WDQk"),o=n("82c2");t.exports=function(){var t=i();return o(Object,{is:t},{is:function(){return Object.is!==t}}),t}},yLpj:function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},z8fI:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("aZEm"),o=n("+mSJ"),r=n("eSxo"),s=n("lXTj"),a=n("AKIq"),h=n("cWyK"),u=n("/rf6"),l=n("f66B");function c(t,e){var n=a.getCoords(e),i=a.getCoords(t),o=i[0],r=i[i.length-1],s=t.geometry.coordinates;return l(n[0],o)?s.unshift(n[1]):l(n[0],r)?s.push(n[1]):l(n[1],o)?s.unshift(n[0]):l(n[1],r)&&s.push(n[0]),t}e.default=function(t,e,n){if(void 0===n&&(n={}),n=n||{},!u.isObject(n))throw new Error("options is invalid");var p,f=n.tolerance||0,d=[],g=i.default(),y=o.default(t);return g.load(y),h.segmentEach(e,(function(t){var e=!1;h.featureEach(g.search(t),(function(n){if(!1===e){var i=a.getCoords(t).sort(),o=a.getCoords(n).sort();l(i,o)||(0===f?s.default(i[0],n)&&s.default(i[1],n):r.default(n,i[0]).properties.dist<=f&&r.default(n,i[1]).properties.dist<=f)?(e=!0,p=p?c(p,t):t):(0===f?s.default(o[0],t)&&s.default(o[1],t):r.default(t,o[0]).properties.dist<=f&&r.default(t,o[1]).properties.dist<=f)&&(p=p?c(p,n):n)}})),!1===e&&p&&(d.push(p),p=void 0)})),p&&d.push(p),u.featureCollection(d)}},zcrr:function(t,e){}});